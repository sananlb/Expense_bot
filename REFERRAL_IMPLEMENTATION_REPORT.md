# üìä –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã

## ‚úÖ –°—Ç–∞—Ç—É—Å: –£–°–ü–ï–®–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

#### 1. **–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç Stars –∫ –±–æ–Ω—É—Å–Ω–æ–º—É –ø—Ä–æ–¥–ª–µ–Ω–∏—é**
- **–ü—Ä–æ–±–ª–µ–º–∞**: Telegram API –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ—Ç–∞–º –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å Stars –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–†–µ—à–µ–Ω–∏–µ**: –†–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å—Ä–æ–∫ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤**: `bot/services/affiliate.py:reward_referrer_subscription_extension()`

#### 2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤**
- –ë–æ–Ω—É—Å –≤—ã–¥–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∑–∞ –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç–µ–∂** —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã
- –§–ª–∞–≥ `reward_granted` –≤ –º–æ–¥–µ–ª–∏ `AffiliateReferral` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ `AffiliateReferral`:
  - `reward_granted` - —Ñ–ª–∞–≥ –≤—ã–¥–∞—á–∏ –±–æ–Ω—É—Å–∞
  - `reward_granted_at` - –¥–∞—Ç–∞ –≤—ã–¥–∞—á–∏
  - `reward_months` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ –±–æ–Ω—É—Å–∞
  - `reward_subscription` - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É-–±–æ–Ω—É—Å
- –ú–∏–≥—Ä–∞—Ü–∏—è: `0043_affiliaterewardfields.py`

#### 4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã**
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ Stars –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
- –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –æ–ø–ª–∞—Ç–∞ - —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–æ–Ω—É—Å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
- –†–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏
- –§–∞–π–ª: `bot/routers/subscription.py:898-920`

#### 5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- –£–±—Ä–∞–Ω—ã –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤—ã–ø–ª–∞—Ç–∞—Ö Stars
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –º–µ—Ö–∞–Ω–∏–∫–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –§–∞–π–ª—ã: `bot/texts.py`, `bot/routers/start.py`

## üìã –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

### ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:
1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏** - –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—É–º–º Stars** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
4. **–ë–æ–Ω—É—Å –∑–∞ –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç–µ–∂** - –≤—ã–¥–∞–µ—Ç—Å—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ
5. **–≠–º–æ–¥–∑–∏ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö** - –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –õ–æ–≥–∏–∫–∞ –≤—ã–¥–∞—á–∏ –±–æ–Ω—É—Å–∞:
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π:
1. –ü–æ–¥–ø–∏—Å–∫–∞ –æ–ø–ª–∞—á–µ–Ω–∞ —á–µ—Ä–µ–∑ Stars
2. –°—É–º–º–∞ > 0
3. –ï—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å
4. –ë–æ–Ω—É—Å –µ—â–µ –Ω–µ –≤—ã–¥–∞–≤–∞–ª—Å—è (reward_granted = False)

# –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–Ω—É—Å–∞:
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (1 –∏–ª–∏ 6 –º–µ—Å—è—Ü–µ–≤)
2. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Å payment_method='referral'
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ reward_granted = True
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª—è—Ö:
- **AffiliateReferral** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
- **Subscription** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ payment_method='referral' –¥–ª—è –±–æ–Ω—É—Å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

### 1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram API**
- –ë–æ—Ç—ã –ù–ï –º–æ–≥—É—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å Stars –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è Affiliate Program —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è Mini Apps
- –ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±–æ—Ç–∞

### 2. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- –°—Ä–∞–∑—É –æ–±—ä—è—Å–Ω—è–µ–º —á—Ç–æ –±–æ–Ω—É—Å - —ç—Ç–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏, –Ω–µ Stars
- –£–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ —ç—Ç–æ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π –±–æ–Ω—É—Å –∑–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É
- –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ–± –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ Telegram –¥–ª—è Mini Apps

### 3. **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- –°—Ç–∞—Ä—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ (AffiliateCommission) –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ production
- –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞ –æ—Ç —Å—Ç–∞—Ä–æ–π

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:

1. **–ß–µ—Å—Ç–Ω–æ—Å—Ç—å** - –Ω–µ –æ–±–µ—â–∞–µ–º –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã Stars
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ø–æ–Ω—è—Ç–Ω–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –≤—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
4. **–ú–æ—Ç–∏–≤–∞—Ü–∏—è** - —Ä–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –≤—ã–≥–æ–¥—É (–ø—Ä–æ–¥–ª–µ–Ω–∏–µ)
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é:

### ‚úÖ Checklist –¥–ª—è production:
- [x] –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –≥–æ—Ç–æ–≤–∞
- [x] –¢–µ–∫—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [x] –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cd /home/batman/expense_bot
git pull origin master
docker-compose exec app python manage.py migrate
docker-compose restart app celery celery_beat
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ:

1. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Mini App** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π Affiliate Program
2. **–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
3. **–í–Ω–µ–¥—Ä–∏—Ç—å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–∞–∑–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –±–æ–Ω—É—Å–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é** —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –≤ –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:

–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ —Å —É—á–µ—Ç–æ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Telegram API. –í–º–µ—Å—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç Stars —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –±–æ–Ω—É—Å–Ω–æ–≥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä–∞—è:
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Bot API
- –ü—Ä–æ–∑—Ä–∞—á–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å –¥—Ä—É–∑–µ–π
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ production!**