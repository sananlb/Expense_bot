# ะะปะฐะฝ ะผะธะณัะฐัะธะธ ะฝะฐ ะตะดะธะฝัั ะปะพะณะธะบั ะพะฑัะฐะฑะพัะบะธ ะบะฐัะตะณะพัะธะน

**ะะฐัะฐ ัะพะทะดะฐะฝะธั:** 2025-11-17
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 2025-11-17 (ะธัะฟัะฐะฒะปะตะฝะธั ะฟะพัะปะต ัะตะฒัั)
**ะกัะฐััั:** ะะพัะพะฒ ะบ ะพะฑััะถะดะตะฝะธั
**ะัะธะพัะธัะตั:** ะกัะตะดะฝะธะน (ะพะฟัะธะผะธะทะฐัะธั ะฐััะธัะตะบัััั)

## ๐ ะััะพัะธั ะธะทะผะตะฝะตะฝะธะน

### 2025-11-17 - ะัะฟัะฐะฒะปะตะฝะธั ะฟะพัะปะต ัะตัะฝะธัะตัะบะพะณะพ ัะตะฒัั:
1. โ **ะัะฟัะฐะฒะปะตะฝ NameError**: ะะพะฑะฐะฒะปะตะฝะพ ะพะฟัะตะดะตะปะตะฝะธะต ะฟะตัะตะผะตะฝะฝะพะน `user_lang` ะฒ ะบะพะดะต ะฝะฐะฟะพะปะฝะตะฝะธั keywords
2. โ **ะัะฟัะฐะฒะปะตะฝะฐ ะบะพะผะฐะฝะดะฐ ะฟะพะดััััะฐ keywords**: ะะฐะผะตะฝัะฝ ะฝะตะบะพััะตะบัะฝัะน grep ะฝะฐ Python ัะบัะธะฟั ั regex
3. โ **ะะพะฑะฐะฒะปะตะฝะพ ัะตัะตะฝะธะต ะฟัะพะฑะปะตะผั ัะดะฐะปัะฝะฝัั ะบะฐัะตะณะพัะธะน**:
   - ะกะพััะฐะฝัะฝ fallback ะผะตัะฐะฝะธะทะผ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ัะดะฐะปะธะฒัะธั ะดะตัะพะปัะฝัะต ะบะฐัะตะณะพัะธะธ
   - ะัะตะดะปะพะถะตะฝะพ ะทะฐะฟัะตัะธัั ัะดะฐะปะตะฝะธะต ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน ัะตัะตะท `is_default` ะฟะพะปะต
4. โ **ะฃัะพัะฝะตะฝะฐ ัะธััะตะผะฐ ัะฝะธะบะฐะปัะฝะพััะธ keywords**:
   - ะฏะฒะฝะพ ัะบะฐะทะฐะฝะพ ััะพ ัะฝะธะบะฐะปัะฝะพััั per-user, ะฝะต ะณะปะพะฑะฐะปัะฝะฐั
   - ะะพะฑะฐะฒะปะตะฝั ะดะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ ะธ ะพะถะธะดะฐะตะผะพะต ะบะพะปะธัะตััะฒะพ ะทะฐะฟะธัะตะน
5. โ **ะะตะฐะปะธััะธัะฝะฐั ะพัะตะฝะบะฐ ัะฐะทะผะตัะฐ ะะ**:
   - ะะตัะตััะธัะฐะฝ ัะฐะทะผะตั ั ััััะพะผ row headers, ะธะฝะดะตะบัะพะฒ, TOAST overhead
   - 73-80 MB ะดะปั 1000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน (ะฒะผะตััะพ ะพะฟัะธะผะธััะธัะฝัั 35 MB)
   - ะะพะฑะฐะฒะปะตะฝั ัะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต
1. [ะขะตะบััะฐั ัะธััะฐัะธั](#ัะตะบััะฐั-ัะธััะฐัะธั)
2. [ะัะพะฑะปะตะผั ัะตะบััะตะณะพ ะฟะพะดัะพะดะฐ](#ะฟัะพะฑะปะตะผั-ัะตะบััะตะณะพ-ะฟะพะดัะพะดะฐ)
3. [ะัะตะดะปะฐะณะฐะตะผะพะต ัะตัะตะฝะธะต](#ะฟัะตะดะปะฐะณะฐะตะผะพะต-ัะตัะตะฝะธะต)
4. [ะะปะฐะฝ ะผะธะณัะฐัะธะธ](#ะฟะปะฐะฝ-ะผะธะณัะฐัะธะธ)
5. [ะะธัะบะธ ะธ ะผะตัั ะฟัะตะดะพััะพัะพะถะฝะพััะธ](#ัะธัะบะธ-ะธ-ะผะตัั-ะฟัะตะดะพััะพัะพะถะฝะพััะธ)
6. [ะะปััะตัะฝะฐัะธะฒะฝัะต ะฒะฐัะธะฐะฝัั](#ะฐะปััะตัะฝะฐัะธะฒะฝัะต-ะฒะฐัะธะฐะฝัั)

---

## ๐ ะขะตะบััะฐั ัะธััะฐัะธั

### ะััะธัะตะบัััะฐ ัะตะนัะฐั:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 ะะะะฌะะะะะขะะะฌะกะะะ ะขะะะกะข                      โ
โ              "ะธะฝัะตัะฝะตั 500" ะธะปะธ "ะบะพัะต 200"                 โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ          ะะะะกะะ (expense_parser.py)                โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
        โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
        โ                         โ
        โผ                         โผ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะะ 1:       โ    โ  ะะะะะะ 2:          โ
โ  ะะฐััะพะผะฝัะต       โ    โ  ะะตัะพะปัะฝัะต          โ
โ  ะบะฐัะตะณะพัะธะธ       โ    โ  ะบะฐัะตะณะพัะธะธ          โ
โ  ะฟะพะปัะทะพะฒะฐัะตะปั    โ    โ                     โ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโโโโ
        โ                         โ
        โผ                         โผ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะปััะตะฒัะต ัะปะพะฒะฐ  โ    โ  ะะปััะตะฒัะต ัะปะพะฒะฐ     โ
โ  ะะ ะะ:          โ    โ  ะะ ะะะะ:           โ
โ                  โ    โ                     โ
โ  CategoryKeyword โ    โ  expense_category_  โ
โ  ะผะพะดะตะปั          โ    โ  definitions.py     โ
โ                  โ    โ                     โ
โ  โ ะ ะะ         โ    โ  โ ะัััะบะพ ะฒ ะบะพะดะต   โ
โ  โ ะะตะดะฐะบัะธััะตะผะพ โ    โ  โ ะะต ัะตะดะฐะบัะธััะตัััโ
โ  โ ะกัะฐัะธััะธะบะฐ   โ    โ  โ ะะตั ััะฐัะธััะธะบะธ  โ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะตัะฐะปัะฝัะน ะฐะฝะฐะปะธะท ัะฐะนะปะพะฒ:

#### 1. **bot/services/category.py**
**ะคัะฝะบัะธั:** `create_default_categories_sync()` (ัััะพะบะธ 583-697)

**ะงัะพ ะดะตะปะฐะตั:**
- ะกะพะทะดะฐัั 17 ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน ะฒ ะะ ะฟัะธ ัะตะณะธัััะฐัะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั
- โ ะกะพะทะดะฐัั ะพะฑัะตะบัั `ExpenseCategory` ั `name_ru`, `name_en`, `icon`
- โ **ะะ ัะพะทะดะฐัั** ะบะปััะตะฒัะต ัะปะพะฒะฐ ะฒ `CategoryKeyword`!

```python
# ะกะพะทะดะฐัััั ัะพะปัะบะพ ะบะฐัะตะณะพัะธั
ExpenseCategory(
    profile=profile,
    name=full_name,
    name_ru=name_ru,
    name_en=name_en,
    icon=icon,
    # ะะ ะฝะตั keywords!
)
```

#### 2. **bot/utils/expense_category_definitions.py**
**ะงัะพ ััะฐะฝะธััั:**
- ะกะปะพะฒะฐัั `EXPENSE_CATEGORY_DEFINITIONS` ั 17 ะบะฐัะตะณะพัะธัะผะธ
- ะะปั ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ: `name_ru`, `name_en`, `keywords` (ะผะฐััะธะฒ), `aliases`
- ะัะธะผะตัะฝะพ **300-400 ะบะปััะตะฒัั ัะปะพะฒ** ะถัััะบะพ ะฟัะพะฟะธัะฐะฝั ะฒ ะบะพะดะต

**ะัะธะผะตั:**
```python
'utilities_subscriptions': {
    'name_ru': '๐ฑ ะะพะผะผัะฝะฐะปะบะฐ ะธ ะฟะพะดะฟะธัะบะธ',
    'name_en': '๐ฑ Utilities and Subscriptions',
    'keywords': [
        'ะธะฝัะตัะฝะตั', 'ะผะพะฑะธะปัะฝะฐั ัะฒัะทั', 'ัะตะปะตัะพะฝ', 'ะผัั', 'ะฑะธะปะฐะนะฝ',
        'ัะปะตะบััะธัะตััะฒะพ', 'ะณะฐะท', 'ะฒะพะดะฐ', 'ะฟะพะดะฟะธัะบะฐ', 'netflix', 'spotify',
        # ... ะฒัะตะณะพ ~30 keywords
    ],
    'aliases': ['ะบะพะผะผัะฝะฐะปะบะฐ', 'utilities', 'ะฟะพะดะฟะธัะบะธ']
}
```

**ะคัะฝะบัะธั:** `detect_expense_category_key()` (ัััะพะบะฐ 337)
- ะะตัะตะฑะธัะฐะตั keywords ะธะท `EXPENSE_CATEGORY_DEFINITIONS`
- ะัะตั ะฒัะพะถะดะตะฝะธั ะฒ ัะตะบััะต ะฟะพะปัะทะพะฒะฐัะตะปั
- ะะพะทะฒัะฐัะฐะตั `category_key` (ะฝะฐะฟัะธะผะตั, `"utilities_subscriptions"`)

#### 3. **expenses/models.py**
**ะะพะดะตะปั:** `CategoryKeyword` (ัััะพะบะฐ 387)

```python
class CategoryKeyword(models.Model):
    category = models.ForeignKey(ExpenseCategory, on_delete=models.CASCADE)
    keyword = models.CharField(max_length=100, db_index=True)
    language = models.CharField(max_length=10, choices=LANGUAGE_CHOICES)
    usage_count = models.IntegerField(default=0)  # ะกัะฐัะธััะธะบะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
    last_used = models.DateTimeField(auto_now=True)
```

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
- โ ะะปั ะบะฐััะพะผะฝัั keywords ะฟะพะปัะทะพะฒะฐัะตะปะตะน (ะดะพะฑะฐะฒะปะตะฝะฝัั ะฒัััะฝัั)
- โ ะะปั auto-learning (ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑััะตะฝะธะต ะฝะฐ ััะฐัะฐั)
- โ **ะะ ะธัะฟะพะปัะทัะตััั** ะดะปั ะดะตัะพะปัะฝัั keywords!

#### 4. **bot/utils/expense_parser.py**
**ะะฒะต ัะฐะทะฝัะต ะปะพะณะธะบะธ ะฟะพะธัะบะฐ ะบะฐัะตะณะพัะธะธ:**

**ะะะะะะ 1:** ะะฐััะพะผะฝัะต ะบะฐัะตะณะพัะธะธ (ัััะพะบะธ 547-596)
```python
# ะะฐะณััะถะฐะตะผ ะบะฐัะตะณะพัะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะท ะะ
user_categories = await get_user_categories()

# ะะตัะตะฑะธัะฐะตะผ ะบะฐัะตะณะพัะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั
for user_cat in user_categories:
    # ะัะพะฒะตัะบะฐ ะฝะฐะทะฒะฐะฝะธั ะบะฐัะตะณะพัะธะธ
    if user_cat_lower in text_lower:
        category = get_category_display_name(user_cat, lang_code)
        break

    # ะัะพะฒะตัะบะฐ ะบะปััะตะฒัั ัะปะพะฒ ะะ ะะ (CategoryKeyword)
    keywords = await get_keywords()
    for kw in keywords:
        if kw.keyword.lower() in text_lower:
            # ะะฑะฝะพะฒะปัะตะผ usage_count ะฒ ะะ
            keyword.usage_count += 1
            keyword.save()
            category = get_category_display_name(user_cat, lang_code)
            break
```

**ะะะะะะ 2:** ะะตัะพะปัะฝัะต ะบะฐัะตะณะพัะธะธ (ัััะพะบะธ 602-622)
```python
# ะัะตะผ ะฟะพ ะถัััะบะธะผ keywords ะะ ะะะะ
detected_key = detect_expense_category_key(text_lower)
# โ ะะตัะตะฑะธัะฐะตั EXPENSE_CATEGORY_DEFINITIONS

if detected_key:
    # ะััะฐะตะผัั ะฝะฐะนัะธ ะบะฐัะตะณะพัะธั ะฟะพะปัะทะพะฒะฐัะตะปั ั ััะธะผ ะบะปััะพะผ
    category = find_user_category_by_key(user_categories, detected_key, lang_code)

    # Fallback: ะฑะตััะผ ะฝะฐะทะฒะฐะฝะธะต ะธะท ะบะพะดะฐ
    if not category:
        category = get_expense_category_display_for_key(detected_key, lang_code)
```

---

## โ ะัะพะฑะปะตะผั ัะตะบััะตะณะพ ะฟะพะดัะพะดะฐ

### 1. **ะัะฑะปะธัะพะฒะฐะฝะธะต ะปะพะณะธะบะธ**
- ะะฒะฐ ัะฐะทะฝัั ะผะตัะฐะฝะธะทะผะฐ ะฟะพะธัะบะฐ ะฟะพ keywords
- ะกะปะพะถะฝะพััั ะฟะพะดะดะตัะถะบะธ ะธ ะพัะปะฐะดะบะธ
- ะะฐะทะฝัะต ะฟััะธ ะดะปั ะบะฐััะพะผะฝัั ะธ ะดะตัะพะปัะฝัั keywords

### 2. **ะัััะบะธะน ะบะพะด**
- 300-400 keywords ะฟัะพะฟะธัะฐะฝั ะฒ `expense_category_definitions.py`
- ะะทะผะตะฝะตะฝะธะต keywords ััะตะฑัะตั ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ ะธ ะดะตะฟะปะพั
- ะะตะปัะทั ะฑััััะพ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะน ะฑัะตะฝะด ะธะปะธ ัะตัะฒะธั

### 3. **ะััััััะฒะธะต ััะฐัะธััะธะบะธ ะดะปั ะดะตัะพะปัะฝัั keywords**
- `usage_count` ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ะดะปั ะบะฐััะพะผะฝัั keywords
- ะะต ะฒะธะดะธะผ ะบะฐะบะธะต ะดะตัะพะปัะฝัะต keywords ะธัะฟะพะปัะทััััั ัะฐัะต
- ะกะปะพะถะฝะพ ะพะฟัะธะผะธะทะธัะพะฒะฐัั ัะธััะตะผั

### 4. **ะะตะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั**
- ะะดะฝะธ keywords ะฒ ะะ, ะดััะณะธะต ะฒ ะบะพะดะต
- ะะพะปัะทะพะฒะฐัะตะปั ะฝะต ะผะพะถะตั ัะตะดะฐะบัะธัะพะฒะฐัั ะดะตัะพะปัะฝัะต keywords ัะตัะตะท UI
- ะัะธ ะฟะตัะตะธะผะตะฝะพะฒะฐะฝะธะธ ะบะฐัะตะณะพัะธะธ keywords ะพััะฐัััั ะฒ ะบะพะดะต

### 5. **ะกะปะพะถะฝะพััั ะผะธะณัะฐัะธะธ keywords**
- ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะผะฐะณะฐะทะธะฝะฐ/ะฑัะตะฝะดะฐ ััะตะฑัะตั:
  1. ะะทะผะตะฝะธัั `expense_category_definitions.py`
  2. ะะฐะบะพะผะผะธัะธัั ะธ ะทะฐะฟััะธัั
  3. ะะฐะดะตะฟะปะพะธัั ะฝะฐ ัะตัะฒะตั
- ะะปั ะบะฐััะพะผะฝัั keywords: ะฟัะพััะพ ะดะพะฑะฐะฒะธัั ะทะฐะฟะธัั ะฒ ะะ

### 6. **ะัะพะฑะปะตะผั ั ะผัะปััะธัะทััะฝะพัััั**
- ะัััะบะธะต ะธ ะฐะฝะณะปะธะนัะบะธะต keywords ัะผะตัะฐะฝั ะฒ ะพะดะฝะพะผ ะผะฐััะธะฒะต
- ะะตั ัะฒะฝะพะณะพ ัะฐะทะดะตะปะตะฝะธั ะฟะพ ัะทัะบะฐะผ (ะฒ ะผะพะดะตะปะธ ะฟะพะปะต `language` ะตััั, ะฝะพ ะฝะต ะธัะฟะพะปัะทัะตััั ะดะปั ะดะตัะพะปัะฝัั)

### 7. **ะะฐัััะฐะฑะธััะตะผะพััั**
- ะัะธ ัะพััะต ะบะพะปะธัะตััะฒะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน:
  - ะะฐััะพะผะฝัะต keywords: ัะฐัััั ะปะธะฝะตะนะฝะพ (ะบะฐะถะดัะน ะฟะพะปัะทะพะฒะฐัะตะปั ัะฒะพะธ)
  - ะะตัะพะปัะฝัะต keywords: ะพะดะฝะธ ะดะปั ะฒัะตั (ััะฐะฝัััั ะฒ ะบะพะดะต)
- ะะพ ะปะพะณะธะบะฐ ะพะฑัะฐะฑะพัะบะธ ัะฐะทะฝะฐั!

---

## โ ะัะตะดะปะฐะณะฐะตะผะพะต ัะตัะตะฝะธะต

### ะะพะฝัะตะฟัะธั: **ะะดะธะฝะฐั ะปะพะณะธะบะฐ ัะตัะตะท ะะ**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 ะะะะฌะะะะะขะะะฌะกะะะ ะขะะะกะข                      โ
โ              "ะธะฝัะตัะฝะตั 500" ะธะปะธ "ะบะพัะต 200"                 โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ          ะะะะกะะ (expense_parser.py)                โ
    โ                                                     โ
    โ        ะะะะะะฏ ะะะะะะ ะะะฏ ะะกะะฅ ะะะขะะะะะะ            โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะะกะ keywords ะฒ ะะ:        โ
        โ                            โ
        โ  CategoryKeyword ะผะพะดะตะปั    โ
        โ                            โ
        โ  โ ะะตัะพะปัะฝัะต keywords     โ
        โ  โ ะะฐััะพะผะฝัะต keywords     โ
        โ  โ ะัะต ะฒ ะพะดะฝะพะน ัะฐะฑะปะธัะต    โ
        โ  โ ะะดะธะฝะฐั ะปะพะณะธะบะฐ ะฟะพะธัะบะฐ   โ
        โ  โ ะกัะฐัะธััะธะบะฐ ะดะปั ะฒัะตั    โ
        โ  โ ะะตะดะฐะบัะธััะตะผะพ ัะตัะตะท UI  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะัะธะฝัะธะฟั:

1. **ะัะธ ัะพะทะดะฐะฝะธะธ ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน** โ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะฒะฐัั ะธั keywords ะฒ `CategoryKeyword`
2. **ะฃะฑัะฐัั `detect_expense_category_key()`** ะธ ะถัััะบะธะน ัะฟะธัะพะบ keywords ะธะท definitions
3. **ะัะฟะพะปัะทะพะฒะฐัั ะขะะะฌะะ ะพะดะธะฝ ะผะตัะฐะฝะธะทะผ** โ ะฟะพะธัะบ ะฟะพ `user_categories` ะธ ะธั `keywords` ะธะท ะะ
4. **ะััะฐะฒะธัั `expense_category_definitions.py`** ัะพะปัะบะพ ะบะฐะบ **ัะฐะฑะปะพะฝ** ะดะปั ัะพะทะดะฐะฝะธั ะบะฐัะตะณะพัะธะน

---

## ๐ ะะปะฐะฝ ะผะธะณัะฐัะธะธ

### ะญัะฐะฟ 0: ะะพะดะณะพัะพะฒะบะฐ (ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ)

**ะฆะตะปั:** ะะพะฝััั ะผะฐัััะฐะฑ ะผะธะณัะฐัะธะธ ะธ ะฟะพะดะณะพัะพะฒะธัั ะดะฐะฝะฝัะต

**ะะฐะดะฐัะธ:**
1. ะะพะดััะธัะฐัั ะบะพะปะธัะตััะฒะพ keywords ะฒ ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ
2. ะกะพะทะดะฐัั CSV ัะฐะนะป ั ะผะฐะฟะฟะธะฝะณะพะผ `category_key` โ `keywords`
3. ะัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะบะพะฝัะปะธะบัั (keywords ะฒัััะตัะฐััะธะตัั ะฒ ะฝะตัะบะพะปัะบะธั ะบะฐัะตะณะพัะธัั)

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
```csv
category_key,keyword,language
groceries,ะผะฐะณะฝะธั,ru
groceries,ะฟััะตัะพัะบะฐ,ru
groceries,ะฟัะพะดัะบัั,ru
groceries,groceries,en
cafes_restaurants,ะบะฐัะต,ru
cafes_restaurants,ัะตััะพัะฐะฝ,ru
...
```

**ะะพะผะฐะฝะดะฐ ะดะปั ะฟะพะดััััะฐ:**
```bash
# ะะพััะธัะฐัั keywords ะฒ ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ
python3 << 'EOF'
import re

with open('bot/utils/expense_category_definitions.py', 'r', encoding='utf-8') as f:
    content = f.read()

# ะะฐัะพะดะธะผ ะฒัะต ะฑะปะพะบะธ keywords
keyword_blocks = re.findall(r"'keywords':\s*\[(.*?)\]", content, re.DOTALL)

total_keywords = 0
for i, block in enumerate(keyword_blocks, 1):
    # ะกัะธัะฐะตะผ ะบะพะปะธัะตััะฒะพ ัััะพะบ ั keywords (ะธะณะฝะพัะธััะตะผ ะบะพะผะผะตะฝัะฐัะธะธ)
    keywords = [line.strip() for line in block.split(',') if line.strip() and not line.strip().startswith('#')]
    count = len(keywords)
    total_keywords += count
    print(f"ะะฐัะตะณะพัะธั {i}: {count} keywords")

print(f"\nะัะตะณะพ keywords: {total_keywords}")
EOF
```

**ะะปะธ ะฑะพะปะตะต ะฟัะพััะพะน ะฒะฐัะธะฐะฝั:**
```bash
# ะัะธะผะตัะฝัะน ะฟะพะดัััั - ััะธัะฐะตะผ ัััะพะบะธ ัะพ ัััะพะบะพะฒัะผะธ ะปะธัะตัะฐะปะฐะผะธ ะฒ ะผะฐััะธะฒะต keywords
grep -A 200 "'keywords':" bot/utils/expense_category_definitions.py | grep -E "^\s+'" | wc -l
```

---

### ะญัะฐะฟ 1: ะะฐััะธัะตะฝะธะต ะผะพะดะตะปะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)

**ะฆะตะปั:** ะะพะฑะฐะฒะธัั ะฟะพะปั ะดะปั ัะฐะทะปะธัะตะฝะธั ะดะตัะพะปัะฝัั ะธ ะบะฐััะพะผะฝัั keywords

**ะะทะผะตะฝะตะฝะธั ะฒ `expenses/models.py`:**

```python
class CategoryKeyword(models.Model):
    category = models.ForeignKey(ExpenseCategory, on_delete=models.CASCADE)
    keyword = models.CharField(max_length=100, db_index=True)
    language = models.CharField(max_length=10, choices=LANGUAGE_CHOICES)
    usage_count = models.IntegerField(default=0)
    last_used = models.DateTimeField(auto_now=True)

    # ะะะะซะ ะะะะฏ:
    is_default = models.BooleanField(
        default=False,
        help_text="ะะปััะตะฒะพะต ัะปะพะฒะพ ัะพะทะดะฐะฝะพ ัะธััะตะผะพะน (ะฝะต ะฟะพะปัะทะพะฒะฐัะตะปะตะผ)"
    )
    source = models.CharField(
        max_length=20,
        choices=[
            ('system', 'ะกะธััะตะผะฝะพะต'),
            ('user', 'ะะพะปัะทะพะฒะฐัะตะปััะบะพะต'),
            ('ai_learned', 'ะัััะตะฝะพ AI'),
        ],
        default='user'
    )
```

**ะะธะณัะฐัะธั Django:**
```bash
python manage.py makemigrations -n add_keyword_source_fields
python manage.py migrate
```

---

### ะญัะฐะฟ 2: ะกะพะทะดะฐะฝะธะต ััะฝะบัะธะธ ะดะปั ะฝะฐะฟะพะปะฝะตะฝะธั ะะ ะดะตัะพะปัะฝัะผะธ keywords

**ะคะฐะนะป:** `bot/services/category.py`

**ะะพะฒะฐั ััะฝะบัะธั:**

```python
def populate_default_keywords_for_category(
    category: ExpenseCategory,
    category_key: str,
    lang_code: str = 'ru'
) -> int:
    """
    ะะฐะฟะพะปะฝัะตั ะบะฐัะตะณะพัะธั ะดะตัะพะปัะฝัะผะธ ะบะปััะตะฒัะผะธ ัะปะพะฒะฐะผะธ ะธะท definitions.

    Args:
        category: ะะฑัะตะบั ะบะฐัะตะณะพัะธะธ ExpenseCategory
        category_key: ะะปัั ะบะฐัะตะณะพัะธะธ (ะฝะฐะฟัะธะผะตั, 'utilities_subscriptions')
        lang_code: ะฏะทัะบ ะฟะพะปัะทะพะฒะฐัะตะปั ('ru' ะธะปะธ 'en')

    Returns:
        ะะพะปะธัะตััะฒะพ ัะพะทะดะฐะฝะฝัั ะบะปััะตะฒัั ัะปะพะฒ
    """
    from bot.utils.expense_category_definitions import EXPENSE_CATEGORY_DEFINITIONS

    # ะะพะปััะฐะตะผ definition ะดะปั ััะพะน ะบะฐัะตะณะพัะธะธ
    definition = EXPENSE_CATEGORY_DEFINITIONS.get(category_key)
    if not definition:
        logger.warning(f"No definition found for category_key: {category_key}")
        return 0

    keywords_to_create = []
    keywords_list = definition.get('keywords', [])

    for keyword_text in keywords_list:
        # ะะฟัะตะดะตะปัะตะผ ัะทัะบ keyword
        import re
        has_cyrillic = bool(re.search(r'[ะฐ-ัะ-ะฏัะ]', keyword_text))
        keyword_lang = 'ru' if has_cyrillic else 'en'

        keywords_to_create.append(
            CategoryKeyword(
                category=category,
                keyword=keyword_text.lower().strip(),
                language=keyword_lang,
                is_default=True,
                source='system',
                usage_count=0
            )
        )

    # Bulk create ะดะปั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
    CategoryKeyword.objects.bulk_create(keywords_to_create, ignore_conflicts=True)

    logger.info(f"Created {len(keywords_to_create)} default keywords for category {category.id}")
    return len(keywords_to_create)
```

---

### ะญัะฐะฟ 3: ะะฑะฝะพะฒะปะตะฝะธะต ัะพะทะดะฐะฝะธั ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน

**ะคะฐะนะป:** `bot/services/category.py`

**ะะทะผะตะฝะธัั:** `create_default_categories_sync()` (ัััะพะบะธ 583-697)

**ะัะปะพ:**
```python
ExpenseCategory.objects.bulk_create(categories)
logger.info(f"Created all {len(categories)} default categories")
```

**ะกัะฐะปะพ:**
```python
# ะกะพะทะดะฐัะผ ะบะฐัะตะณะพัะธะธ
created_categories = ExpenseCategory.objects.bulk_create(categories)
logger.info(f"Created all {len(created_categories)} default categories")

# ะะฐะฟะฟะธะฝะณ ะฝะฐะทะฒะฐะฝะธะน ะฝะฐ category_key
category_key_mapping = {
    'ะัะพะดัะบัั': 'groceries',
    'ะะฐัะต ะธ ัะตััะพัะฐะฝั': 'cafes_restaurants',
    'ะขัะฐะฝัะฟะพัั': 'transport',
    'ะะฒัะพะผะพะฑะธะปั': 'car',
    'ะะธะปัะต': 'housing',
    'ะะฟัะตะบะธ': 'pharmacies',
    'ะะตะดะธัะธะฝะฐ': 'medicine',
    'ะัะฐัะพัะฐ': 'beauty',
    'ะกะฟะพัั ะธ ัะธัะฝะตั': 'sports_fitness',
    'ะะดะตะถะดะฐ ะธ ะพะฑัะฒั': 'clothes_shoes',
    'ะะฐะทะฒะปะตัะตะฝะธั': 'entertainment',
    'ะะฑัะฐะทะพะฒะฐะฝะธะต': 'education',
    'ะะพะดะฐัะบะธ': 'gifts',
    'ะััะตัะตััะฒะธั': 'travel',
    'ะะพะผะผัะฝะฐะปะบะฐ ะธ ะฟะพะดะฟะธัะบะธ': 'utilities_subscriptions',
    'ะะะก': 'gas_station',
    'ะัะพัะธะต ัะฐััะพะดั': 'other',
}

# ะะฐะฟะพะปะฝัะตะผ ะบะฐัะตะณะพัะธะธ ะบะปััะตะฒัะผะธ ัะปะพะฒะฐะผะธ
total_keywords = 0
for category in created_categories:
    category_key = category_key_mapping.get(category.name_ru)
    if category_key:
        # ะัะฟะพะปัะทัะตะผ ัะทัะบ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะท ะฟัะพัะธะปั
        user_lang = category.profile.language_code if category.profile else 'ru'
        count = populate_default_keywords_for_category(category, category_key, user_lang)
        total_keywords += count

logger.info(f"Created {total_keywords} default keywords for user {user_id}")
```

---

### ะญัะฐะฟ 4: ะฃะฟัะพัะตะฝะธะต ะฟะฐััะตัะฐ

**ะคะฐะนะป:** `bot/utils/expense_parser.py`

**โ๏ธ ะะะะะ: ะัะพะฑะปะตะผะฐ ั ัะดะฐะปัะฝะฝัะผะธ ะบะฐัะตะณะพัะธัะผะธ!**

ะัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ัะดะฐะปะธะป ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธั (ะฝะฐะฟัะธะผะตั, "ะะพะผะผัะฝะฐะปะบะฐ"), ัะพ keywords ะดะปั ะฝะตั ะฝะต ะฑัะดัั ัะฐะฑะพัะฐัั, ัะฐะบ ะบะฐะบ ะฝะตั ะพะฑัะตะบัะฐ `ExpenseCategory` ะบ ะบะพัะพัะพะผั ะพะฝะธ ะฟัะธะฒัะทะฐะฝั.

**ะะตัะตะฝะธะต: ะกะพััะฐะฝะธัั fallback ะผะตัะฐะฝะธะทะผ**

**ะะซะะ (ัััะพะบะธ 602-622):**
```python
# ะัะปะธ ะฝะต ะฝะฐัะปะธ ะฒ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั, ะธัะตะผ ะฒ ััะฐะฝะดะฐััะฝัั
if not category:
    lang_code = profile.language_code if profile and hasattr(profile, 'language_code') else 'ru'

    detected_key = detect_expense_category_key(text_lower)  # ะัะตั ะฟะพ ะถัััะบะธะผ keywords
    if detected_key:
        category_key = detected_key

        if profile and user_categories:
            category = find_user_category_by_key(user_categories, category_key, lang_code)

        if not category:
            category = get_expense_category_display_for_key(category_key, lang_code)
```

**ะกะขะะะ (ั ัะพััะฐะฝะตะฝะธะตะผ fallback):**
```python
# ะัะปะธ ะฝะต ะฝะฐัะปะธ ะฒ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะบะฐัะตะณะพัะธัั, ะฟัะพะฒะตััะตะผ ัะดะฐะปัะฝะฝัะต ะดะตัะพะปัะฝัะต
if not category and profile:
    lang_code = profile.language_code if profile and hasattr(profile, 'language_code') else 'ru'

    # Fallback: ะฟัะพะฒะตััะตะผ ะฟะพ ะดะตัะพะปัะฝัะผ keywords ะธะท ะบะพะดะฐ (ะดะปั ัะดะฐะปัะฝะฝัั ะบะฐัะตะณะพัะธะน)
    detected_key = detect_expense_category_key(text_lower)
    if detected_key:
        category_key = detected_key

        # ะััะฐะตะผัั ะฝะฐะนัะธ ะบะฐัะตะณะพัะธั ะฟะพะปัะทะพะฒะฐัะตะปั ั ััะธะผ ะบะปััะพะผ
        category = find_user_category_by_key(user_categories, category_key, lang_code)

        # ะัะปะธ ะบะฐัะตะณะพัะธั ัะดะฐะปะตะฝะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะผ - ะธัะฟะพะปัะทัะตะผ fallback ะฝะฐะทะฒะฐะฝะธะต
        if not category:
            category = get_expense_category_display_for_key(category_key, lang_code)
            logger.info(f"User deleted category for key '{category_key}', using fallback name")
```

**ะะปััะตัะฝะฐัะธะฒะฝะพะต ัะตัะตะฝะธะต (ะฑะพะปะตะต ะฟัะฐะฒะธะปัะฝะพะต):**

ะะฐะฟัะตัะฐัั ัะดะฐะปะตะฝะธะต ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน ะะะ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตัะพะทะดะฐะฒะฐัั ะธั:

```python
# ะ bot/services/category.py: delete_category()

@sync_to_async
def delete_category(user_id: int, category_id: int) -> bool:
    """ะฃะดะฐะปะธัั ะบะฐัะตะณะพัะธั"""
    from django.db import transaction

    try:
        with transaction.atomic():
            category = ExpenseCategory.objects.get(
                id=category_id,
                profile__telegram_id=user_id
            )

            # ะะะะะฏ ะะะะะะะะ: ะทะฐะฟัะตัะฐะตะผ ัะดะฐะปะตะฝะธะต ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน ั keywords
            default_keywords_count = CategoryKeyword.objects.filter(
                category=category,
                is_default=True
            ).count()

            if default_keywords_count > 0:
                logger.warning(f"Cannot delete default category {category_id} - has {default_keywords_count} default keywords")
                raise ValueError("ะะตะปัะทั ัะดะฐะปะธัั ััะฐะฝะดะฐััะฝัั ะบะฐัะตะณะพัะธั. ะะตัะตะธะผะตะฝัะนัะต ะตั ะธะปะธ ัะบัะพะนัะต.")

            category.delete()
            logger.info(f"Deleted category {category_id} for user {user_id}")
        return True
    except ExpenseCategory.DoesNotExist:
        logger.warning(f"Category {category_id} not found for user {user_id}")
        return False
```

**ะะตะบะพะผะตะฝะดะฐัะธั:** ะัะฟะพะปัะทะพะฒะฐัั ะบะพะผะฑะธะฝะฐัะธั:
1. ะะฐะฟัะตัะธัั ัะดะฐะปะตะฝะธะต ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน (ะดะพะฑะฐะฒะธัั ะฟะพะปะต `is_default` ะฒ `ExpenseCategory`)
2. ะกะพััะฐะฝะธัั fallback ะดะปั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะบะพัะพััั ัะถะต ัะดะฐะปะตะฝั ะบะฐัะตะณะพัะธะธ

---

### ะญัะฐะฟ 5: ะะธะณัะฐัะธั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

**ะกะพะทะดะฐัั ัะบัะธะฟั:** `migrate_default_keywords.py`

```python
"""
ะกะบัะธะฟั ะดะปั ะผะธะณัะฐัะธะธ ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน.
ะะพะฑะฐะฒะปัะตั ะดะตัะพะปัะฝัะต keywords ะบ ะธั ะบะฐัะตะณะพัะธัะผ.
"""
import os
import sys
import django

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'expense_bot.settings')
django.setup()

from expenses.models import ExpenseCategory, Profile, CategoryKeyword
from bot.services.category import populate_default_keywords_for_category
from bot.utils.expense_category_definitions import normalize_expense_category_key
import logging

logger = logging.getLogger(__name__)


def migrate_existing_users(dry_run=True):
    """
    ะะธะณัะธัะพะฒะฐัั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน - ะดะพะฑะฐะฒะธัั ะดะตัะพะปัะฝัะต keywords.
    """
    print("=" * 80)
    print(f"ะะะะะะฆะะฏ: ะะพะฑะฐะฒะปะตะฝะธะต ะดะตัะพะปัะฝัั keywords ัััะตััะฒัััะธะผ ะฟะพะปัะทะพะฒะฐัะตะปัะผ")
    print(f"ะะตะถะธะผ: {'DRY-RUN (ัะตััะพะฒัะน ะฟัะพะณะพะฝ)' if dry_run else 'ะะะะะะะะะะ ะะะะะะะะะ'}")
    print("=" * 80)
    print()

    # ะะฐะฟะฟะธะฝะณ category_key ะฝะฐ ััััะบะธะต/ะฐะฝะณะปะธะนัะบะธะต ะฝะฐะทะฒะฐะฝะธั
    category_key_mapping = {
        'groceries': ['ะฟัะพะดัะบัั', 'groceries'],
        'cafes_restaurants': ['ะบะฐัะต ะธ ัะตััะพัะฐะฝั', 'cafes and restaurants'],
        'transport': ['ััะฐะฝัะฟะพัั', 'transport'],
        'car': ['ะฐะฒัะพะผะพะฑะธะปั', 'car'],
        'housing': ['ะถะธะปัะต', 'housing'],
        'pharmacies': ['ะฐะฟัะตะบะธ', 'pharmacies'],
        'medicine': ['ะผะตะดะธัะธะฝะฐ', 'medicine'],
        'beauty': ['ะบัะฐัะพัะฐ', 'beauty'],
        'sports_fitness': ['ัะฟะพัั ะธ ัะธัะฝะตั', 'sports and fitness'],
        'clothes_shoes': ['ะพะดะตะถะดะฐ ะธ ะพะฑัะฒั', 'clothes and shoes'],
        'entertainment': ['ัะฐะทะฒะปะตัะตะฝะธั', 'entertainment'],
        'education': ['ะพะฑัะฐะทะพะฒะฐะฝะธะต', 'education'],
        'gifts': ['ะฟะพะดะฐัะบะธ', 'gifts'],
        'travel': ['ะฟััะตัะตััะฒะธั', 'travel'],
        'utilities_subscriptions': ['ะบะพะผะผัะฝะฐะปะบะฐ ะธ ะฟะพะดะฟะธัะบะธ', 'ะบะพะผะผัะฝะฐะปัะฝัะต ััะปัะณะธ ะธ ะฟะพะดะฟะธัะบะธ', 'utilities and subscriptions'],
        'gas_station': ['ะฐะทั', 'gas station'],
        'other': ['ะฟัะพัะธะต ัะฐััะพะดั', 'other expenses'],
    }

    # ะะฑัะฐัะฝัะน ะผะฐะฟะฟะธะฝะณ
    name_to_key = {}
    for key, names in category_key_mapping.items():
        for name in names:
            name_to_key[name.lower()] = key

    # ะะพะปััะฐะตะผ ะฒัะต ะบะฐัะตะณะพัะธะธ
    all_categories = ExpenseCategory.objects.all().prefetch_related('keywords')

    total_categories = all_categories.count()
    categories_with_keywords = 0
    categories_without_keywords = 0
    total_keywords_to_add = 0

    print(f"ะัะตะณะพ ะบะฐัะตะณะพัะธะน: {total_categories}")
    print()

    for category in all_categories:
        # ะัะพะฒะตััะตะผ ะตััั ะปะธ ัะถะต keywords
        existing_keywords_count = category.keywords.count()

        if existing_keywords_count > 0:
            categories_with_keywords += 1
            continue

        # ะะฟัะตะดะตะปัะตะผ category_key ะฟะพ ะฝะฐะทะฒะฐะฝะธั
        name_ru_lower = (category.name_ru or '').lower()
        name_en_lower = (category.name_en or '').lower()

        category_key = None
        if name_ru_lower in name_to_key:
            category_key = name_to_key[name_ru_lower]
        elif name_en_lower in name_to_key:
            category_key = name_to_key[name_en_lower]
        else:
            # ะัะพะฑัะตะผ ะฝะพัะผะฐะปะธะทะพะฒะฐัั
            cat_key_ru = normalize_expense_category_key(category.name_ru)
            cat_key_en = normalize_expense_category_key(category.name_en)

            if cat_key_ru in category_key_mapping:
                category_key = cat_key_ru
            elif cat_key_en in category_key_mapping:
                category_key = cat_key_en

        if not category_key:
            logger.debug(f"Could not determine category_key for category {category.id} ({category.name_ru})")
            continue

        categories_without_keywords += 1

        if not dry_run:
            # ะัะธะผะตะฝัะตะผ ะธะทะผะตะฝะตะฝะธั
            count = populate_default_keywords_for_category(
                category,
                category_key,
                category.profile.language_code if category.profile else 'ru'
            )
            total_keywords_to_add += count
            print(f"โ ะะฐัะตะณะพัะธั ID={category.id} ({category.name_ru}): ะดะพะฑะฐะฒะปะตะฝะพ {count} keywords")
        else:
            # Dry-run - ัะพะปัะบะพ ะฟะพะบะฐะทัะฒะฐะตะผ ััะพ ะฑัะดะตั
            from bot.utils.expense_category_definitions import EXPENSE_CATEGORY_DEFINITIONS
            definition = EXPENSE_CATEGORY_DEFINITIONS.get(category_key, {})
            keywords_count = len(definition.get('keywords', []))
            total_keywords_to_add += keywords_count
            print(f"๐ ะะฐัะตะณะพัะธั ID={category.id} ({category.name_ru}): ะฑัะดะตั ะดะพะฑะฐะฒะปะตะฝะพ {keywords_count} keywords")

    print()
    print("=" * 80)
    print(f"ะะฐัะตะณะพัะธะน ั keywords: {categories_with_keywords}")
    print(f"ะะฐัะตะณะพัะธะน ะฑะตะท keywords: {categories_without_keywords}")
    print(f"ะัะตะณะพ keywords {'ะฑัะดะตั ะดะพะฑะฐะฒะปะตะฝะพ' if dry_run else 'ะดะพะฑะฐะฒะปะตะฝะพ'}: {total_keywords_to_add}")
    print("=" * 80)


if __name__ == '__main__':
    import argparse

    parser = argparse.ArgumentParser()
    parser.add_argument('--apply', action='store_true', help='ะัะธะผะตะฝะธัั ะธะทะผะตะฝะตะฝะธั')
    args = parser.parse_args()

    migrate_existing_users(dry_run=not args.apply)
```

**ะะฐะฟััะบ:**
```bash
# ะขะตััะพะฒัะน ะฟัะพะณะพะฝ
python migrate_default_keywords.py

# ะัะธะผะตะฝะตะฝะธะต
python migrate_default_keywords.py --apply
```

---

### ะญัะฐะฟ 6: ะะฑะฝะพะฒะปะตะฝะธะต `expense_category_definitions.py`

**ะััะฐะฒะธัั ัะพะปัะบะพ ัะฐะฑะปะพะฝั, ัะฑัะฐัั ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ runtime:**

**ะะซะะ:** ะัะฟะพะปัะทัะตััั ะฒ `detect_expense_category_key()` ะฒะพ ะฒัะตะผั ัะฐะฑะพัั ะฑะพัะฐ

**ะกะขะะะ:** ะัะฟะพะปัะทัะตััั ะขะะะฌะะ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะบะฐัะตะณะพัะธะน

**ะะพะฑะฐะฒะธัั ะบะพะผะผะตะฝัะฐัะธะน ะฒ ะฝะฐัะฐะปะพ ัะฐะนะปะฐ:**
```python
"""
ะะะะะ: ะญัะพั ัะฐะนะป ะธัะฟะพะปัะทัะตััั ะขะะะฌะะ ะบะฐะบ ัะฐะฑะปะพะฝ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะดะตัะพะปัะฝัั ะบะฐัะตะณะพัะธะน!

ะะพ ะฒัะตะผั ัะฐะฑะพัั ะฑะพัะฐ keywords ะฑะตััััั ะธะท ะะ (ะผะพะดะตะปั CategoryKeyword).
ะญัะพั ัะฐะนะป ะะ ะธัะฟะพะปัะทัะตััั ะดะปั ะฟะพะธัะบะฐ ะบะฐัะตะณะพัะธะน ะฒ runtime.

ะะทะผะตะฝะตะฝะธั ะฒ ััะพะผ ัะฐะนะปะต ะฒะปะธััั ัะพะปัะบะพ ะฝะฐ ะฝะพะฒัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน.
ะะปั ะพะฑะฝะพะฒะปะตะฝะธั keywords ั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธัะฟะพะปัะทัะนัะต ะผะธะณัะฐัะธะพะฝะฝัะต ัะบัะธะฟัั.
"""
```

---

### ะญัะฐะฟ 7: ะขะตััะธัะพะฒะฐะฝะธะต

**ะขะตััะพะฒัะต ััะตะฝะฐัะธะธ:**

1. **ะะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั:**
   - ะะตะณะธัััะฐัะธั
   - ะัะพะฒะตัะบะฐ ััะพ ัะพะทะดะฐะฝั ะบะฐัะตะณะพัะธะธ ะ keywords ะฒ ะะ
   - ะะฒะพะด ััะฐัั "ะธะฝัะตัะฝะตั 500"
   - ะัะพะฒะตัะบะฐ ััะพ ะบะฐัะตะณะพัะธั ะพะฟัะตะดะตะปะตะฝะฐ ะฟัะฐะฒะธะปัะฝะพ

2. **ะกััะตััะฒัััะธะน ะฟะพะปัะทะพะฒะฐัะตะปั (ะดะพ ะผะธะณัะฐัะธะธ):**
   - ะะฐะฟััะบ ะผะธะณัะฐัะธะพะฝะฝะพะณะพ ัะบัะธะฟัะฐ
   - ะัะพะฒะตัะบะฐ ััะพ ะดะพะฑะฐะฒะปะตะฝั keywords ะบ ะบะฐัะตะณะพัะธัะผ
   - ะะฒะพะด ััะฐัั "ะบะพัะต 200"
   - ะัะพะฒะตัะบะฐ ััะพ ะบะฐัะตะณะพัะธั ะพะฟัะตะดะตะปะตะฝะฐ ะฟัะฐะฒะธะปัะฝะพ

3. **ะะพะปัะทะพะฒะฐัะตะปั ั ะบะฐััะพะผะฝัะผะธ keywords:**
   - ะะพะฑะฐะฒะปะตะฝะธะต ัะฒะพะตะณะพ keyword
   - ะัะพะฒะตัะบะฐ ััะพ ะพะฝ ะธะผะตะตั ะฟัะธะพัะธัะตั ะฝะฐะด ะดะตัะพะปัะฝัะผะธ
   - ะัะพะฒะตัะบะฐ ััะฐัะธััะธะบะธ usage_count

4. **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั:**
   - ะะฐะผะตั ะฒัะตะผะตะฝะธ ะพะฑัะฐะฑะพัะบะธ ััะฐัั (ะดะพ/ะฟะพัะปะต ะผะธะณัะฐัะธะธ)
   - ะะพะปะถะฝะพ ะฑััั ะพะดะธะฝะฐะบะพะฒะพ ะธะปะธ ะฑััััะตะต (ะฝะตั ะดะฒัั ะฟัะพัะพะดะพะฒ)

---

## โ๏ธ ะะธัะบะธ ะธ ะผะตัั ะฟัะตะดะพััะพัะพะถะฝะพััะธ

### ะะธัะบ 1: ะฃะฒะตะปะธัะตะฝะธะต ัะฐะทะผะตัะฐ ะะ

**ะัะพะฑะปะตะผะฐ:**
- 300-400 keywords ร ะบะพะปะธัะตััะฒะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ร 17 ะบะฐัะตะณะพัะธะน
- ะะฐะฟัะธะผะตั: 1000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน ร 350 keywords = 350,000 ะทะฐะฟะธัะตะน ะฒ CategoryKeyword

**ะะตัะตะฝะธะต:**
- โ ะะฝะดะตะบัั ัะถะต ะตััั ะฝะฐ `keyword` ะฟะพะปะต (db_index=True)
- โ Bulk create ะดะปั ัััะตะบัะธะฒะฝะพััะธ
- โ CategoryKeyword - ะฟัะพััะฐั ัะฐะฑะปะธัะฐ, ะทะฐะฟัะพัั ะฑัััััะต
- โ ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะบะตัะธัะพะฒะฐะฝะธะต ะฝะฐ ััะพะฒะฝะต ะฟะพะปัะทะพะฒะฐัะตะปั

**ะะตะฐะปะธััะธัะฝะฐั ะพัะตะฝะบะฐ ะฒะปะธัะฝะธั:**

**ะะฐัััั ัะฐะทะผะตัะฐ ัะฐะฑะปะธัั:**
- ะะฐะทะพะฒัะต ะดะฐะฝะฝัะต: 350,000 ะทะฐะฟะธัะตะน
- ะะฐะทะผะตั ะฝะฐ ะทะฐะฟะธัั ะฒ PostgreSQL:
  - Row header: ~23 bytes
  - Fields: `id` (4b) + `category_id` (4b) + `keyword` (~30b avg) + `language` (10b) + `usage_count` (4b) + `last_used` (8b) + `is_default` (1b) + `source` (20b) = ~81 bytes
  - Alignment padding: ~8 bytes
  - **ะัะพะณะพ ะฝะฐ ะทะฐะฟะธัั: ~112 bytes data**

**ะะฝะดะตะบัั:**
- Primary key index ะฝะฐ `id`: ~16 bytes/row = 5.6 MB
- Index ะฝะฐ `keyword` (db_index=True): ~46 bytes/row = 16 MB
- Foreign key index ะฝะฐ `category_id`: ~20 bytes/row = 7 MB
- **ะัะพะณะพ ะธะฝะดะตะบัั: ~29 MB**

**TOAST overhead:**
- ะะปั ะดะปะธะฝะฝัั keywords (>30 ัะธะผะฒะพะปะพะฒ): ~10-15% overhead
- **TOAST table: ~5 MB**

**ะะฑัะธะน ัะฐะทะผะตั:**
- ะะฐะฝะฝัะต: 350,000 ร 112 bytes = **39 MB**
- ะะฝะดะตะบัั: **29 MB**
- TOAST: **5 MB**
- **ะะขะะะ: ~73-80 MB ะดะปั 1000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน**

**ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต:**
- 10,000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน: ~730-800 MB (0.73-0.8 GB)
- 100,000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน: ~7.3-8 GB

**ะัะฒะพะด:**
- โ ะะปั ัะตะบััะตะณะพ ะผะฐัััะฐะฑะฐ (1000-10000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน) ััะพ ะฟัะธะตะผะปะตะผะพ
- โ๏ธ ะัะธ ัะพััะต ะดะพ 100k+ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฝัะถะฝะพ ัะฐััะผะพััะตัั ะพะฟัะธะผะธะทะฐัะธะธ:
  - ะะฐััะธัะธะพะฝะธัะพะฒะฐะฝะธะต ัะฐะฑะปะธัั ะฟะพ user_id
  - ะััะธะฒะธัะพะฒะฐะฝะธะต ะฝะตะธัะฟะพะปัะทัะตะผัั keywords (usage_count = 0 ะธ last_used > 1 ะณะพะด)
  - Compression ะฝะฐ ััะพะฒะฝะต PostgreSQL

### ะะธัะบ 2: ะะธะณัะฐัะธั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

**ะัะพะฑะปะตะผะฐ:**
- ะัะถะฝะพ ะผะธะณัะธัะพะฒะฐัั ะฒัะตั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะะพะถะตั ะทะฐะฝััั ะฒัะตะผั ะฝะฐ ะฟัะพะดะฐะบัะตะฝะต

**ะะตัะตะฝะธะต:**
- โ ะะธะณัะฐัะธั ัะฐะฑะพัะฐะตั ะฒ dry-run ัะตะถะธะผะต ะดะปั ะฟัะพะฒะตัะบะธ
- โ ะะพะถะฝะพ ะผะธะณัะธัะพะฒะฐัั ะฟะพััะตะฟะตะฝะฝะพ (ะฑะฐััะฐะผะธ ะฟะพ 100 ะฟะพะปัะทะพะฒะฐัะตะปะตะน)
- โ ะกัะฐัะฐั ะปะพะณะธะบะฐ ะฟัะพะดะพะปะถะธั ัะฐะฑะพัะฐัั ะดะพ ะทะฐะฒะตััะตะฝะธั ะผะธะณัะฐัะธะธ
- โ Fallback ะฝะฐ ััะฐััั ะปะพะณะธะบั ะตัะปะธ keywords ะฝะต ะฝะฐะนะดะตะฝั

### ะะธัะบ 3: ะะพะฝัะปะธะบัั keywords ะผะตะถะดั ะบะฐัะตะณะพัะธัะผะธ

**ะัะพะฑะปะตะผะฐ:**
- ะะตะบะพัะพััะต keywords ะผะพะณัั ะฑััั ะฒ ะฝะตัะบะพะปัะบะธั ะบะฐัะตะณะพัะธัั
- ะะฐะฟัะธะผะตั: "ะธะฝัะตัะฝะตั" ะธ ะฒ utilities_subscriptions ะธ ะฒ travel

**ะะตัะตะฝะธะต:**
- โ ะกะธััะตะผะฐ ัะฝะธะบะฐะปัะฝะพััะธ keywords **per-user** ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะฐ
- โ๏ธ **ะะะะะ:** ะฃะฝะธะบะฐะปัะฝะพััั keyword ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ะฒ ัะฐะผะบะฐั ะะะะะะ ะฟะพะปัะทะพะฒะฐัะตะปั!
  - Keyword "ะบะพัะต" ะฑัะดะตั ัะพะทะดะฐะฝ ะดะปั ะบะฐะถะดะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะพัะดะตะปัะฝะพ
  - ะญัะพ ะะ ะณะปะพะฑะฐะปัะฝะฐั ัะฝะธะบะฐะปัะฝะพััั, ะฐ per-profile
  - ะขะฐะฑะปะธัะฐ `CategoryKeyword` ะะ ะธะผะตะตั ัะฝะธะบะฐะปัะฝะพะณะพ ะธะฝะดะตะบัะฐ ะฝะฐ `keyword` ะฟะพะปะต
- โ ะัะธ auto-learning ะบะพะฝัะปะธะบัั ะฒะฝัััะธ ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั ัะฐะทัะตัะฐัััั (ัะดะฐะปะตะฝะธะต ะธะท ะดััะณะธั ะบะฐัะตะณะพัะธะน)
- โ ะ definitions keywords ัะถะต ะฟะพะดะพะฑัะฐะฝั ะฑะตะท ะบะพะฝัะปะธะบัะพะฒ ะฒะฝัััะธ ะพะดะฝะพะณะพ ะฟัะพัะธะปั
- โ Bulk create ั `ignore_conflicts=True` ะฟัะตะดะพัะฒัะฐัะธั ะดัะฑะปะธ ะฟัะธ ะฟะพะฒัะพัะฝะพะผ ะทะฐะฟััะบะต

**ะะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ ัะฝะธะบะฐะปัะฝะพััะธ:**
```python
# ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ keyword - ัะดะฐะปัะตะผ ะตะณะพ ะธะท ะะกะะฅ ะบะฐัะตะณะพัะธะน ะฟะพะปัะทะพะฒะฐัะตะปั
CategoryKeyword.objects.filter(
    category__profile=profile,  # โ per-user!
    keyword=keyword_lower
).delete()

# ะะฐัะตะผ ัะพะทะดะฐัะผ ะฒ ัะตะปะตะฒะพะน ะบะฐัะตะณะพัะธะธ
CategoryKeyword.objects.create(
    category=target_category,
    keyword=keyword_lower
)
```

**ะะถะธะดะฐะตะผะพะต ะบะพะปะธัะตััะฒะพ ะทะฐะฟะธัะตะน:**
- 1000 ะฟะพะปัะทะพะฒะฐัะตะปะตะน ร 17 ะบะฐัะตะณะพัะธะน ร ~20 keywords/ะบะฐัะตะณะพัะธั = ~340,000 ะทะฐะฟะธัะตะน
- ะญัะพ ะฝะพัะผะฐะปัะฝะพ ะดะปั PostgreSQL ะธ ะพะถะธะดะฐะตะผะพ ะฟัะธ per-user ะฟะพะดัะพะดะต

### ะะธัะบ 4: ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

**ะัะพะฑะปะตะผะฐ:**
- ะะพะถะตั ัะปะพะผะฐัั ัััะตััะฒัััะธะน ะบะพะด

**ะะตัะตะฝะธะต:**
- โ ะะพััะฐะฟะฝะพะต ะฒะฝะตะดัะตะฝะธะต
- โ ะกะพััะฐะฝะตะฝะธะต ััะฐัะพะน ะปะพะณะธะบะธ ะบะฐะบ fallback
- โ ะะตัะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต ะฟะตัะตะด ะดะตะฟะปะพะตะผ

### ะะธัะบ 5: ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

**ะัะพะฑะปะตะผะฐ:**
- ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะทะฐะฟัะพัั ะบ ะะ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั

**ะะตัะตะฝะธะต:**
- โ Bulk create ะดะปั keywords (ะพะดะธะฝ ะทะฐะฟัะพั)
- โ ะัะฟะพะปะฝัะตััั ัะพะปัะบะพ ะฟัะธ ัะตะณะธัััะฐัะธะธ (ัะตะดะบะพ)
- โ ะะฐััะธะฝะณ ััะฐั ััะฐะฝะตั ะะซะกะขะะะ (ะพะดะธะฝ ะฟัะพัะพะด ะฒะผะตััะพ ะดะฒัั)

---

## ๐ ะะปััะตัะฝะฐัะธะฒะฝัะต ะฒะฐัะธะฐะฝัั

### ะะฐัะธะฐะฝั 1: ะะธะฑัะธะดะฝัะน ะฟะพะดัะพะด (ะะ ะะะะะะะะะฃะะขะกะฏ)

**ะะพะฝัะตะฟัะธั:**
- ะััะฐะฒะธัั ะถัััะบะธะต keywords ะฒ ะบะพะดะต
- ะะพ ะธัะฟะพะปัะทะพะฒะฐัั ะะ ะดะปั ะบะฐััะพะผะฝัั

**ะะปััั:**
- ะะตะฝััะต ะธะทะผะตะฝะตะฝะธะน
- ะะต ะฝัะถะฝะฐ ะผะธะณัะฐัะธั ะะ

**ะะธะฝััั:**
- โ ะัะพะฑะปะตะผะฐ ะพััะฐัััั - ะดะฒะต ะปะพะณะธะบะธ
- โ ะัั ะตัั ะดัะฑะปะธัะพะฒะฐะฝะธะต ะบะพะดะฐ
- โ ะะตั ััะฐัะธััะธะบะธ ะดะปั ะดะตัะพะปัะฝัั keywords

### ะะฐัะธะฐะฝั 2: ะะตะฝะธะฒะฐั ะผะธะณัะฐัะธั (ะะะะะะะะะฃะะขะกะฏ ะะะ ะะะะะะะฃะขะะงะะซะ ะญะขะะ)

**ะะพะฝัะตะฟัะธั:**
- ะะฐะฟะพะปะฝััั keywords ะฟัะธ ะฟะตัะฒะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ ะบะฐัะตะณะพัะธะธ
- ะะต ะผะธะณัะธัะพะฒะฐัั ะฒัะตั ััะฐะทั

**ะะตะฐะปะธะทะฐัะธั:**
```python
# ะ ะฟะฐััะตัะต ะฟัะธ ะฟะพะธัะบะต ะบะฐัะตะณะพัะธะธ
if category and not category.keywords.exists():
    # ะะตัะฒะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต - ะฝะฐะฟะพะปะฝัะตะผ keywords
    populate_default_keywords_for_category(category, category_key, lang_code)
```

**ะะปััั:**
- โ ะะต ะฝัะถะฝะฐ ะผะฐััะพะฒะฐั ะผะธะณัะฐัะธั
- โ ะะพััะตะฟะตะฝะฝะพะต ะฝะฐะฟะพะปะฝะตะฝะธะต ะะ
- โ ะะตะฝััะต ะฝะฐะณััะทะบะธ ะฝะฐ ะะ

**ะะธะฝััั:**
- โ ะะฐะดะตัะถะบะฐ ะฟัะธ ะฟะตัะฒะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ
- โ ะกะปะพะถะฝะตะต ะพััะปะตะดะธัั ะฟัะพะณัะตัั

### ะะฐัะธะฐะฝั 3: ะขะพะปัะบะพ ะดะปั ะฝะพะฒัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

**ะะพะฝัะตะฟัะธั:**
- ะะพะฒัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ โ keywords ะฒ ะะ
- ะกััะตััะฒัััะธะต ะฟะพะปัะทะพะฒะฐัะตะปะธ โ keywords ะธะท ะบะพะดะฐ

**ะะปััั:**
- โ ะะต ะฝัะถะฝะฐ ะผะธะณัะฐัะธั
- โ ะะพััะตะฟะตะฝะฝัะน ะฟะตัะตัะพะด

**ะะธะฝััั:**
- โ ะะฒะต ะปะพะณะธะบะธ ะฟัะพะดะพะปะถะฐั ัััะตััะฒะพะฒะฐัั
- โ ะะตัะฐะฒะฝัะต ััะปะพะฒะธั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ ะฃัะปะพะถะฝะตะฝะธะต ะฟะพะดะดะตัะถะบะธ

---

## ๐ ะะถะธะดะฐะตะผัะต ัะตะทัะปััะฐัั

### ะะพ ะผะธะณัะฐัะธะธ:
```
ะะพะปัะทะพะฒะฐัะตะปั: "ะธะฝัะตัะฝะตั 500"
ะะฐััะตั: ะัะพัะพะด 1 - ะฟะพะธัะบ ะฒ ะบะฐััะพะผะฝัั keywords (ะะ)
ะะฐััะตั: ะัะพัะพะด 2 - ะฟะพะธัะบ ะฒ ะดะตัะพะปัะฝัั keywords (ะะะ)
ะะฐััะตั: ะะฐััะป ัะตัะตะท detect_expense_category_key()
ะะฐััะตั: find_user_category_by_key() ะดะปั ัะพะฟะพััะฐะฒะปะตะฝะธั ั ะะ
ะะตะทัะปััะฐั: ะะฐัะตะณะพัะธั ะฝะฐะนะดะตะฝะฐ
โฑ๏ธ ะัะตะผั: ~50-100ะผั
```

### ะะพัะปะต ะผะธะณัะฐัะธะธ:
```
ะะพะปัะทะพะฒะฐัะตะปั: "ะธะฝัะตัะฝะตั 500"
ะะฐััะตั: ะะะะ ะฟัะพัะพะด - ะฟะพะธัะบ ะฒะพ ะะกะะฅ keywords (ะะ)
ะะฐััะตั: ะะฐััะป keyword ะฒ CategoryKeyword
ะะฐััะตั: ะะฑะฝะพะฒะธะป usage_count
ะะตะทัะปััะฐั: ะะฐัะตะณะพัะธั ะฝะฐะนะดะตะฝะฐ
โฑ๏ธ ะัะตะผั: ~30-50ะผั (ะฑััััะตะต!)
โ ะกัะฐัะธััะธะบะฐ ะพะฑะฝะพะฒะปะตะฝะฐ
```

### ะัะตะธะผััะตััะฒะฐ ะฟะพัะปะต ะผะธะณัะฐัะธะธ:

1. **ะะดะธะฝะฐั ะปะพะณะธะบะฐ** โ ะฟัะพัะต ะฟะพะดะดะตัะถะบะฐ ะธ ะพัะปะฐะดะบะฐ
2. **ะัั ะฒ ะะ** โ ะผะพะถะฝะพ ัะตะดะฐะบัะธัะพะฒะฐัั ัะตัะตะท ะฐะดะผะธะฝะบั
3. **ะกัะฐัะธััะธะบะฐ ะดะปั ะฒัะตั keywords** โ ะฒะธะดะธะผ ะฟะพะฟัะปััะฝัะต ัะปะพะฒะฐ
4. **ะััััะตะต ะฟะฐััะธะฝะณ** โ ะพะดะธะฝ ะฟัะพัะพะด ะฒะผะตััะพ ะดะฒัั
5. **ะะธะฑะบะพััั** โ ะปะตะณะบะพ ะดะพะฑะฐะฒะปััั ะฝะพะฒัะต ะฑัะตะฝะดั/ัะตัะฒะธัั
6. **ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั** โ ะฒัะต keywords ะฒ ะพะดะฝะพะผ ะผะตััะต

---

## ๐ ะงะตะบะปะธัั ัะตะฐะปะธะทะฐัะธะธ

### ะะพะดะณะพัะพะฒะบะฐ:
- [ ] ะัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะฒัะต keywords ะฒ definitions
- [ ] ะกะพะทะดะฐัั CSV ั ะผะฐะฟะฟะธะฝะณะพะผ
- [ ] ะัะพะฒะตัะธัั ะบะพะฝัะปะธะบัั keywords

### ะะฐะทัะฐะฑะพัะบะฐ:
- [ ] ะะพะฑะฐะฒะธัั ะฟะพะปั `is_default` ะธ `source` ะฒ CategoryKeyword (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- [ ] ะกะพะทะดะฐัั ะผะธะณัะฐัะธั Django
- [ ] ะะตะฐะปะธะทะพะฒะฐัั `populate_default_keywords_for_category()`
- [ ] ะะฑะฝะพะฒะธัั `create_default_categories_sync()`
- [ ] ะฃะฟัะพััะธัั `expense_parser.py` (ัะดะฐะปะธัั ะดัะฑะปะธัััััั ะปะพะณะธะบั)
- [ ] ะกะพะทะดะฐัั ัะบัะธะฟั `migrate_default_keywords.py`

### ะขะตััะธัะพะฒะฐะฝะธะต:
- [ ] ะขะตััั ะดะปั ะฝะพะฒัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- [ ] ะขะตััั ะดะปั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- [ ] ะขะตััั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
- [ ] ะขะตััั ะผะธะณัะฐัะธะพะฝะฝะพะณะพ ัะบัะธะฟัะฐ (dry-run)

### ะะตะฟะปะพะน:
- [ ] ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ Django ะฝะฐ ะฟัะพะดะฐะบัะตะฝะต
- [ ] ะะฐะฟัััะธัั `migrate_default_keywords.py --apply`
- [ ] ะะพะฝะธัะพัะธะฝะณ ะปะพะณะพะฒ
- [ ] ะัะพะฒะตัะบะฐ ะผะตััะธะบ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

### ะะพัะปะต ะดะตะฟะปะพั:
- [ ] ะัะพะฒะตัะธัั ััะพ ะฝะพะฒัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ะฟะพะปััะฐัั keywords
- [ ] ะัะพะฒะตัะธัั ััะพ ัััะตััะฒัััะธะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะธะณัะธัะพะฒะฐะฝั
- [ ] ะัะพะฒะตัะธัั ััะฐัะธััะธะบั usage_count
- [ ] ะะฑะฝะพะฒะธัั ะดะพะบัะผะตะฝัะฐัะธั

---

## ๐ญ ะะพะฟัะพัั ะดะปั ะพะฑััะถะดะตะฝะธั

1. **ะัะถะฝะพ ะปะธ ะฟะพะปะต `is_default`?**
   - ะะปะธ ะดะพััะฐัะพัะฝะพ `source` (system/user/ai_learned)?
   - ะะปะธ ะฒะพะพะฑัะต ะฝะต ะฝัะถะฝะพ ัะฐะทะปะธัะฐัั?

2. **ะกััะฐัะตะณะธั ะผะธะณัะฐัะธะธ:**
   - ะะธะณัะธัะพะฒะฐัั ะฒัะตั ััะฐะทั?
   - ะะตะฝะธะฒะฐั ะผะธะณัะฐัะธั ะฟัะธ ะฟะตัะฒะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ?
   - ะขะพะปัะบะพ ะฝะพะฒัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ?

3. **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั:**
   - ะะพะฑะฐะฒะธัั ะบะตัะธัะพะฒะฐะฝะธะต keywords ะฝะฐ ััะพะฒะฝะต ะฟัะพัะธะปั?
   - ะะปะธ ะดะพััะฐัะพัะฝะพ ะธะฝะดะตะบัะฐ ะฝะฐ keyword ะฟะพะปะต?

4. **UI ะดะปั ัะฟัะฐะฒะปะตะฝะธั:**
   - ะะพะทะฒะพะปะธัั ะฟะพะปัะทะพะฒะฐัะตะปัะผ ัะตะดะฐะบัะธัะพะฒะฐัั ะดะตัะพะปัะฝัะต keywords?
   - ะะปะธ ัะพะปัะบะพ ะดะพะฑะฐะฒะปััั ัะฒะพะธ?

5. **ะัะธะพัะธัะตั:**
   - ะะพะณะดะฐ ะดะตะปะฐัั ััั ะผะธะณัะฐัะธั?
   - ะััั ะปะธ ะฑะพะปะตะต ะฒะฐะถะฝัะต ะทะฐะดะฐัะธ?

---

**ะะฐัะฐ ะพะฑะฝะพะฒะปะตะฝะธั:** 2025-11-17
**ะะฒัะพั:** Claude Code
**ะกัะฐััั:** ะะถะธะดะฐะตั ะพะฑััะถะดะตะฝะธั ะธ ััะฒะตัะถะดะตะฝะธั
