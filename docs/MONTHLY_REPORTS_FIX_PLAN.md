# –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–æ –º–µ—Å—è—á–Ω—ã–º –æ—Ç—á—ë—Ç–∞–º

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-12-01  
**–ê–≤—Ç–æ—Ä:** –î–º–∏—Ç—Ä–∏–π

---

## üö© –ó–∞–¥–∞—á–∏ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

| ‚Ññ | –ó–∞–¥–∞—á–∞ | –¢–∏–ø | –§–∞–π–ª(—ã) | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|--------|-----|---------|-----------|
| 1 | –í–∞–ª—é—Ç–∞ –≤ AI-–∏–Ω—Å–∞–π—Ç–∞—Ö | üõë –ö—Ä–∏—Ç–∏—á–Ω–æ | `monthly_insights.py` | P1 |
| 2 | –í–∞–ª—é—Ç–∞ –≤ Excel (–∏—Ç–æ–≥–∏ + pie) | üü† –í—ã—Å–æ–∫–∏–π | `export_service.py` | P2 |
| 3 | –í–∞–ª—é—Ç–∞ –≤ PDF (–∏—Ç–æ–≥–∏) | üü† –í—ã—Å–æ–∫–∏–π | `pdf_report.py` | P2 |
| 4 | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å PDF (reuse –±—Ä–∞—É–∑–µ—Ä–∞ / –ø—É–ª / semaphore) ‚Äî **TODO, –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ–º** | üü† –í—ã—Å–æ–∫–∏–π | `pdf_report.py` | P2* |
| 5 | –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞ | üü† –í—ã—Å–æ–∫–∏–π | `notifications.py`, `monthly_insights.py` | P3 |
| 6 | Household-—Ä–µ–∂–∏–º –≤ –∏–Ω—Å–∞–π—Ç–∞—Ö | üü† –í—ã—Å–æ–∫–∏–π | `monthly_insights.py` | P3 |
| 7 | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è historical_data | üü° –°—Ä–µ–¥–Ω–∏–π | `monthly_insights.py` | P4 |
| 8 | –í–∞–ª–∏–¥–∞—Ü–∏—è AI-–æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º | üü† –í—ã—Å–æ–∫–∏–π | `monthly_insights.py` | P2 |

### –û—Å–Ω–æ–≤–Ω—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã / –∑–∞–º–µ—Ç–∫–∏
- –ü—Ä–æ–±–ª–µ–º–∞ –≤–∞–ª—é—Ç: –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞–ª—é—Ç–µ –ø—Ä–æ—Ñ–∏–ª—è, –ª–∏–±–æ —Ö—Ä–∞–Ω–∏—Ç—å/–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ –≤–∞–ª—é—Ç–∞–º; –¥–æ—Ö–æ–¥—ã –∏ –±–∞–ª–∞–Ω—Å —Ç–æ–∂–µ –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–º–µ—à–∏–≤–∞—Ç—å—Å—è. –ò—Å—Ç–æ—Ä–∏—è –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ –∂–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–≤–∞–ª—é—Ç–∞, household).
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: —Ç–æ–ø—ã –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å `category_id`, —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ ID (fallback ‚Äî –∏–º—è). ID –±—Ä–∞—Ç—å –∏–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ display_name.
- Household: —Ñ–∏–ª—å—Ç—Ä—ã –≤ –∏–Ω—Å–∞–π—Ç–∞—Ö –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å PDF (UserSettings.view_scope –∏ household_id) –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞, –∞ —Ç–∞–∫–∂–µ –¥–ª—è historical_data.
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å PDF: –æ—Å—Ç–∞–≤–∏—Ç—å –≤ –ø–ª–∞–Ω–µ –∫–∞–∫ TODO (—Ä–µ—à–µ–Ω–∏–µ –ø–æ–∑–∂–µ ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä/–ø—É–ª/—Å–µ–º–∞—Ñ–æ—Ä).
- AI-–æ—Ç–≤–µ—Ç: –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–Ω—Å–∞–π—Ç, –µ—Å–ª–∏ summary/analysis –ø—É—Å—Ç—ã–µ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ.

---

## ‚úÖ P1: –í–∞–ª—é—Ç–∞ –≤ AI-–∏–Ω—Å–∞–π—Ç–∞—Ö
- `monthly_insights.py`:
  - `_collect_month_data`: —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞–ª—é—Ç–µ –ø—Ä–æ—Ñ–∏–ª—è **–∏–ª–∏** –≤—ã–¥–µ–ª—è—Ç—å primary + —Å–ø–∏—Å–æ–∫ –¥—Ä—É–≥–∏—Ö –≤–∞–ª—é—Ç (–Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ —Å—É–º–º–∞—Ö). –ò—Ç–æ–≥–∏, —Ç–æ–ø—ã, –±–∞–ª–∞–Ω—Å ‚Äî —Ç–æ–ª—å–∫–æ primary. –î–æ—Ö–æ–¥—ã ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ.
  - `_collect_historical_data`: —Ç–µ –∂–µ –ø—Ä–∞–≤–∏–ª–∞ (–≤–∞–ª—é—Ç–∞, household); –∏–Ω–∞—á–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.
  - `prev_month_data`: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ –≤—ã–±–æ—Ä–∫—É, —á—Ç–æ –∏ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü.
  - –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ multi-currency —Ä–µ–∂–∏–º–∞ ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫ ‚Äú–¥—Ä—É–≥–∏–µ –≤–∞–ª—é—Ç—ã‚Äù –≤ –ø—Ä–æ–º–ø—Ç–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –ø–æ–π–¥—ë–º –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç—É B).

–û—Ü–µ–Ω–∫–∞: 1‚Äì2 —á.

---

## üü† P2: –í–∞–ª—é—Ç–∞ –≤ Excel
- `export_service.py`:
  - Category stats —É–∂–µ –∫–ª—é—á—É—é—Ç—Å—è –ø–æ (category_name, currency); –Ω—É–∂–Ω–æ –∏—Ç–æ–≥–∏/–ø—Ä–æ—Ü–µ–Ω—Ç—ã —Å—á–∏—Ç–∞—Ç—å –ø–æ –≤–∞–ª—é—Ç–∞–º: `totals_by_currency`, pie ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞–ª—é—Ç–µ –ø—Ä–æ—Ñ–∏–ª—è.
  - –ë–∞–ª–∞–Ω—Å/percentages/–∏—Ç–æ–≥–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ ‚Äî –Ω–µ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∞–ª—é—Ç—ã; –≤—ã–≤–æ–¥–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ per-currency.
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Ö–æ–¥—ã: –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã, –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ç—É –∂–µ –ª–æ–≥–∏–∫—É –≤–∞–ª—é—Ç.

–û—Ü–µ–Ω–∫–∞: 2‚Äì3 —á.

---

## üü† P2: –í–∞–ª—é—Ç–∞ –≤ PDF
- `pdf_report.py`:
  - –ò—Ç–æ–≥–∏/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–¥–Ω–∏ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞–ª—é—Ç–µ –ø—Ä–æ—Ñ–∏–ª—è –∏–ª–∏ –ø–æ –≤–∞–ª—é—Ç–∞–º —Ä–∞–∑–¥–µ–ª—å–Ω–æ; –∏—Å–∫–ª—é—á–∏—Ç—å —Å–º–µ—à–µ–Ω–∏–µ –≤ –∞–≥—Ä–µ–≥–∞—Ç–∞—Ö (`Sum('amount')`).
  - –ï—Å–ª–∏ –¥–æ—Ö–æ–¥—ã –≤—ã–≤–æ–¥—è—Ç—Å—è ‚Äî —Ç–∞ –∂–µ –ª–æ–≥–∏–∫–∞ –¥–ª—è incomes.

–û—Ü–µ–Ω–∫–∞: 1‚Äì2 —á.

---

## üü† P2*: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å PDF (TODO)
- –ó–∞–¥–∞—á–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –ø–ª–∞–Ω–µ, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–µ–π—á–∞—Å.
- –í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞ –±—É–¥—É—â–µ–µ: –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Playwright/Chromium, –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (asyncio.Semaphore) –∏–ª–∏ offload –≤ –∑–∞–¥–∞—á—É –æ—á–µ—Ä–µ–¥–∏.

---

## üü† P3: –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
- `monthly_insights.py`: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `top_categories` –ø–æ–ª–µ `category_id` (–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ `expenses_by_category` –¥–ª—è –ø–æ–∏—Å–∫–∞ ID, –Ω–µ –ø–æ display_name).
- `notifications.py`: –≤ `_calculate_category_changes` –∫–ª—é—á–æ–º –¥–µ–ª–∞—Ç—å `category_id` (fallback ‚Äî –∏–º—è, –µ—Å–ª–∏ ID –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö).

–û—Ü–µ–Ω–∫–∞: ~2 —á.

---

## üü† P3: Household-—Ä–µ–∂–∏–º –≤ –∏–Ω—Å–∞–π—Ç–∞—Ö
- `monthly_insights.py`: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ –∂–µ –ø—Ä–∞–≤–∏–ª–∞, —á—Ç–æ –≤ `pdf_report.py` ‚Äî `UserSettings.view_scope` + `household_id` –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞, –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞ –∏ historical_data.
- –ë–∞–ª–∞–Ω—Å/—Ç–æ–ø—ã/—Å—É–º–º—ã –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–∂–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π scope (personal/household).

–û—Ü–µ–Ω–∫–∞: 2‚Äì3 —á.

---

## üü° P4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è historical_data
- `_collect_historical_data`: –æ–¥–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å GROUP BY month (–∏ —Ç–µ –∂–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –≤–∞–ª—é—Ç–µ/household), –≤–º–µ—Å—Ç–æ 12 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

–û—Ü–µ–Ω–∫–∞: 1‚Äì2 —á.

---

## üü† P2: –í–∞–ª–∏–¥–∞—Ü–∏—è AI-–æ—Ç–≤–µ—Ç–∞
- –ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏–Ω—Å–∞–π—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å `summary/analysis` –Ω–∞ –Ω–µ–ø—É—Å—Ç–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ/–º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É; –∏–Ω–∞—á–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å (–∏–ª–∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å fallback-—Ä–µ–∑—é–º–µ).

–û—Ü–µ–Ω–∫–∞: 0.5‚Äì1 —á.

---

## üìå –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
1. P1 (–≤–∞–ª—é—Ç–∞ –≤ –∏–Ω—Å–∞–π—Ç–∞—Ö + –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ/prev –¥–∞–Ω–Ω—ã–µ).
2. P2 Excel + P2 PDF (–≤–∞–ª—é—Ç–∞, –ø—Ä–æ—Ü–µ–Ω—Ç—ã, –±–∞–ª–∞–Ω—Å; –¥–æ—Ö–æ–¥—ã ‚Äî —Ç–æ–∂–µ).
3. P3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (ID) + household.
4. P4 –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.
5. P2 –≤–∞–ª–∏–¥–∞—Ü–∏—è AI-–æ—Ç–≤–µ—Ç–∞.
6. P2* –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å PDF ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –≤ backlog.

---

## üß™ –¢–µ—Å—Ç—ã
- –í–∞–ª—é—Ç–∞: –ø—Ä–æ—Ñ–∏–ª–∏ —Å –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç–æ–π (RUB), —Å –¥–≤—É–º—è (RUB+USD), —Å –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞–ª—é—Ç–æ–π USD ‚Äî —Å–≤–µ—Ä–∏—Ç—å —Å—É–º–º—ã/–±–∞–ª–∞–Ω—Å/–ø—Ä–æ—Ü–µ–Ω—Ç—ã (AI/Excel/PDF).
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: —Å–º–µ–Ω–∞ —è–∑—ã–∫–∞ RU‚ÜíEN, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ª—å—Ç –ø–æ ID.
- Household: personal vs household –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –ø—Ä–æ—Ñ–∏–ª—è ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤ AI –∏ PDF.
- Historical_data: –≤–µ—Ä–Ω—É—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –º–µ—Å—è—Ü—ã –∏ —Å—É–º–º—ã –ø—Ä–∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ.
