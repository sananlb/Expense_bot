# –û—Ç—á—ë—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—è—á–Ω—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤ –∏ —É–¥–∞–ª–µ–Ω–∏–µ Google AI

**–î–∞—Ç–∞:** 1 –¥–µ–∫–∞–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä

---

## üìã –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ #1: Google AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ DeepSeek
- **–°–∏–º–ø—Ç–æ–º:** –ú–µ—Å—è—á–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ —Å –æ—à–∏–±–∫–æ–π "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"
- **–ü—Ä–∏—á–∏–Ω–∞:** Google Gemini API –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫—É `400 User location is not supported for the API use` (–≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
- **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:**
  - –í –∫–æ–¥–µ –±—ã–ª–æ –∂—ë—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å–∞–Ω–æ `provider='google'` –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç –≤ 4 —Ñ–∞–π–ª–∞—Ö
  - –ü–æ—Å–ª–µ `AISelector.clear_cache()` —Å–∏—Å—Ç–µ–º–∞ –ø–∞–¥–∞–ª–∞ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ Google –≤–º–µ—Å—Ç–æ DeepSeek

### –ü—Ä–æ–±–ª–µ–º–∞ #2: DeepSeek –≤—ã–∑—ã–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JSON
- **–°–∏–º–ø—Ç–æ–º:** DeepSeek –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML (`<b>üìã Expenses...</b>`) –≤–º–µ—Å—Ç–æ JSON
- **–ü—Ä–∏—á–∏–Ω–∞:** `UnifiedAIService.chat()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–ª Intent Recognition –∏ DeepSeek –≤—ã–∑—ã–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏–∏ `get_expenses_list()`, `get_financial_summary()` –∏ —Ç.–¥.
- **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:** –î–ª—è –º–µ—Å—è—á–Ω—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ù–ï –Ω—É–∂–Ω—ã - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ —Å–æ–±—Ä–∞–Ω—ã –≤ `month_data`, –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **–°–∏–º–ø—Ç–æ–º:** –í Telegram –ø—Ä–∏—Ö–æ–¥–∏–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞"
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏ –æ—à–∏–±–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Å–∞–π—Ç–∞, —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –≤ –ø–æ–ª–µ `ai_summary` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–Ω—Å–∞–π—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ #4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Å–ª–∞–±–∞—è –º–æ–¥–µ–ª—å DeepSeek
- **–°–∏–º–ø—Ç–æ–º:** –ö–∞—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞ –±—ã–ª–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º
- **–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –º–æ–¥–µ–ª—å `deepseek-chat` –≤–º–µ—Å—Ç–æ –±–æ–ª–µ–µ –º–æ—â–Ω–æ–π `deepseek-reasoner`
- **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:** –ú–æ–¥–µ–ª–∏ –Ω–µ –±—ã–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —á–µ—Ä–µ–∑ `.env`

---

## üîß –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –£–¥–∞–ª–µ–Ω–∏–µ Google –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

#### `bot/services/ai_selector.py` (—Å—Ç—Ä–æ–∫–∏ 15-62)
**–ò–∑–º–µ–Ω–µ–Ω–æ:** –í—Å–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å `'google'` –Ω–∞ `'deepseek'`

```python
# –ë–´–õ–û:
AI_PROVIDERS = {
    'categorization': {
        'provider': os.getenv('AI_PROVIDER_CATEGORIZATION', 'google'),
        # ...
    },
    'chat': {
        'provider': os.getenv('AI_PROVIDER_CHAT', 'google'),
        # ...
    },
    'insights': {
        'provider': os.getenv('AI_PROVIDER_INSIGHTS', 'google'),
        # ...
    },
}

# –°–¢–ê–õ–û:
AI_PROVIDERS = {
    'categorization': {
        'provider': os.getenv('AI_PROVIDER_CATEGORIZATION', 'deepseek'),
        # ...
    },
    'chat': {
        'provider': os.getenv('AI_PROVIDER_CHAT', 'deepseek'),
        # ...
    },
    'insights': {
        'provider': os.getenv('AI_PROVIDER_INSIGHTS', 'deepseek'),
        # ...
    },
}
```

#### `bot/services/monthly_insights.py` (—Å—Ç—Ä–æ–∫–∏ 35, 286, 414)
**–ò–∑–º–µ–Ω–µ–Ω–æ:** –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `provider` —Å `'google'` –Ω–∞ `'deepseek'` –≤ —Ç—Ä—ë—Ö –º–µ—Ç–æ–¥–∞—Ö:
- `_initialize_ai(self, provider: str = 'deepseek')`
- `_generate_ai_insights(..., provider: str = 'deepseek')`
- `generate_insight(..., provider: str = 'deepseek')`

#### `bot/services/notifications.py` (—Å—Ç—Ä–æ–∫–∞ 57)
**–ò–∑–º–µ–Ω–µ–Ω–æ:** –ü—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Å–∞–π—Ç–æ–≤ —Å `'google'` –Ω–∞ `'deepseek'`

```python
# –ë–´–õ–û:
insight = await insights_service.generate_insight(
    profile=profile,
    year=report_year,
    month=report_month,
    provider='google',  # ‚ùå
    force_regenerate=False
)

# –°–¢–ê–õ–û:
insight = await insights_service.generate_insight(
    profile=profile,
    year=report_year,
    month=report_month,
    provider='deepseek',  # ‚úÖ
    force_regenerate=False
)
```

#### `expense_bot/celery_tasks.py` (—Å—Ç—Ä–æ–∫–∏ 138-143)
**–ò–∑–º–µ–Ω–µ–Ω–æ:** –§–æ–ª–±–µ–∫ —Å Google –Ω–∞ DeepSeek

```python
# –ë–´–õ–û:
insights_provider = os.getenv('AI_PROVIDER_INSIGHTS') or os.getenv('AI_PROVIDER_DEFAULT') or 'google'
valid_providers = {'google', 'openai', 'deepseek', 'qwen'}
if insights_provider not in valid_providers:
    logger.warning(f"Unknown AI provider for insights: {insights_provider}, falling back to google")
    insights_provider = 'google'

# –°–¢–ê–õ–û:
insights_provider = os.getenv('AI_PROVIDER_INSIGHTS') or os.getenv('AI_PROVIDER_DEFAULT') or 'deepseek'
valid_providers = {'google', 'openai', 'deepseek', 'qwen', 'openrouter'}
if insights_provider not in valid_providers:
    logger.warning(f"Unknown AI provider for insights: {insights_provider}, falling back to deepseek")
    insights_provider = 'deepseek'
```

#### `.env` (—Å—Ç—Ä–æ–∫–∞ 59)
**–ò–∑–º–µ–Ω–µ–Ω–æ:** –§–æ–ª–±–µ–∫ –¥–ª—è –∏–Ω—Å–∞–π—Ç–æ–≤ —Å `qwen` –Ω–∞ `openrouter`

```bash
# –ë–´–õ–û:
AI_FALLBACK_INSIGHTS=qwen

# –°–¢–ê–õ–û:
AI_FALLBACK_INSIGHTS=openrouter
```

---

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `disable_functions` –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è function calling

#### `bot/services/unified_ai_service.py` (—Å—Ç—Ä–æ–∫–∏ 159-182, 289-351)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
1. –ü–∞—Ä–∞–º–µ—Ç—Ä `disable_functions: bool = False` –≤ –º–µ—Ç–æ–¥ `chat()`
2. –ù–æ–≤—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥ `_simple_chat()` –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ AI –±–µ–∑ Intent Recognition

```python
async def chat(
    self,
    message: str,
    context: List[Dict[str, str]],
    user_context: Optional[Dict[str, Any]] = None,
    disable_functions: bool = False  # ‚Üê –ù–û–í–´–ô –ü–ê–†–ê–ú–ï–¢–†
) -> str:
    """
    –ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π (—á–µ—Ä–µ–∑ —ç–º—É–ª—è—Ü–∏—é FUNCTION_CALL)

    Args:
        message: User message
        context: Conversation context
        user_context: User metadata (user_id, language)
        disable_functions: If True, skip function calling and use simple chat
    """
    user_id = user_context.get('user_id') if user_context else None
    user_language = user_context.get('language', 'ru') if user_context else 'ru'

    try:
        # Skip function calling if disabled
        if disable_functions:
            # Direct chat without function calling
            return await self._simple_chat(message, context, user_id)

        # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å function calling
```

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `_simple_chat()`:**
```python
async def _simple_chat(
    self,
    message: str,
    context: List[Dict[str, str]],
    user_id: Optional[int] = None
) -> str:
    """
    Simple chat without function calling - just direct AI response

    Args:
        message: User message
        context: Conversation context
        user_id: Optional user ID for logging

    Returns:
        AI response text
    """
    model_name = get_model('chat', self.provider_name)
    client, key_index = self._get_client()

    start_time = time.time()

    # Build messages without Intent Recognition
    messages = [
        {"role": "system", "content": "–¢—ã - —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –±–æ—Ç–µ –¥–ª—è —É—á–µ—Ç–∞ –ª–∏—á–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –¥–æ—Ö–æ–¥–æ–≤."}
    ]
    if context:
        for msg in context[-10:]:
            messages.append({"role": msg['role'], "content": msg['content']})
    messages.append({"role": "user", "content": message})

    try:
        response = await asyncio.to_thread(
            client.chat.completions.create,
            model=model_name,
            messages=messages,
            temperature=0.7,
            max_tokens=2000
        )
        # Request —É—Å–ø–µ—à–µ–Ω - –∫–ª—é—á —Ä–∞–±–æ—á–∏–π
        if self.api_key_mixin:
            self.api_key_mixin.mark_key_success(key_index)

    except Exception as api_error:
        # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ API, –ø–æ–º–µ—á–∞–µ–º –∫–ª—é—á –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π
        if self.api_key_mixin:
            self.api_key_mixin.mark_key_failure(key_index, api_error)
        raise api_error

    response_time = time.time() - start_time
    response_text = response.choices[0].message.content.strip()

    self._log_metrics(
        operation='simple_chat',
        response_time=response_time,
        success=True,
        model=model_name,
        input_len=len(message),
        tokens=response.usage.total_tokens if hasattr(response, 'usage') else None,
        user_id=user_id
    )

    return response_text
```

#### `bot/services/monthly_insights.py` (—Å—Ç—Ä–æ–∫–∏ 310-317)

**–ò–∑–º–µ–Ω–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `disable_functions=True` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ AI

```python
# –ë–´–õ–û:
if provider == 'google':
    response = await self.ai_service.chat(
        message=prompt,
        context=[],
        user_context={'user_id': profile.telegram_id}
    )
else:
    response = await self.ai_service.chat(
        message=prompt,
        context=[],
        user_context={'user_id': profile.telegram_id}
    )

# –°–¢–ê–õ–û:
# Call AI service with function calling disabled
# (insights generation requires JSON response, not function calls)
response = await self.ai_service.chat(
    message=prompt,
    context=[],
    user_context={'user_id': profile.telegram_id},
    disable_functions=True  # ‚Üê –í–ê–ñ–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º function calling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è JSON
)
```

---

### 3. –°–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### `bot/services/notifications.py` (—Å—Ç—Ä–æ–∫–∏ 61-92)

**–ò–∑–º–µ–Ω–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–Ω—Å–∞–π—Ç–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```python
# –ë–´–õ–û:
if insight:
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∏–Ω—Å–∞–π—Ç–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫ caption
    user_lang = profile.language_code or 'ru'
    insight_text = self._format_insight_text(insight, report_month, report_year, user_lang)
    full_caption = f"{caption}\n\n{insight_text}\n\nüí° <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</i>"
    # ...
else:
    caption += "\n\nüí° <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</i>"

except Exception as e:
    logger.error(f"Error generating insights for user {user_id}: {e}")
    caption += "\n\nüí° <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</i>"

# –°–¢–ê–õ–û:
if insight and insight.ai_summary and not insight.ai_summary.startswith("–ò–∑–≤–∏–Ω–∏—Ç–µ"):
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∏–Ω—Å–∞–π—Ç–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫ caption
    # –í–ê–ñ–ù–û: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å–∞–π—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö)
    user_lang = profile.language_code or 'ru'
    insight_text = self._format_insight_text(insight, report_month, report_year, user_lang)
    full_caption = f"{caption}\n\n{insight_text}\n\nüí° <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</i>"
    # ...
    logger.info(f"Monthly insights generated for user {user_id} for {report_year}-{report_month:02d}")
else:
    # –ò–Ω—Å–∞–π—Ç –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫—É - –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    caption += "\n\nüí° <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</i>"
    if insight:
        logger.warning(f"Insight exists but contains error message for user {user_id} for {report_year}-{report_month:02d}")
    else:
        logger.info(f"No insights generated for user {user_id} for {report_year}-{report_month:02d} (not enough data)")

except Exception as e:
    # –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Å–∞–π—Ç–æ–≤ - –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    logger.error(f"Error generating insights for user {user_id}: {e}")
    caption += "\n\nüí° <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</i>"
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ï—Å–ª–∏ –∏–Ω—Å–∞–π—Ç –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫—É - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –Ω–µ –≤–∏–¥–∏—Ç AI –∞–Ω–∞–ª–∏–∑, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç—á—ë—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.

---

### 4. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–æ–ª–µ–µ –º–æ—â–Ω—É—é –º–æ–¥–µ–ª—å DeepSeek Reasoner

**‚ö†Ô∏è –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:** –ü—Ä–∏–º–µ—Ä—ã –Ω–∏–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –î–û –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è Google (1 –¥–µ–∫–∞–±—Ä—è 2025). –í –∞–∫—Ç—É–∞–ª—å–Ω–æ–º –∫–æ–¥–µ Google –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - —Å–º. —Ä–∞–∑–¥–µ–ª "[–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ Google AI –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞](#-–ø–æ–ª–Ω–æ–µ-—É–¥–∞–ª–µ–Ω–∏–µ-google-ai-–∏–∑-–ø—Ä–æ–µ–∫—Ç–∞-1-–¥–µ–∫–∞–±—Ä—è-2025)".

#### `bot/services/ai_selector.py` (—Å—Ç—Ä–æ–∫–∞ 41)

**–ò–∑–º–µ–Ω–µ–Ω–æ:** –ú–æ–¥–µ–ª—å –¥–ª—è insights —Å `deepseek-chat` –Ω–∞ `deepseek-reasoner`

```python
# –ë–´–õ–û:
'insights': {
    'provider': os.getenv('AI_PROVIDER_INSIGHTS', 'deepseek'),
    'model': {
        'google': os.getenv('GOOGLE_MODEL_INSIGHTS', 'gemini-2.5-flash'),
        'openai': os.getenv('OPENAI_MODEL_INSIGHTS', 'gpt-4o-mini'),
        'deepseek': os.getenv('DEEPSEEK_MODEL_INSIGHTS', 'deepseek-chat'),  # ‚ùå
        'qwen': os.getenv('QWEN_MODEL_INSIGHTS', 'qwen-plus'),
        'openrouter': os.getenv('OPENROUTER_MODEL_INSIGHTS', OPENROUTER_DEFAULT_MODEL)
    }
},

# –°–¢–ê–õ–û:
'insights': {
    'provider': os.getenv('AI_PROVIDER_INSIGHTS', 'deepseek'),
    'model': {
        'google': os.getenv('GOOGLE_MODEL_INSIGHTS', 'gemini-2.5-flash'),
        'openai': os.getenv('OPENAI_MODEL_INSIGHTS', 'gpt-4o-mini'),
        'deepseek': os.getenv('DEEPSEEK_MODEL_INSIGHTS', 'deepseek-reasoner'),  # ‚úÖ
        'qwen': os.getenv('QWEN_MODEL_INSIGHTS', 'qwen-plus'),
        'openrouter': os.getenv('OPENROUTER_MODEL_INSIGHTS', OPENROUTER_DEFAULT_MODEL)
    }
},
```

#### `.env` (—Å—Ç—Ä–æ–∫–∏ 73-77)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π DeepSeek —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Model selection for DeepSeek
DEEPSEEK_MODEL_CATEGORIZATION=deepseek-chat
DEEPSEEK_MODEL_CHAT=deepseek-chat
DEEPSEEK_MODEL_DEFAULT=deepseek-chat
DEEPSEEK_MODEL_INSIGHTS=deepseek-reasoner  # ‚Üê –ë–æ–ª–µ–µ –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
```

**–£–¥–∞–ª–µ–Ω–æ:** –î—É–±–ª–∏–∫–∞—Ç—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 97-100 –≤ —Å—Ç–∞—Ä–æ–º `.env`)

**–ü–æ—á–µ–º—É Reasoner –ª—É—á—à–µ –¥–ª—è –∏–Ω—Å–∞–π—Ç–æ–≤:**
- üß† –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- üìä –õ—É—á—à–µ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã
- üí° –ë–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚ö° –ü—Ä–∏–µ–º–ª–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –Ω–æ—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞)

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: `test_monthly_insights_local.py`

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- User 1: `7967547829` (3 —Ç—Ä–∞—Ç—ã, 1,350 ‚ÇΩ, —è–∑—ã–∫: EN)
- User 2: `881292737` (108 —Ç—Ä–∞—Ç, 1,563,248 ‚ÇΩ, —è–∑—ã–∫: RU)

**–ü–µ—Ä–∏–æ–¥:** –ù–æ—è–±—Ä—å 2025

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç User 1 (7967547829)

```
‚úÖ Profile found: ID=306, Lang=en
üîÑ Generating insights (provider=deepseek)...
INFO Initialized AI service: deepseek with model deepseek-reasoner  ‚Üê ‚úÖ REASONER!
INFO [DeepSeekKeyRotationMixin] Using API key #1 of 2
INFO HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO Updated insight for 7967547829 11/2025

‚úÖ Insight generated successfully!
   - Total expenses: 1350.00
   - Total incomes: 0
   - Expenses count: 3
   - AI provider: deepseek
   - AI model: deepseek-reasoner  ‚Üê ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û!

   üìù AI Summary:
   –ó–∞ –Ω–æ—è–±—Ä—å –≤—ã –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ 1350 ‚ÇΩ, —Å–æ–≤–µ—Ä—à–∏–≤ –≤—Å–µ–≥–æ 3 —Ç—Ä–∞—Ç—ã.

   üìä AI Analysis:
   ‚Ä¢ –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: üçΩÔ∏è Cafes and Restaurants (1350‚ÇΩ, 100%)
   ‚Ä¢ –ù–µ–æ–±—ã—á–Ω–∞—è —Ç—Ä–∞—Ç–∞: –í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–∏—à–ª–∏—Å—å –Ω–∞ –∫–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
   ‚Ä¢ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–æ –Ω–∞ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —á—ë—Ç–∫–∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö
```

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç User 2 (881292737)

```
‚úÖ Profile found: ID=1, Lang=ru
üîÑ Generating insights (provider=deepseek)...
INFO [DeepSeekKeyRotationMixin] Using API key #2 of 2
INFO HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO Updated insight for 881292737 11/2025

‚úÖ Insight generated successfully!
   - Total expenses: 1563248.00
   - Total incomes: 17055.00
   - Expenses count: 108
   - AI provider: deepseek
   - AI model: deepseek-reasoner  ‚Üê ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û!

   üìù AI Summary:
   –í –Ω–æ—è–±—Ä–µ –≤—ã –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ 1 563 248 ‚ÇΩ, —á—Ç–æ –Ω–∞ 486% –±–æ–ª—å—à–µ, —á–µ–º –≤ –æ–∫—Ç—è–±—Ä–µ.
   –ü—Ä–∏ —ç—Ç–æ–º –¥–æ—Ö–æ–¥—ã —Å–æ—Å—Ç–∞–≤–∏–ª–∏ –≤—Å–µ–≥–æ 17 055 ‚ÇΩ, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º—É
   –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É –±–∞–ª–∞–Ω—Å—É.

   üìä AI Analysis:
   ‚Ä¢ –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: üéÅ –ü–æ–¥–∞—Ä–∫–∏ (1 204 300 ‚ÇΩ, 77.0%) ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä —Ä–æ—Å—Ç–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
   ‚Ä¢ –†–∞—Å—Ö–æ–¥—ã –≤—ã—Ä–æ—Å–ª–∏ –Ω–∞ 486.2% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–∫—Ç—è–±—Ä—ë–º (—Å 266 696 ‚ÇΩ –¥–æ 1 563 248 ‚ÇΩ)
   ‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞—Ç: 108 (–±—ã–ª–æ 88), —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ –≤—ã—Ä–æ—Å —Å 3 030 ‚ÇΩ –¥–æ 14 474 ‚ÇΩ
```

### üéØ –ö–ª—é—á–µ–≤—ã–µ —É—Å–ø–µ—Ö–∏ —Ç–µ—Å—Ç–∞:

‚úÖ **DeepSeek Reasoner –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** (–Ω–µ deepseek-chat, –Ω–µ Google)
‚úÖ **–†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç** (–∫–ª—é—á #1 –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ, –∫–ª—é—á #2 –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ)
‚úÖ **JSON –ø–∞—Ä—Å–∏—Ç—Å—è —É—Å–ø–µ—à–Ω–æ** (–Ω–µ—Ç –æ—à–∏–±–æ–∫ `Failed to parse AI response as JSON`)
‚úÖ **–ò–Ω—Å–∞–π—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑** –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —è–∑—ã–∫–µ (RU/EN)
‚úÖ **–î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ** (—Å—É–º–º—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞—Ç, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
‚úÖ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –º–µ—Å—è—Ü–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç** (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #2)
‚úÖ **–§—É–Ω–∫—Ü–∏–∏ –ù–ï –≤—ã–∑—ã–≤–∞—é—Ç—Å—è** (`disable_functions=True` —Ä–∞–±–æ—Ç–∞–µ—Ç)
‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã—à–µ** (Reasoner –¥–∞—ë—Ç –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–µ –∏–Ω—Å–∞–π—Ç—ã)

---

## üì¶ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–¥–ª—è –∫–æ–º–º–∏—Ç–∞)

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. ‚úÖ `bot/services/ai_selector.py` - —É–±—Ä–∞–Ω Google –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç, –¥–æ–±–∞–≤–ª–µ–Ω deepseek-reasoner –¥–ª—è insights
2. ‚úÖ `bot/services/monthly_insights.py` - –¥–æ–±–∞–≤–ª–µ–Ω `disable_functions=True`
3. ‚úÖ `bot/services/unified_ai_service.py` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `disable_functions` –∏ –º–µ—Ç–æ–¥ `_simple_chat()`
4. ‚úÖ `bot/services/notifications.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–∫—Ä—ã—Ç–∏–µ –æ—à–∏–±–æ–∫, –∏–∑–º–µ–Ω—ë–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å google –Ω–∞ deepseek
5. ‚úÖ `expense_bot/celery_tasks.py` - —Ñ–æ–ª–±–µ–∫ —Å Google –Ω–∞ DeepSeek
6. ‚úÖ `.env` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è DeepSeek –º–æ–¥–µ–ª–µ–π, –∏–∑–º–µ–Ω—ë–Ω —Ñ–æ–ª–±–µ–∫ —Å qwen –Ω–∞ openrouter

**–£–¥–∞–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ –∞—Ä—Ö–∏–≤):**
7. ‚úÖ `bot/services/ai_categorization.py` ‚Üí `archive_20251201/` (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥)
8. ‚úÖ `bot/services/income_categorization.py` ‚Üí `archive_20251201/` (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥)

**–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å):**
- `test_monthly_insights_local.py` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `show_insights.py` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Å–∞–π—Ç–æ–≤ –≤ –ë–î
- `MONTHLY_INSIGHTS_FIX_REPORT.md` - —ç—Ç–æ—Ç –æ—Ç—á—ë—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç (–û–ë–ù–û–í–õ–Å–ù–ù–ê–Ø –í–ï–†–°–ò–Ø - —Å –ø–æ–ª–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º Google)

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã git –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "[–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ Google AI –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞](#-–ø–æ–ª–Ω–æ–µ-—É–¥–∞–ª–µ–Ω–∏–µ-google-ai-–∏–∑-–ø—Ä–æ–µ–∫—Ç–∞-1-–¥–µ–∫–∞–±—Ä—è-2025)" –≤—ã—à–µ, –∫–æ—Ç–æ—Ä—ã–µ –≤–∫–ª—é—á–∞—é—Ç:
- –£–¥–∞–ª–µ–Ω–∏–µ 12 —Ñ–∞–π–ª–æ–≤ Google AI —Å–µ—Ä–≤–∏—Å–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ GoogleKeyRotationMixin
- –£–¥–∞–ª–µ–Ω–∏–µ GOOGLE_* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ .env –∏ settings.py
- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è monthly insights

**–ö–æ–º–∞–Ω–¥—ã git:**
```bash
git status
git add bot/services/ai_selector.py
git add bot/services/key_rotation_mixin.py
git add bot/services/monthly_insights.py
git add bot/services/unified_ai_service.py
git add bot/services/notifications.py
git add .env
git add expense_bot/settings.py
git add MONTHLY_INSIGHTS_FIX_REPORT.md

# –î–æ–±–∞–≤–ª—è–µ–º –∞—Ä—Ö–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã (14 —Ñ–∞–π–ª–æ–≤ —É–¥–∞–ª–µ–Ω—ã)
git add archive_20251201/
git rm bot/services/google_ai_service*.py
git rm bot/services/gemini_ai_service.py
git rm bot/services/ai_categorization.py
git rm bot/services/income_categorization.py

git commit -m "Remove Google AI completely + fix monthly insights with DeepSeek Reasoner

- Moved 12 Google AI service variants to archive_20251201/
- Removed Google from AI_PROVIDERS in ai_selector.py
- Removed GoogleKeyRotationMixin from key_rotation system
- Removed all GOOGLE_* env variables and settings
- Changed default provider from 'google' to 'deepseek'
- Exception: kept OPENROUTER_MODEL_VOICE=google/gemini-2.5-flash (works via proxy)
- Fixed monthly insights to use deepseek-reasoner instead of deepseek-chat
- Added disable_functions parameter to avoid function calling for insights
- Hidden error messages from users (graceful degradation)

Google AI is blocked in Russia (400 error). DeepSeek/Qwen are stable alternatives.

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
git push origin master
```

**–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–º–º–∏—Ç–∞ (–ë–ï–ó –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è Google, —Ç–æ–ª—å–∫–æ insights fix):**
<details>
<summary>–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–£–°–¢–ê–†–ï–í–®–ò–ô)</summary>

```bash
# –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
git add bot/services/ai_selector.py
git add bot/services/monthly_insights.py
git add bot/services/unified_ai_service.py
git add bot/services/notifications.py
git add expense_bot/celery_tasks.py
git add .env

# –î–æ–±–∞–≤–ª—è–µ–º –∞—Ä—Ö–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã (—É–¥–∞–ª—ë–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã)
git add archive_20251201/
git rm bot/services/ai_categorization.py
git rm bot/services/income_categorization.py

git commit -m "$(cat <<'EOF'
Fix monthly insights: remove Google AI, use DeepSeek Reasoner, cleanup legacy code

–ü–†–û–ë–õ–ï–ú–´:
1. Google AI –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫—É 400 (–≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
2. DeepSeek –≤—ã–∑—ã–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JSON –¥–ª—è –∏–Ω—Å–∞–π—Ç–æ–≤
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Å–ª–∞–±–∞—è –º–æ–¥–µ–ª—å deepseek-chat –≤–º–µ—Å—Ç–æ deepseek-reasoner

–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
1. –£–¥–∞–ª—ë–Ω Google –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (4 —Ñ–∞–π–ª–∞)
   - ai_selector.py: –≤—Å–µ –¥–µ—Ñ–æ–ª—Ç—ã —Å 'google' –Ω–∞ 'deepseek'
   - monthly_insights.py: provider='deepseek' –≤–º–µ—Å—Ç–æ 'google'
   - notifications.py: provider='deepseek' –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Å–∞–π—Ç–æ–≤
   - celery_tasks.py: fallback —Å Google –Ω–∞ DeepSeek

2. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä disable_functions –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è function calling
   - unified_ai_service.py: –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä disable_functions –≤ chat()
   - unified_ai_service.py: –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ _simple_chat() –±–µ–∑ Intent Recognition
   - monthly_insights.py: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è disable_functions=True

3. –°–∫—Ä—ã—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - notifications.py: –ø—Ä–æ–≤–µ—Ä–∫–∞ insight.ai_summary.startswith("–ò–∑–≤–∏–Ω–∏—Ç–µ")
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –≤–∏–¥–∏—Ç AI –∞–Ω–∞–ª–∏–∑, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –æ—Ç—á—ë—Ç–∞

4. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ DeepSeek Reasoner –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞
   - ai_selector.py: deepseek-reasoner –¥–ª—è insights (–≤–º–µ—Å—Ç–æ deepseek-chat)
   - .env: –¥–æ–±–∞–≤–ª–µ–Ω—ã DEEPSEEK_MODEL_* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏
   - .env: DEEPSEEK_MODEL_INSIGHTS=deepseek-reasoner

5. –ò–∑–º–µ–Ω—ë–Ω fallback chain –¥–ª—è insights
   - .env: AI_FALLBACK_INSIGHTS —Å qwen –Ω–∞ openrouter

6. –£–¥–∞–ª—ë–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥ AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ü–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ archive_20251201/:
     * bot/services/ai_categorization.py (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π AIConfig.OPENAI_MODEL/GOOGLE_MODEL)
     * bot/services/income_categorization.py (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
   - –ü—Ä–∏—á–∏–Ω–∞: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ production, –∑–∞–º–µ–Ω–µ–Ω—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π ai_selector.py

–†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö (7967547829, 881292737)
- ‚úÖ DeepSeek Reasoner –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ JSON –ø–∞—Ä—Å–∏—Ç—Å—è —É—Å–ø–µ—à–Ω–æ (–Ω–µ—Ç –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º–∞—Ç–∞)
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–ª—é—á #1, #2)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∏–Ω—Å–∞–π—Ç–æ–≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –º–µ—Å—è—Ü–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å–∫—Ä—ã—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```
</details>
```

### 2. –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh batman@176.124.218.53

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd /home/batman/expense_bot && git pull origin master

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose restart bot celery celery-beat

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs --tail=100 celery | grep "insights"
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–µ–≥–æ 1-–≥–æ —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–∞ (–∏–ª–∏ –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∞)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç—á—ë—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Å DeepSeek Reasoner –∞–Ω–∞–ª–∏–∑–æ–º
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞ (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è)

### –°—Ç–∞—Ä–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å –ø—Ä–æ–±–ª–µ–º–æ–π):
```
Monthly Insights Task
  ‚Üì
monthly_insights.py (provider='google' —Ö–∞—Ä–¥–∫–æ–¥)
  ‚Üì
UnifiedAIService.chat()
  ‚Üì
Intent Recognition ‚Üí DeepSeek –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏
  ‚Üì
ResponseFormatter —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç HTML
  ‚Üì
‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON (–ø–æ–ª—É—á–∏–ª–∏ HTML –≤–º–µ—Å—Ç–æ JSON)
  ‚Üì
‚ùå –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"
  ‚Üì
‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É –≤ Telegram
```

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞):
```
Monthly Insights Task
  ‚Üì
monthly_insights.py (provider='deepseek', model='deepseek-reasoner')
  ‚Üì
UnifiedAIService.chat(disable_functions=True)
  ‚Üì
_simple_chat() - –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ DeepSeek Reasoner –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–π
  ‚Üì
DeepSeek Reasoner –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º
  ‚Üì
‚úÖ JSON –ø–∞—Ä—Å–∏—Ç—Å—è —É—Å–ø–µ—à–Ω–æ ‚Üí –∏–Ω—Å–∞–π—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
  ‚Üì
notifications.py –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: insight.ai_summary.startswith("–ò–∑–≤–∏–Ω–∏—Ç–µ")
  ‚Üì
‚úÖ –ï—Å–ª–∏ –∏–Ω—Å–∞–π—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
‚úÖ –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º AI –∞–Ω–∞–ª–∏–∑, —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏ –æ—Ç—á—ë—Ç–∞
```

---

## üéì –£—Ä–æ–∫–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

### 1. **–ù–ï —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ –∫–æ–¥–µ**
- ‚ùå **–ë–´–õ–û:** `provider='google'` –≤ 4 —Ñ–∞–π–ª–∞—Ö
- ‚úÖ **–°–¢–ê–õ–û:** `provider=os.getenv('AI_PROVIDER_INSIGHTS', 'deepseek')`
- –î–µ—Ñ–æ–ª—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π

### 2. **–†–∞–∑–¥–µ–ª—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI**
- **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:** function calling –Ω—É–∂–µ–Ω ‚úÖ (get_expenses_list, analytics_query)
- **–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∏–Ω—Å–∞–π—Ç—ã, –∞–Ω–∞–ª–∏–∑):** function calling –º–µ—à–∞–µ—Ç ‚ùå (–Ω—É–∂–µ–Ω —á–∏—Å—Ç—ã–π JSON)
- –†–µ—à–µ–Ω–∏–µ: –ø–∞—Ä–∞–º–µ—Ç—Ä `disable_functions` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏

### 3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω–æ**
- –°–æ–∑–¥–∞–Ω `test_monthly_insights_local.py` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–∞ 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö = –Ω–µ —Å–ø–∞–º–∏–º –≤—Å–µ—Ö
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 4. **Google Gemini API –∏–º–µ–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**
- –í –†–æ—Å—Å–∏–∏ Google AI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ—à–∏–±–∫–∞ 400)
- DeepSeek/OpenRouter —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- **Google –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ (1 –¥–µ–∫–∞–±—Ä—è 2025)** - —Å–º. —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ

### 5. **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**
- Graceful degradation: –µ—Å–ª–∏ –∏–Ω—Å–∞–π—Ç –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –æ—Ç—á—ë—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω
- –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–ª—è –¥–µ–±–∞–≥–∞, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram

### 6. **–í—ã–±–∏—Ä–∞—Ç—å –º–æ–¥–µ–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏**
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è/–ß–∞—Ç:** `deepseek-chat` (–±—ã—Å—Ç—Ä–∞—è, –¥–µ—à—ë–≤–∞—è)
- **–ò–Ω—Å–∞–π—Ç—ã/–ê–Ω–∞–ª–∏–∑:** `deepseek-reasoner` (–º–µ–¥–ª–µ–Ω–Ω–∞—è, –Ω–æ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏

### 7. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ .env**
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `DEEPSEEK_MODEL_CATEGORIZATION`, `DEEPSEEK_MODEL_INSIGHTS` –∏ —Ç.–¥.
- ‚úÖ –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –º–æ–¥–µ–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –†–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á

---

## ‚úÖ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é:**
- ‚úÖ Google AI —É–¥–∞–ª—ë–Ω –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç –≤–µ–∑–¥–µ
- ‚úÖ DeepSeek Reasoner —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∏–Ω—Å–∞–π—Ç–æ–≤
- ‚úÖ –§–æ–ª–±–µ–∫ –Ω–∞ OpenRouter –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Function calling –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
- ‚úÖ JSON –ø–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å–∫—Ä—ã—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ
- ‚úÖ –í—Å—ë –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —á–µ—Ä–µ–∑ `.env`
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä.**

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –≤ .env

```bash
# AI Provider Settings
AI_PROVIDER_CATEGORIZATION=deepseek
AI_PROVIDER_CHAT=deepseek
AI_PROVIDER_DEFAULT=deepseek
AI_PROVIDER_INSIGHTS=deepseek

# Fallback providers
AI_FALLBACK_CATEGORIZATION=openrouter
AI_FALLBACK_CHAT=openrouter
AI_FALLBACK_INSIGHTS=openrouter
AI_FALLBACK_DEFAULT=openrouter

# Model selection for DeepSeek
DEEPSEEK_MODEL_CATEGORIZATION=deepseek-chat      # –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
DEEPSEEK_MODEL_CHAT=deepseek-chat                # –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —á–∞—Ç–∞
DEEPSEEK_MODEL_DEFAULT=deepseek-chat             # –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –º–æ–¥–µ–ª—å
DEEPSEEK_MODEL_INSIGHTS=deepseek-reasoner        # –ú–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
```

### –°–∫–æ—Ä–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**DeepSeek Chat:**
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ~2-5 —Å–µ–∫—É–Ω–¥
- –ö–∞—á–µ—Å—Ç–≤–æ: —Ö–æ—Ä–æ—à–µ–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è, —á–∞—Ç

**DeepSeek Reasoner:**
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ~5-10 —Å–µ–∫—É–Ω–¥
- –ö–∞—á–µ—Å—Ç–≤–æ: –æ—Ç–ª–∏—á–Ω–æ–µ (–≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –º–µ—Å—è—á–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–æ—á—å—é, —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞)

### –°—Ç–æ–∏–º–æ—Å—Ç—å

**DeepSeek Chat:**
- –¶–µ–Ω–∞: $0.14 / 1M input tokens, $0.28 / 1M output tokens
- –°—Ä–µ–¥–Ω–∏–π –∏–Ω—Å–∞–π—Ç: ~500 input + ~300 output = $0.00015

**DeepSeek Reasoner:**
- –¶–µ–Ω–∞: $0.55 / 1M input tokens, $2.19 / 1M output tokens
- –°—Ä–µ–¥–Ω–∏–π –∏–Ω—Å–∞–π—Ç: ~500 input + ~300 output = $0.00093

**–†–∞–∑–Ω–∏—Ü–∞:** ~$0.00078 –∑–∞ –∏–Ω—Å–∞–π—Ç (–ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 6 —Ä–∞–∑ –¥–æ—Ä–æ–∂–µ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ)

**–î–ª—è 100 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –º–µ—Å—è—Ü:**
- DeepSeek Chat: $0.015
- DeepSeek Reasoner: $0.093

–†–∞–∑–Ω–∏—Ü–∞ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è, –∫–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≥–æ —Å—Ç–æ–∏—Ç! ‚úÖ

---

## üßπ –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞ (1 –¥–µ–∫–∞–±—Ä—è 2025)

### –ü—Ä–æ–±–ª–µ–º–∞: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏

–í –ø—Ä–æ–µ–∫—Ç–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ñ–∞–π–ª—ã —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –ø–æ–¥—Ö–æ–¥–æ–º –∫ AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ **–ù–ï –ò–°–ü–û–õ–¨–ó–£–Æ–¢–°–Ø** –≤ production:

**–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã:**
- `bot/services/ai_categorization.py` (384 —Å—Ç—Ä–æ–∫–∏)
- `bot/services/income_categorization.py`

### –ü–æ—á–µ–º—É —ç—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥:

#### 1. –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π

**–£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥ (ai_categorization.py —Å—Ç—Ä–æ–∫–∏ 43-44):**
```python
class AIConfig:
    OPENAI_MODEL = os.getenv('OPENAI_MODEL', 'gpt-4o-mini')  # ‚ùå –£—Å—Ç–∞—Ä–µ–ª–æ
    GOOGLE_MODEL = os.getenv('GOOGLE_MODEL', 'gemini-2.5-flash')  # ‚ùå –£—Å—Ç–∞—Ä–µ–ª–æ
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `os.getenv()` –≤–º–µ—Å—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á (categorization, chat, insights)
- –ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å `AISelector` –∏ fallback chain

#### 2. –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏–ª–∞ —Å—Ç–∞—Ä—É—é

**–¢–µ–∫—É—â–∏–π production flow (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):**
```
bot/routers/expense.py
  ‚Üì
bot/utils/expense_parser.py (parse_expense_message)
  ‚Üì
bot/services/ai_selector.py (get_service('categorization'))
  ‚Üì
  ‚îú‚îÄ –î–ï–§–û–õ–¢ ‚Üí DeepSeekService (categorize_expense)
  ‚îÇ            ‚Üì
  ‚îÇ            get_model('categorization', 'deepseek')  # deepseek-chat
  ‚îÇ
  ‚îî‚îÄ FALLBACK ‚Üí GoogleAIService / OpenAIService / etc.
               ‚Üì
               get_model('categorization', 'google/openai/...')

‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —á–µ—Ä–µ–∑ .env (AI_PROVIDER_CATEGORIZATION=deepseek)
```

**–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –ù–ï –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∏–≥–¥–µ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∫–æ–¥–µ:**
```bash
# Grep –ø–æ –ø—Ä–æ–µ–∫—Ç—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ production –∫–æ–¥–µ
from bot.services.ai_categorization import  # –¢–æ–ª—å–∫–æ –≤ –∞—Ä—Ö–∏–≤–∞—Ö –∏ —Ç–µ—Å—Ç–∞—Ö
```

#### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–í–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª `ai_categorization.py` —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤:
- `bot/services/google_ai_service.py` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google AI
- `bot/services/unified_ai_service.py` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π AI —Å–µ—Ä–≤–∏—Å
- `bot/services/ai_selector.py` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π
- `bot/utils/expense_parser.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å AI

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

**–ü–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤ –∞—Ä—Ö–∏–≤ `archive_20251201/`:**
- `bot/services/ai_categorization.py` ‚Üí `archive_20251201/ai_categorization.py`
- `bot/services/income_categorization.py` ‚Üí `archive_20251201/income_categorization.py`

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–¥–∞–ª–µ–Ω–∏—è:

1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–∞–Ω–∏—Ü—ã** - –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ `.env`
2. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã** - –Ω–∞ ~600 —Å—Ç—Ä–æ–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞
3. **–£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** - –≤—Å–µ AI —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ñ–∞–π–ª—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞

### –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π (–£–°–¢–ê–†–ï–í–®–ê–Ø, –î–û —É–¥–∞–ª–µ–Ω–∏—è Google):

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–ï–ó Google - —Å–º. —Ä–∞–∑–¥–µ–ª "[–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ Google AI –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞](#-–ø–æ–ª–Ω–æ–µ-—É–¥–∞–ª–µ–Ω–∏–µ-google-ai-–∏–∑-–ø—Ä–æ–µ–∫—Ç–∞-1-–¥–µ–∫–∞–±—Ä—è-2025)".

```python
# bot/services/ai_selector.py (–°–¢–ê–†–ê–Ø –í–ï–†–°–ò–Ø)
AI_PROVIDERS = {
    'categorization': {
        'provider': os.getenv('AI_PROVIDER_CATEGORIZATION', 'deepseek'),
        'model': {
            'deepseek': os.getenv('DEEPSEEK_MODEL_CATEGORIZATION', 'deepseek-chat'),
            'google': os.getenv('GOOGLE_MODEL_CATEGORIZATION', 'gemini-2.0-flash-exp'),  # ‚ùå –£–î–ê–õ–ï–ù–û
            'openai': os.getenv('OPENAI_MODEL_CATEGORIZATION', 'gpt-4o-mini'),
        }
    },
    'chat': {
        'provider': os.getenv('AI_PROVIDER_CHAT', 'deepseek'),
        'model': {
            'deepseek': os.getenv('DEEPSEEK_MODEL_CHAT', 'deepseek-chat'),
        }
    },
    'insights': {
        'provider': os.getenv('AI_PROVIDER_INSIGHTS', 'deepseek'),
        'model': {
            'deepseek': os.getenv('DEEPSEEK_MODEL_INSIGHTS', 'deepseek-reasoner'),
        }
    }
}
```

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ `.env`** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ, —É–¥–æ–±–Ω–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞! ‚úÖ

---

## üìå –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ Google AI –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ (1 –¥–µ–∫–∞–±—Ä—è 2025)

### –ü—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è:

**Google Gemini API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –†–æ—Å—Å–∏–∏:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 400 –∏–∑-–∑–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–∂–µ –∫–∞–∫ fallback
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Google AI —Å–µ—Ä–≤–∏—Å–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –ø—É—Ç–∞–Ω–∏—Ü—É
- DeepSeek –∏ Qwen —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –†–æ—Å—Å–∏–∏

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ Google AI –∫–æ–¥–∞ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.

### –ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ:

#### 1. –§–∞–π–ª—ã —Å–µ—Ä–≤–∏—Å–æ–≤ Google AI (12 —Ñ–∞–π–ª–æ–≤ ‚Üí archive_20251201/)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- `bot/services/google_ai_service.py` - –±–∞–∑–æ–≤—ã–π Google AI —Å–µ—Ä–≤–∏—Å
- `bot/services/google_ai_service_adaptive.py` - –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
- `bot/services/gemini_ai_service.py` - –ø—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gemini API

**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏:**
- `google_ai_service_async.py` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `google_ai_service_broken.py` - —Å–ª–æ–º–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
- `google_ai_service_complex.py` - —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `google_ai_service_fixed.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- `google_ai_service_isolated.py` - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
- `google_ai_service_lazy.py` - –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- `google_ai_service_old.py` - —Å—Ç–∞—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `google_ai_service_optimized.py` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- `google_ai_service_simple.py` - —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
mkdir -p archive_20251201
mv bot/services/google_ai_service*.py archive_20251201/
mv bot/services/gemini_ai_service.py archive_20251201/
```

#### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ bot/services/ai_selector.py

**–£–¥–∞–ª–µ–Ω–æ:**
- Google –∏–∑ –≤—Å–µ—Ö —Å–ª–æ–≤–∞—Ä–µ–π `AI_PROVIDERS` (categorization, chat, insights, default)
- –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è `GoogleAIService` —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
- Fallback –Ω–∞ Google –º–æ–¥–µ–ª–∏
- –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `'google'` –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `'deepseek'`

**–î–æ:**
```python
OPENROUTER_DEFAULT_MODEL = os.getenv('OPENROUTER_MODEL_DEFAULT', 'google/gemini-2.5-flash')

AI_PROVIDERS = {
    'categorization': {
        'provider': os.getenv('AI_PROVIDER_CATEGORIZATION', 'google'),  # ‚ùå
        'model': {
            'google': os.getenv('GOOGLE_MODEL_CATEGORIZATION', 'gemini-2.5-flash'),  # ‚ùå
            'openai': os.getenv('OPENAI_MODEL_CATEGORIZATION', 'gpt-4o-mini'),
            'deepseek': os.getenv('DEEPSEEK_MODEL_CATEGORIZATION', 'deepseek-chat'),
        }
    },
    # ...
}

# –í AISelector.__new__():
elif provider_type == 'google':  # ‚ùå –£–î–ê–õ–ï–ù–û
    from .google_ai_service_adaptive import GoogleAIService
    cls._instances[provider_type] = GoogleAIService()
```

**–ü–æ—Å–ª–µ:**
```python
OPENROUTER_DEFAULT_MODEL = os.getenv('OPENROUTER_MODEL_DEFAULT', 'deepseek/deepseek-chat')  # ‚úÖ

AI_PROVIDERS = {
    'categorization': {
        'provider': os.getenv('AI_PROVIDER_CATEGORIZATION', 'deepseek'),  # ‚úÖ
        'model': {
            'openai': os.getenv('OPENAI_MODEL_CATEGORIZATION', 'gpt-4o-mini'),
            'deepseek': os.getenv('DEEPSEEK_MODEL_CATEGORIZATION', 'deepseek-chat'),
            'qwen': os.getenv('QWEN_MODEL_CATEGORIZATION', 'qwen-plus'),
            'openrouter': os.getenv('OPENROUTER_MODEL_CATEGORIZATION', OPENROUTER_DEFAULT_MODEL)
        }
    },
    # ...
}

# GoogleAIService –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω –∏–∑ AISelector
```

#### 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ .env

**–£–¥–∞–ª–µ–Ω–æ:**
```bash
# Google AI (Gemini) - ‚ùå –£–î–ê–õ–ï–ù–û
GOOGLE_API_KEY=REDACTED
GOOGLE_API_KEY_1=REDACTED
GOOGLE_API_KEY_2=REDACTED
GOOGLE_API_KEY_3=REDACTED

# Model selection for Google - ‚ùå –£–î–ê–õ–ï–ù–û
GOOGLE_MODEL_CATEGORIZATION=gemini-2.5-flash
GOOGLE_MODEL_CHAT=gemini-2.5-flash
GOOGLE_MODEL_DEFAULT=gemini-2.5-flash
GOOGLE_MODEL_INSIGHTS=gemini-2.5-pro
```

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
```bash
# –ë–´–õ–û:
# Primary provider selection: google, openai, deepseek, qwen

# –°–¢–ê–õ–û:
# Primary provider selection: openai, deepseek, qwen, openrouter
```

**‚ö†Ô∏è –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï - –û–°–¢–ê–í–õ–ï–ù–û:**
```bash
# OpenRouter –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (—á–µ—Ä–µ–∑ proxy –∫ Google)
OPENROUTER_MODEL_VOICE=google/gemini-2.5-flash  # ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–æ!
```

**–ü–æ—á–µ–º—É –æ—Å—Ç–∞–≤–ª–µ–Ω–æ:**
- OpenRouter –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ –ø—Ä–æ–∫—Å–∏ –∫ Google –º–æ–¥–µ–ª—è–º
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –†–æ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ OpenRouter API
- –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≥–æ–ª–æ—Å–∞
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º–æ–π Google API (–∫–æ—Ç–æ—Ä—ã–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)

#### 4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ expense_bot/settings.py

**–£–¥–∞–ª–µ–Ω–æ:**
```python
# –ó–∞–≥—Ä—É–∑–∫–∞ Google API –∫–ª—é—á–µ–π - ‚ùå –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù–û
GOOGLE_API_KEY = os.getenv('GOOGLE_API_KEY')
GOOGLE_API_KEYS = []

# –ó–∞–≥—Ä—É–∂–∞–µ–º Google –∫–ª—é—á–∏ (GOOGLE_API_KEY_1, GOOGLE_API_KEY_2, ...)
for i in range(1, 10):
    key = os.getenv(f'GOOGLE_API_KEY_{i}')
    if key:
        GOOGLE_API_KEYS.append(key)

# –ï—Å–ª–∏ –Ω–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω–∏—á–Ω—ã–π
if not GOOGLE_API_KEYS and GOOGLE_API_KEY:
    GOOGLE_API_KEYS = [GOOGLE_API_KEY]

_settings_logger.debug(f"Loaded Google API keys: {len(GOOGLE_API_KEYS)}")
```

#### 5. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ bot/services/key_rotation_mixin.py

**–£–¥–∞–ª–µ–Ω–æ:**
```python
class GoogleKeyRotationMixin(KeyRotationMixin):  # ‚ùå –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–Å–ù
    """
    –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π mixin –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ Google API –∫–ª—é—á–µ–π.
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–ª—é—á–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Django.
    """

    @classmethod
    def get_api_keys(cls) -> List[str]:
        if hasattr(settings, 'GOOGLE_API_KEYS') and settings.GOOGLE_API_KEYS:
            return settings.GOOGLE_API_KEYS
        return []

    @classmethod
    def get_key_name(cls, key_index: int) -> str:
        return f"GOOGLE_API_KEY_{key_index + 1}"
```

**–û—Å—Ç–∞–≤–ª–µ–Ω—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ):**
- `OpenAIKeyRotationMixin` - —Ä–æ—Ç–∞—Ü–∏—è OpenAI –∫–ª—é—á–µ–π
- `DeepSeekKeyRotationMixin` - —Ä–æ—Ç–∞—Ü–∏—è DeepSeek –∫–ª—é—á–µ–π
- `QwenKeyRotationMixin` - —Ä–æ—Ç–∞—Ü–∏—è Qwen (DashScope) –∫–ª—é—á–µ–π
- `OpenRouterKeyRotationMixin` - —Ä–æ—Ç–∞—Ü–∏—è OpenRouter –∫–ª—é—á–µ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏:** –ö–∞–∂–¥—ã–π mixin –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```python
class DeepSeekKeyRotationMixin(KeyRotationMixin):
    # –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    _key_index: ClassVar[int] = 0
    _key_lock: ClassVar[threading.Lock] = threading.Lock()
    _key_status: ClassVar[Dict[int, Tuple[bool, Optional[datetime]]]] = {}
```

### –ò—Ç–æ–≥–æ —É–¥–∞–ª–µ–Ω–æ:

- **14 —Ñ–∞–π–ª–æ–≤** –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤ `archive_20251201/`:
  - 12 –≤–µ—Ä—Å–∏–π Google AI —Å–µ—Ä–≤–∏—Å–∞
  - 2 —Ñ–∞–π–ª–∞ —Å—Ç–∞—Ä–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)
- **6 —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:**
  - `bot/services/ai_selector.py` - —É–¥–∞–ª—ë–Ω Google –∏–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
  - `bot/services/key_rotation_mixin.py` - —É–¥–∞–ª—ë–Ω GoogleKeyRotationMixin
  - `.env` - —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ GOOGLE_* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–∫—Ä–æ–º–µ OpenRouter voice)
  - `expense_bot/settings.py` - —É–¥–∞–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ Google –∫–ª—é—á–µ–π
  - `bot/services/monthly_insights.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)
  - `bot/services/notifications.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):**
1. **DeepSeek** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á)
   - –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è: `deepseek-chat`
   - –ò–Ω—Å–∞–π—Ç—ã: `deepseek-reasoner`
   - –î–æ—Å—Ç—É–ø–µ–Ω –≤ –†–æ—Å—Å–∏–∏, —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. **Qwen** (DashScope, —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä)
   - –ú–æ–¥–µ–ª—å: `qwen-plus`
   - –ö–∏—Ç–∞–π—Å–∫–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –†–æ—Å—Å–∏–∏

3. **OpenRouter** (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏)
   - –î–ª—è –≥–æ–ª–æ—Å–∞: `google/gemini-2.5-flash` (—á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏!)
   - Fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á

4. **OpenAI** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –¥–æ—Ä–æ–≥–æ–π)
   - –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è: `gpt-4o-mini`
   - –ò–Ω—Å–∞–π—Ç—ã: `gpt-4o`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):

```bash
# Primary provider selection
AI_PROVIDER_CATEGORIZATION=deepseek
AI_PROVIDER_CHAT=deepseek
AI_PROVIDER_DEFAULT=deepseek
AI_PROVIDER_INSIGHTS=deepseek

# Fallback providers (–¢–û–õ–¨–ö–û –û–î–ò–ù fallback!)
AI_FALLBACK_CATEGORIZATION=openrouter
AI_FALLBACK_CHAT=openrouter
AI_FALLBACK_INSIGHTS=openrouter
AI_FALLBACK_DEFAULT=openrouter

# DeepSeek models
DEEPSEEK_MODEL_CATEGORIZATION=deepseek-chat
DEEPSEEK_MODEL_CHAT=deepseek-chat
DEEPSEEK_MODEL_DEFAULT=deepseek-chat
DEEPSEEK_MODEL_INSIGHTS=deepseek-reasoner

# OpenRouter (–¥–ª—è –≥–æ–ª–æ—Å–∞ –∏ fallback)
OPENROUTER_API_KEY=sk-or-v1-***
OPENROUTER_MODEL_VOICE=google/gemini-2.5-flash  # ‚úÖ –ß–µ—Ä–µ–∑ proxy!
```

### Git commit –¥–ª—è –¥–µ–ø–ª–æ—è:

```bash
git status
git add bot/services/ai_selector.py
git add bot/services/key_rotation_mixin.py
git add .env
git add expense_bot/settings.py
git add MONTHLY_INSIGHTS_FIX_REPORT.md
git commit -m "Remove Google AI completely from project

- Moved 12 Google AI service variants to archive_20251201/
- Removed Google from AI_PROVIDERS in ai_selector.py
- Removed GoogleKeyRotationMixin from key_rotation system
- Removed all GOOGLE_* env variables and settings
- Changed default provider from 'google' to 'deepseek'
- Exception: kept OPENROUTER_MODEL_VOICE=google/gemini-2.5-flash (works via proxy)

Google AI is blocked in Russia (400 error). DeepSeek/Qwen are stable alternatives.

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
git push origin master
```

---
