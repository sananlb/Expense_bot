# üîó –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Telegram Webhook

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ü—Ä–æ–±–ª–µ–º–∞](#–ø—Ä–æ–±–ª–µ–º–∞)
2. [–ü—Ä–∏—á–∏–Ω–∞](#–ø—Ä–∏—á–∏–Ω–∞)
3. [–†–µ—à–µ–Ω–∏–µ](#—Ä–µ—à–µ–Ω–∏–µ)
4. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
5. [–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#—Ä—É—á–Ω–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
6. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å—Ç–∞—Ç—É—Å–∞)
7. [Troubleshooting](#troubleshooting)

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

### –°–∏–º–ø—Ç–æ–º—ã:
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∞: `Failed to resolve host: Temporary failure in name resolution`
- Webhook URL –ø—É—Å—Ç–æ–π –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —á–µ—Ä–µ–∑ `getWebhookInfo`

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `docker-compose down && docker-compose up -d`
2. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ
3. –í `bot/main.py` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook:
   ```python
   await bot.set_webhook(f"{webhook_url}{webhook_path}")
   ```
4. **–ù–û** DNS –µ—â–µ –Ω–µ —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è / —Ä–µ–∑–æ–ª–≤–∏—Ç—å—Å—è
5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook **–ü–ê–î–ê–ï–¢** —Å –æ—à–∏–±–∫–æ–π DNS
6. Webhook –æ—Å—Ç–∞–µ—Ç—Å—è **–ü–£–°–¢–´–ú**
7. –ë–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram

---

## üîç –ü—Ä–∏—á–∏–Ω–∞

### –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã - DNS Timing Issue:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1. docker-compose down      ‚Üí –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã    ‚îÇ
‚îÇ 2. docker-compose build     ‚Üí –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤        ‚îÇ
‚îÇ 3. docker-compose up -d     ‚Üí –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤        ‚îÇ
‚îÇ 4. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä app —Å—Ç–∞—Ä—Ç—É–µ—Ç (0-2 —Å–µ–∫)                    ‚îÇ
‚îÇ 5. bot/main.py –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (2-3 —Å–µ–∫)                   ‚îÇ
‚îÇ 6. –ü–æ–ø—ã—Ç–∫–∞ bot.set_webhook()                           ‚îÇ
‚îÇ    ‚îú‚îÄ DNS –∑–∞–ø—Ä–æ—Å: expensebot.duckdns.org               ‚îÇ
‚îÇ    ‚îú‚îÄ ‚ùå DNS –ù–ï –†–ï–ó–û–õ–í–ò–¢–°–Ø                             ‚îÇ
‚îÇ    ‚îî‚îÄ ‚ùå Webhook –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω                         ‚îÇ
‚îÇ 7. –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω, –Ω–æ –ù–ï –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –§–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É:
1. **DNS –∫–µ—à:** —Å–∏—Å—Ç–µ–º–Ω—ã–π DNS resolver –∫–µ—à–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
2. **DuckDNS –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π
3. **Docker —Å–µ—Ç—å:** –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ DNS –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ
4. **Timing:** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç –±—ã—Å—Ç—Ä–µ–µ —á–µ–º —É—Å–ø–µ–≤–∞–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è DNS

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ú—ã –¥–æ–±–∞–≤–∏–ª–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É webhook** —Å retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –≤ —Å–∫—Ä–∏–ø—Ç `scripts/full_update.sh`:

```bash
# –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:
1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
3. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
4. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
5. ‚è≥ –û–ñ–ò–î–ê–ù–ò–ï 10 —Å–µ–∫—É–Ω–¥ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è)
6. üîó –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø —É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook —Å retry
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```

---

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±):

```bash
cd /home/batman/expense_bot && bash update.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò**:
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥ –∏–∑ Git
- ‚úÖ –ü–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ –ü–æ–¥–æ–∂–¥–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (10 —Å–µ–∫)
- ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç webhook —Å retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–º**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ webhook (`scripts/set_webhook.sh`):

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ DNS** (5 –ø–æ–ø—ã—Ç–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2 —Å–µ–∫)
   - –ï—Å–ª–∏ DNS —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–º–µ–Ω
   - –ï—Å–ª–∏ DNS –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è ‚Üí fallback –Ω–∞ IP –∞–¥—Ä–µ—Å

2. **–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ webhook**
   - –û—á–∏—â–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

3. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ webhook** (3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 3 —Å–µ–∫)
   - URL: `https://expensebot.duckdns.org/webhook/`
   - Allowed updates: message, callback_query, pre_checkout_query

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π webhook URL
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ pending updates

---

## üîß –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞:

```bash
# –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
cd /home/batman/expense_bot && bash scripts/set_webhook.sh

# –°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç (–≤ home –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏)
bash ~/fix_webhook_force.sh
```

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ curl:

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å BOT_TOKEN –∏–∑ .env
BOT_TOKEN=$(grep '^BOT_TOKEN=' /home/batman/expense_bot/.env | cut -d '=' -f2 | tr -d ' "' | tr -d "'")

# 2. –£–¥–∞–ª–∏—Ç—å webhook
curl -s "https://api.telegram.org/bot${BOT_TOKEN}/deleteWebhook"

# 3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 2 —Å–µ–∫—É–Ω–¥—ã
sleep 2

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
curl -s "https://api.telegram.org/bot${BOT_TOKEN}/setWebhook?url=https://expensebot.duckdns.org/webhook/&allowed_updates=[\"message\",\"callback_query\",\"pre_checkout_query\"]"

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
curl -s "https://api.telegram.org/bot${BOT_TOKEN}/getWebhookInfo" | jq .
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
cd /home/batman/expense_bot && bash check_deployment.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
- ‚úÖ PostgreSQL –¥–æ—Å—Ç—É–ø–Ω–∞
- ‚úÖ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Telegram Bot API –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ **Webhook URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞!)**
- ‚úÖ –ù–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è pending updates
- ‚úÖ Celery workers –∞–∫—Ç–∏–≤–Ω—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook –≤—Ä—É—á–Ω—É—é:

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å webhook
BOT_TOKEN=$(grep '^BOT_TOKEN=' /home/batman/expense_bot/.env | cut -d '=' -f2 | tr -d ' "' | tr -d "'")
curl -s "https://api.telegram.org/bot${BOT_TOKEN}/getWebhookInfo" | jq .
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "ok": true,
  "result": {
    "url": "https://expensebot.duckdns.org/webhook/",
    "has_custom_certificate": false,
    "pending_update_count": 0,
    "allowed_updates": ["message", "callback_query", "pre_checkout_query"]
  }
}
```

**‚ùå –ü—Ä–æ–±–ª–µ–º–∞** –µ—Å–ª–∏:
- `"url": ""` ‚Üí webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `"pending_update_count": > 100` ‚Üí –Ω–∞–∫–æ–ø–∏–ª–∏—Å—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## üõ†Ô∏è Troubleshooting

### 1. Webhook –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è - DNS –ø—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º:**
```
Failed to resolve host: Temporary failure in name resolution
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS —Ä–µ–∑–æ–ª—é—Ü–∏—é
nslookup expensebot.duckdns.org

# –ï—Å–ª–∏ –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å DuckDNS
curl "https://www.duckdns.org/update?domains=expensebot&token=YOUR_TOKEN&verbose=true"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IP –≤–º–µ—Å—Ç–æ –¥–æ–º–µ–Ω–∞ (–≤—Ä–µ–º–µ–Ω–Ω–æ)
BOT_TOKEN=$(grep '^BOT_TOKEN=' /home/batman/expense_bot/.env | cut -d '=' -f2)
SERVER_IP=$(hostname -I | awk '{print $1}')
curl -s "https://api.telegram.org/bot${BOT_TOKEN}/setWebhook?url=https://${SERVER_IP}/webhook/"
```

### 2. Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–æ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç**
```bash
sudo systemctl status nginx
curl -I https://expensebot.duckdns.org/webhook/
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä app –∑–∞–ø—É—â–µ–Ω**
```bash
docker ps | grep expense_bot_app
docker logs expense_bot_app --tail 50
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω**
```bash
echo | openssl s_client -connect expensebot.duckdns.org:443 -servername expensebot.duckdns.org 2>/dev/null | openssl x509 -noout -dates
```

### 3. –ù–∞–∫–æ–ø–∏–ª–∏—Å—å pending updates

**–°–∏–º–ø—Ç–æ–º:**
```json
"pending_update_count": 500
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å webhook —Å drop_pending_updates=true
BOT_TOKEN=$(grep '^BOT_TOKEN=' /home/batman/expense_bot/.env | cut -d '=' -f2)
curl -s "https://api.telegram.org/bot${BOT_TOKEN}/deleteWebhook?drop_pending_updates=true"

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
bash /home/batman/expense_bot/scripts/set_webhook.sh
```

### 4. "Bad webhook: failed to resolve host" –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –±—ã—Å—Ç—Ä–µ–µ —á–µ–º –æ–±–Ω–æ–≤–∏–ª—Å—è DNS

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-15 —Å–µ–∫—É–Ω–¥ –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
sleep 15
bash /home/batman/expense_bot/scripts/set_webhook.sh
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Telegram Bot API - setWebhook](https://core.telegram.org/bots/api#setwebhook)
- [Telegram Bot API - getWebhookInfo](https://core.telegram.org/bots/api#getwebhookinfo)
- [DuckDNS Documentation](https://www.duckdns.org/spec.jsp)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

- [ ] –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –∏–∑ Git
- [ ] Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
- [ ] **Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** (`check_deployment.sh` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç URL)
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≤ Telegram
- [ ] –ê–¥–º–∏–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] –õ–µ–Ω–¥–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 09.10.2025
**–í–µ—Ä—Å–∏—è:** 1.0
