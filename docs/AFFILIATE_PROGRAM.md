# üìä –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ Telegram Stars

> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 05.09.2025

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫](#—Ç–µ–∫—É—â–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–ø–æ–¥–ø–∏—Å–æ–∫)
3. [Telegram Stars Affiliate Program](#telegram-stars-affiliate-program)
4. [–ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–ø–ª–∞–Ω-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
5. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
6. [–°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#—Å—Ç–∞—Ç—É—Å-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –¶–µ–ª—å
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É Telegram Stars Affiliate Programs, –ø–æ–∑–≤–æ–ª—è—é—â–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º –ø–æ–ª—É—á–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é –∑–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç—è—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞
- ‚úÖ –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Stars
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π (–º–µ—Å—è—á–Ω—ã–µ –∏ –ø–æ–ª—É–≥–æ–¥–æ–≤—ã–µ)

---

## üí≥ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ë–æ—Ç –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ Telegram Stars —Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º!

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:

1. **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏** —á–µ—Ä–µ–∑ `send_invoice` —Å –≤–∞–ª—é—Ç–æ–π `XTR` (Telegram Stars)
2. **–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –ø–µ—Ä–∏–æ–¥–∞–º–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. **–ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞** `subscription_period` –≤ –∏–Ω–≤–æ–π—Å–∞—Ö
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ç–∞—Ä–∏—Ñ–æ–≤:**
   - –ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: 150 –∑–≤—ë–∑–¥ (30 –¥–Ω–µ–π)
   - –ü–æ–ª—É–≥–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: 600 –∑–≤—ë–∑–¥ (180 –¥–Ω–µ–π)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**–ú–æ–¥–µ–ª—å Subscription** (`expenses/models.py`):
```python
class Subscription(models.Model):
    profile = models.ForeignKey(Profile, on_delete=models.CASCADE)
    type = models.CharField(max_length=20, choices=[
        ('trial', 'Trial'),
        ('month', 'Monthly'),
        ('six_months', 'Six Months')
    ])
    payment_method = models.CharField(max_length=20, choices=[
        ('trial', 'Trial'),
        ('stars', 'Telegram Stars'),
        ('referral', 'Referral Bonus')
    ])
    amount = models.IntegerField()  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥
    telegram_payment_charge_id = models.CharField(max_length=255, blank=True, null=True)
    start_date = models.DateTimeField()
    end_date = models.DateTimeField()
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
```

#### –¢–∞—Ä–∏—Ñ—ã (`bot/routers/subscription.py`):
```python
SUBSCRIPTION_PRICES = {
    'month': {
        'stars': 150,
        'months': 1,
        'title': '–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–µ—Å—è—Ü',
        'description': '–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –Ω–∞ 1 –º–µ—Å—è—Ü'
    },
    'six_months': {
        'stars': 600,
        'months': 6,
        'title': '–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤',
        'description': '–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤'
    }
}
```

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É

| –ê—Å–ø–µ–∫—Ç | –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ | –ù–∞—Å—Ç–æ—è—â–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ Telegram |
|--------|-----------------|----------------------------|
| **–ü–æ–ª—É–≥–æ–¥–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏** | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç (600 –∑–≤—ë–∑–¥) | ‚ùå –¢–æ–ª—å–∫–æ –º–µ—Å—è—á–Ω—ã–µ |
| **–ö–æ–º–∏—Å—Å–∏—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É** | ‚úÖ –° –ª—é–±–æ–π —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–∞ | ‚úÖ –ï–∂–µ–º–µ—Å—è—á–Ω–æ —Å –ø–æ–¥–ø–∏—Å–∫–∏ |
| **–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ** | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |
| **–†–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Ö–æ–¥** | ‚ùå –¢–æ–ª—å–∫–æ —Å –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π | ‚úÖ –° –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è |

---

## üåü Telegram Stars Affiliate Program

### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Affiliate programs](https://core.telegram.org/api/bots/referrals)
- [Bot Payments API](https://core.telegram.org/bots/payments-stars) 
- [Star subscriptions](https://core.telegram.org/api/subscriptions)
- [Terms of Service](https://telegram.org/tos/affiliate-program)

### –ö–ª—é—á–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API (2024)

1. **–ü–æ–¥–ø–∏—Å–∫–∏:** –¢–æ–ª—å–∫–æ –º–µ—Å—è—á–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (30 –¥–Ω–µ–π), –º–∞–∫—Å–∏–º—É–º —É–∫–∞–∑–∞–Ω –≤ `stars_subscription_amount_max`
2. **–ö–æ–º–∏—Å—Å–∏–∏:** –û—Ç `starref_min_commission_permille` –¥–æ `starref_max_commission_permille` (–≤ –ø—Ä–æ–º–∏–ª–ª–µ)
3. **–•–æ–ª–¥:** 21 –¥–µ–Ω—å –Ω–∞ –≤—ã–≤–æ–¥ –∫–æ–º–∏—Å—Å–∏–π
4. **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ù–µ–ª—å–∑—è —Å–Ω–∏–∑–∏—Ç—å —Å—Ç–∞–≤–∫—É –∏–ª–∏ —Å—Ä–æ–∫, —Ç–æ–ª—å–∫–æ –ø–æ–≤—ã—Å–∏—Ç—å –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–º–∏—Å—Å–∏–∏

#### –î–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (–Ω–∞—à —Å–ª—É—á–∞–π):
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç 150 –∑–≤—ë–∑–¥ ‚Üí —Ä–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç 15 –∑–≤—ë–∑–¥ (–ø—Ä–∏ 10%)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç 600 –∑–≤—ë–∑–¥ ‚Üí —Ä–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç 60 –∑–≤—ë–∑–¥ (–ø—Ä–∏ 10%)
- –ö–æ–º–∏—Å—Å–∏—è –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** —Å –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞

#### –î–ª—è –Ω–∞—Å—Ç–æ—è—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (–µ—Å–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏):
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç 100 –∑–≤—ë–∑–¥/–º–µ—Å ‚Üí —Ä–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç 10 –∑–≤—ë–∑–¥ –µ–∂–µ–º–µ—Å—è—á–Ω–æ
- –ö–æ–º–∏—Å—Å–∏–∏ –∏–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–¥–ª–µ–Ω–∏–∏

---

## üìù –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–í –ø—Ä–æ—Ü–µ—Å—Å–µ)

- [x] –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Telegram Stars Affiliate
- [x] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–ø–∏—Å–æ–∫
- [x] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `AffiliateProgram` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `AffiliateLink` –¥–ª—è —É—á—ë—Ç–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫  
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `AffiliateCommission` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–º–∏—Å—Å–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

### –≠—Ç–∞–ø 3: API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `create_affiliate_program()` —á–µ—Ä–µ–∑ Bot API
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `update_affiliate_program()` 
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `get_affiliate_stats()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É affiliate –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ `pre_checkout_query`

### –≠—Ç–∞–ø 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–æ–∫

- [ ] –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `start` —Å affiliate ID
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ä–µ—Ñ–µ—Ä–µ—Ä
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 5: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π

- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ–ø–ª–∞—Ç—ã —Å —É—á—ë—Ç–æ–º —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ `payments.getStarsTransactions`
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö

### –≠—Ç–∞–ø 6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- [ ] –ö–æ–º–∞–Ω–¥–∞ `/affiliate` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–æ–π

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] Unit-—Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Test Payment Provider
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### AffiliateProgram
```python
class AffiliateProgram(models.Model):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    commission_permille = models.IntegerField()  # –ö–æ–º–∏—Å—Å–∏—è –≤ –ø—Ä–æ–º–∏–ª–ª–µ (100 = 10%)
    duration_months = models.IntegerField(null=True, blank=True)  # –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
    start_date = models.DateTimeField(auto_now_add=True)
    end_date = models.DateTimeField(null=True, blank=True)
    is_active = models.BooleanField(default=True)
    telegram_program_id = models.CharField(max_length=255, unique=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

#### AffiliateLink
```python
class AffiliateLink(models.Model):
    """–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    profile = models.ForeignKey(Profile, on_delete=models.CASCADE)
    affiliate_code = models.CharField(max_length=100, unique=True, db_index=True)
    telegram_link = models.URLField()  # t.me/bot?start=ref_CODE
    clicks = models.IntegerField(default=0)
    conversions = models.IntegerField(default=0)
    total_earned = models.IntegerField(default=0)  # –í –∑–≤—ë–∑–¥–∞—Ö
    created_at = models.DateTimeField(auto_now_add=True)
    is_active = models.BooleanField(default=True)
```

#### AffiliateCommission
```python
class AffiliateCommission(models.Model):
    """–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –∫–æ–º–∏—Å—Å–∏–π"""
    referrer = models.ForeignKey(Profile, on_delete=models.CASCADE, related_name='commissions_earned')
    referred = models.ForeignKey(Profile, on_delete=models.CASCADE, related_name='commissions_generated')
    subscription = models.ForeignKey(Subscription, on_delete=models.CASCADE)
    amount = models.IntegerField()  # –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
    commission_amount = models.IntegerField()  # –ö–æ–º–∏—Å—Å–∏—è –≤ –∑–≤—ë–∑–¥–∞—Ö
    commission_rate = models.IntegerField()  # –°—Ç–∞–≤–∫–∞ –≤ –ø—Ä–æ–º–∏–ª–ª–µ
    telegram_transaction_id = models.CharField(max_length=255, unique=True, null=True)
    status = models.CharField(max_length=20, choices=[
        ('pending', 'Pending'),
        ('hold', 'On Hold'),  # 21-–¥–Ω–µ–≤–Ω—ã–π —Ö–æ–ª–¥
        ('paid', 'Paid'),
        ('cancelled', 'Cancelled')
    ])
    paid_at = models.DateTimeField(null=True, blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
```

### API –º–µ—Ç–æ–¥—ã

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
```python
async def create_affiliate_program(bot: Bot, commission_permille: int, duration_months: Optional[int] = None):
    """–°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —á–µ—Ä–µ–∑ Bot API"""
    # TODO: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ bots.updateStarRefProgram
    pass
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
```python
async def process_referral_start(user_id: int, referral_code: str):
    """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ"""
    # 1. –ù–∞–π—Ç–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–¥–∞
    # 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Å–µ–±–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–º
    # 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–≤—è–∑—å —Ä–µ—Ñ–µ—Ä–µ—Ä-—Ä–µ—Ñ–µ—Ä–∞–ª
    # 4. –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
    pass
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
```python
async def process_referral_payment(subscription: Subscription):
    """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç—ë–∂ —Å —É—á—ë—Ç–æ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    # 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Ä–µ—Ñ–µ—Ä–µ—Ä —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    # 2. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é
    # 3. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏
    # 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—É
    pass
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `/start` –∫–æ–º–∞–Ω–¥–µ
- –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `start` 
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–≤—è–∑—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–µ–π
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
- –°–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –æ –∫–æ–º–∏—Å—Å–∏–∏
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—É

#### –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `/affiliate` - –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
- `/affiliate_stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- `/affiliate_admin` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–æ–π (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

---

## üìà –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–µ—Ä—à—ë–Ω
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –±–æ—Ç–∞
- ‚è≥ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –≤ –∫–æ–º–∞–Ω–¥—É /start
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π
3. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /affiliate –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–æ–π
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö

### –í–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å–∏—Å—Ç–µ–º—É –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–∏—Å—Å–∏—é 10% (100 –ø—Ä–æ–º–∏–ª–ª–µ)
- ‚è≥ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
- ‚è≥ –†–µ—à–∏—Ç—å –≤–æ–ø—Ä–æ—Å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π –¥–ª—è –∫–æ–º–∏—Å—Å–∏–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Telegram Stars Documentation](https://core.telegram.org/api/stars)
- [Affiliate Programs Announcement](https://telegram.org/blog/affiliate-programs-ai-sticker-search)

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [SUBSCRIPTION_INTEGRATION.md](./archive/SUBSCRIPTION_INTEGRATION.md) - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
- [CELERY_DOCUMENTATION.md](./CELERY_DOCUMENTATION.md) - –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| 05.09.2025 | –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã |
| 05.09.2025 | –î–æ–±–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π |

---

*–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã*