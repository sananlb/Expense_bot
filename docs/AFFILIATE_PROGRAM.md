# –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ Coins

> –û–±–Ω–æ–≤–ª–µ–Ω–æ: 20.09.2024

## 1. –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

- üö´ –û—Ç–∫–∞–∑–∞–ª–∏—Å—å –æ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è Telegram Stars –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚Äî Bot API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã Stars –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
- üéÅ –ù–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞–≥—Ä–∞–¥—ã: –ø–µ—Ä–≤–∞—è –æ–ø–ª–∞—á–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –Ω–∞ —Ç–æ—Ç –∂–µ —Å—Ä–æ–∫ (–æ–¥–∏–Ω —Ä–∞–∑).
- ‚≠ê –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –±–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Å–∫–∞–∑–∫–∏, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π Telegram Stars Affiliate Program. –ö–æ–º–∏—Å—Å–∏–∏ –≤ –∑–≤—ë–∑–¥–∞—Ö –Ω–∞—á–∏—Å–ª—è–µ—Ç Telegram, –∞ –Ω–µ –Ω–∞—à –±–æ—Ç.

## 2. –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –±–æ–Ω—É—Å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

### –ü—Ä–∞–≤–∏–ª–æ

–ï—Å–ª–∏ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –ø–µ—Ä–≤—É—é –ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É (–º–µ—Å—è—Ü –∏–ª–∏ 6 –º–µ—Å—è—Ü–µ–≤), –º—ã:
1. –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –Ω–∞ —Ç–∞–∫–æ–π –∂–µ —Å—Ä–æ–∫.
2. –ü–æ–º–µ—á–∞–µ–º —Å–≤—è–∑—å `AffiliateReferral.reward_granted = True`, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (`reward_months`) –∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É (`reward_subscription`).

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|------|------------|
| `bot/services/affiliate.py` | –§—É–Ω–∫—Ü–∏—è `reward_referrer_subscription_extension()` —Å–æ–∑–¥–∞—ë—Ç –±–æ–Ω—É—Å–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. |
| `bot/routers/subscription.py` | –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –≤—ã–∑—ã–≤–∞–µ—Ç –±–æ–Ω—É—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—É. |
| `bot/routers/referral.py` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –∏—Å—Ç–æ—Ä–∏—é –±–æ–Ω—É—Å–æ–≤, –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞. |
| `expenses/models.py` | –ù–æ–≤—ã–µ –ø–æ–ª—è —É `AffiliateReferral`: `reward_granted`, `reward_granted_at`, `reward_subscription`, `reward_months`. |

### –ö–∞–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- `referrals_count` ‚Äî –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏—à–µ–¥—à–∏—Ö –ø–æ —Å—Å—ã–ª–∫–µ.
- `rewarded_referrals` ‚Äî —É —Å–∫–æ–ª—å–∫–∏—Ö —É–∂–µ –≤—ã–¥–∞–Ω –±–æ–Ω—É—Å.
- `pending_referrals` ‚Äî –µ—â—ë –∂–¥—ë–º –ø–µ—Ä–≤—É—é –æ–ø–ª–∞—Ç—É.
- `rewarded_months` ‚Äî —Å—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ –ø—Ä–æ–¥–ª–µ–Ω–∏–π.
- `clicks` / `conversions` –±–µ—Ä—ë–º –∏–∑ `AffiliateLink`.

### –ö–æ–≥–¥–∞ –±–æ–Ω—É—Å –Ω–µ –≤—ã–¥–∞—ë—Ç—Å—è

- –ü–ª–∞—Ç—ë–∂ –Ω–µ —á–µ—Ä–µ–∑ Stars (`payment_method != 'stars'` –∏–ª–∏ —Å—É–º–º–∞ `<= 0`).
- –ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `AffiliateReferral`.
- –ë–æ–Ω—É—Å —É–∂–µ –±—ã–ª –≤—ã–¥–∞–Ω —Ä–∞–Ω–µ–µ.
- –¢–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω (–ª—é–±–æ–π –¥—Ä—É–≥–æ–π `subscription.type`).

## 3. –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è Telegram Stars Affiliate Program

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—Å—ë –µ—â—ë –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ Telegram –∏ –ø–æ–ª—É—á–∞—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –≤ Stars –Ω–∞–ø—Ä—è–º—É—é –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

### –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

1. –û—Ç–∫—Ä—ã—Ç—å **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ú–æ–∏ –∑–≤—ë–∑–¥—ã ‚Üí –ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å –∑–≤—ë–∑–¥—ã** (Settings ‚Üí My Stars ‚Üí Earn Stars).
2. –ù–∞–π—Ç–∏ –Ω–∞—à –±–æ—Ç/–º–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –∫–∞–º–ø–∞–Ω–∏–π.
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É, –∏–∑—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É.
4. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π ‚Äî Telegram —Å–∞–º –Ω–∞—á–∏—Å–ª–∏—Ç Stars –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–æ–∫ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –ß—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –∫–æ–º–∞–Ω–¥–µ

- –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å Stars –∏–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—å –∏—Ö –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏—ë–º Stars –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã (`refundStarPayment`).
- –ö–æ–º–∏—Å—Å–∏–∏, –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ Telegram, –≤–∏–¥–Ω—ã –≤ Star Transactions (`getStarTransactions`). –ú—ã –∏—Ö –Ω–µ —Ç—Ä–æ–≥–∞–µ–º.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏—è –∫–∞–º–ø–∞–Ω–∏–∏ (–ø—Ä–æ—Ü–µ–Ω—Ç, —Å—Ä–æ–∫), –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Telegram App Center, –∞ –Ω–µ –∫–æ–¥–æ–º.

## 4. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- üì© –°–æ–æ–±—â–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º: –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞¬ª –±–æ—Ç –æ–±—ä—è—Å–Ω—è–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: –Ω–∞—à –±–æ–Ω—É—Å –∏ –ø—Ä–æ–≥—Ä–∞–º–º—É Telegram.
- ‚ùì –í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ Stars ‚Äî —Å—Ä–∞–∑—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: [telegram.org/tour/affiliate-programs](https://telegram.org/tour/affiliate-programs).
- üßæ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –±–æ–Ω—É—Å–∞–º —Å–º–æ—Ç—Ä–∏ —á–µ—Ä–µ–∑ –º–µ–Ω—é –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –±–æ—Ç–æ–º¬ª ‚Üí ¬´–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª/¬´–ò—Å—Ç–æ—Ä–∏—è –±–æ–Ω—É—Å–æ–≤¬ª.

## 5. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∏–≥—Ä–∞—Ü–∏–∏

### –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ production)

- **–ú–æ–¥–µ–ª—å `AffiliateCommission`** - –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É –±–æ–Ω—É—Å–æ–≤ –≤ `AffiliateReferral`
- **Celery –∑–∞–¥–∞—á–∏ –≤—ã–ø–ª–∞—Ç** - `release_affiliate_commission`, `process_affiliate_commissions` –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã
- **–§—É–Ω–∫—Ü–∏—è `process_referral_commission`** - –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ `reward_referrer_subscription_extension`

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- **0043_affiliaterewardfields.py** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –±–æ–Ω—É—Å–æ–≤:
  - `reward_granted` (BooleanField)
  - `reward_granted_at` (DateTimeField)
  - `reward_subscription` (ForeignKey)
  - `reward_months` (IntegerField)

## 6. –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏ (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è)

1. –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É, –µ—Å–ª–∏ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π –µ—â—ë –Ω–µ –∫—É–ø–∏–ª –ø–æ–¥–ø–∏—Å–∫—É (—á–µ—Ä–µ–∑ Celery/cron).
2. –•—Ä–∞–Ω–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –±–æ–Ω—É—Å–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞).
3. –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ API –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ Stars –≤–µ—Ä–Ω—É—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã–ø–ª–∞—Ç.

---

**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**<br>
‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç: @product_owner<br>
‚Ä¢ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞: support@coinsapp.io
