# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç 29 —è–Ω–≤–∞—Ä—è 2026

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-01-29 14:35:00 UTC+3
**–°–µ—Ä–≤–µ—Ä:** 176.124.218.53 (PRIMARY)
**–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤:** 28.01.2026 22:15 - 29.01.2026 14:35 (‚âà16 —á–∞—Å–æ–≤)

---

## üìä –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:** ‚úÖ –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ï–ù —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
**Uptime –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:** 15 —á–∞—Å–æ–≤
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º:** 1
**–í–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:** 2
**–ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º:** 3

---

## üê≥ –°—Ç–∞—Ç—É—Å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –°—Ç–∞—Ç—É—Å | Health | Memory | Uptime |
|-----------|--------|--------|--------|--------|
| expense_bot_app | UP | - | 123KB | 15h |
| expense_bot_web | UP | - | 8.19KB | 15h |
| expense_bot_celery | UP | - | 1.87MB | 15h |
| expense_bot_celery_beat | UP | - | 1.86MB | 15h |
| expense_bot_db | UP | ‚úÖ healthy | 20.5KB | 15h |
| expense_bot_redis | UP | ‚úÖ healthy | 4.1KB | 15h |

**–í—ã–≤–æ–¥:** –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ Redis –≤ –∑–¥–æ—Ä–æ–≤–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### üî¥ #1: –ú–∞—Å—Å–æ–≤—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ù–û
**–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã (441 –ø–æ–ø—ã—Ç–∫–∞ –∑–∞ 16 —á–∞—Å–æ–≤)
**–ü–µ—Ä–∏–æ–¥:** 28.01.2026 22:15:56 ‚Üí 29.01.2026 12:52:17

#### –û–ø–∏—Å–∞–Ω–∏–µ
PostgreSQL –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö "expense_user", –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ë–î - "expense_bot".

#### –õ–æ–≥–∏
```
[36mdb_1           |[0m 2026-01-28 22:15:56.369 UTC [36] FATAL:  database "expense_user" does not exist
[36mdb_1           |[0m 2026-01-28 22:17:56.444 UTC [98] FATAL:  database "expense_user" does not exist
[36mdb_1           |[0m 2026-01-28 22:19:56.515 UTC [160] FATAL:  database "expense_user" does not exist
... (–ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)
```

#### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É
- üî¥ **–í—ã—Å–æ–∫–æ–µ:** –°–æ–∑–¥–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ PostgreSQL (441 –Ω–µ—É–¥–∞—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
- üî¥ **–í—ã—Å–æ–∫–æ–µ:** –ó–∞—Å–æ—Ä—è–µ—Ç –ª–æ–≥–∏, –∑–∞—Ç—Ä—É–¥–Ω—è—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- üü° **–°—Ä–µ–¥–Ω–µ–µ:** –†–∞—Å—Ö–æ–¥—É–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery Beat:** Scheduled –∑–∞–¥–∞—á–∞ —Å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ë–î
2. **Health check —Å–∏—Å—Ç–µ–º–∞:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º DB_NAME
3. **Webhook keepalive:** –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. **Backup —Å–∫—Ä–∏–ø—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ credentials

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é

**–®–ê–ì 1: –ù–∞–π—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–æ–±–ª–µ–º—ã**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
ssh batman@176.124.218.53
cd /home/batman/expense_bot

docker exec expense_bot_app env | grep -E "DB_NAME|DB_USER|DB_HOST"
docker exec expense_bot_web env | grep -E "DB_NAME|DB_USER|DB_HOST"
docker exec expense_bot_celery env | grep -E "DB_NAME|DB_USER|DB_HOST"
docker exec expense_bot_celery_beat env | grep -E "DB_NAME|DB_USER|DB_HOST"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
cat .env | grep -E "DB_NAME|DB_USER"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron –∑–∞–¥–∞—á–∏
crontab -l

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scheduled –∑–∞–¥–∞—á–∏ Celery Beat
docker logs expense_bot_celery_beat --tail=100 | grep -i "database\|expense_user"
```

**–®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Django**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å settings.py
ssh batman@176.124.218.53
cat /home/batman/expense_bot/config/settings.py | grep -A 10 "DATABASES"
```

**–®–ê–ì 3: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
```bash
# –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫—Ç–æ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
docker logs expense_bot_db --follow | grep "expense_user"
```

**–®–ê–ì 4: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**
- –ù–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è "expense_user" –∫–∞–∫ –∏–º–µ–Ω–∏ –ë–î
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DB_NAME=expense_bot
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
ssh batman@176.124.218.53
cd /home/batman/expense_bot && docker-compose logs --tail=2000 db | grep "expense_user" | wc -l

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
cd /home/batman/expense_bot && docker-compose logs --tail=2000 db | grep "expense_user" | head -20

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
docker exec expense_bot_db psql -U expense_user -d expense_bot -c "SELECT pid, usename, datname, client_addr, state, query_start FROM pg_stat_activity WHERE datname IS NOT NULL;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—à–∏–±–æ–∫ –ë–î
cd /home/batman/expense_bot && docker-compose logs --tail=2000 app | grep "22:15\|22:17\|22:19"
```

---

## üü† –í–ê–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### üü† #2: Gunicorn Worker Timeout

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–ê–ñ–ù–û
**–ß–∞—Å—Ç–æ—Ç–∞:** 1 —Å–ª—É—á–∞–π –∑–∞ –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
**–ö–æ–≥–¥–∞:** 29.01.2026 12:11:40 UTC+3

#### –û–ø–∏—Å–∞–Ω–∏–µ
Gunicorn worker (PID 13) –∑–∞–≤–∏—Å –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ HTTP –∑–∞–ø—Ä–æ—Å–∞ –∏ –±—ã–ª –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω –ø–æ —Ç–∞–π–º–∞—É—Ç—É.

#### –õ–æ–≥–∏
```
[2026-01-29 12:11:40 +0300] [1] [CRITICAL] WORKER TIMEOUT (pid:13)
[2026-01-29 12:11:40 +0300] [13] [ERROR] Error handling request (no URI read)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/gunicorn/workers/sync.py", line 134, in handle
    req = next(parser)
          ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/gunicorn/http/parser.py", line 41, in __next__
    self.mesg = self.mesg_class(self.cfg, self.unreader, self.source_addr, self.req_count)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/gunicorn/http/message.py", line 259, in __init__
    super().__init__(cfg, unreader, peer_addr)
  File "/usr/local/lib/python3.11/site-packages/gunicorn/http/message.py", line 60, in __init__
    unused = self.parse(self.unreader)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/gunicorn/http/message.py", line 271, in parse
    self.get_data(unreader, buf, stop=True)
  File "/usr/local/lib/python3.11/site-packages/gunicorn/http/message.py", line 262, in get_data
    data = unreader.read()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/gunicorn/http/unreader.py", line 37, in read
    d = self.chunk()
        ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/gunicorn/http/unreader.py", line 63, in chunk
    return self.sock.recv(self.mxchunk)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/gunicorn/workers/base.py", line 203, in handle_abort
    sys.exit(1)
SystemExit: 1
```

#### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É
- üü† **–°—Ä–µ–¥–Ω–µ–µ:** –û–¥–∏–Ω HTTP –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π (–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è–Ω webhook –æ—Ç Telegram)
- üü† **–°—Ä–µ–¥–Ω–µ–µ:** Worker –±—ã–ª –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üü° **–ù–∏–∑–∫–æ–µ:** –ï–¥–∏–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π, –Ω–µ –º–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **–ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î:** –î–æ–ª–≥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–∞
2. **–î–æ–ª–≥–∏–π AI –∑–∞–ø—Ä–æ—Å:** OpenAI/Google AI –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –≤–æ–≤—Ä–µ–º—è
3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é:** Timeout –ø—Ä–∏ –≤–Ω–µ—à–Ω–µ–º API –≤—ã–∑–æ–≤–µ
4. **Deadlock –≤ –∫–æ–¥–µ:** –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª worker
5. **–ú–µ–¥–ª–µ–Ω–Ω—ã–π webhook:** Telegram –æ—Ç–ø—Ä–∞–≤–∏–ª –±–æ–ª—å—à–æ–π payload

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é

**–®–ê–ì 1: –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–ª—è gunicorn**
```python
# –í docker-compose.yml –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ web:
command: gunicorn config.wsgi:application --bind 0.0.0.0:8000 --timeout 60 --workers 4 --access-logfile - --error-logfile -
#                                                                  ^^^^^^^^
#                                                                  –£–≤–µ–ª–∏—á–∏—Ç—å —Å 30 –¥–æ 60 —Å–µ–∫—É–Ω–¥
```

**–®–ê–ì 2: –î–æ–±–∞–≤–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç—è–∂–µ–ª—ã—Ö –∑–∞–¥–∞—á**
```python
# –í—Å–µ AI –∑–∞–ø—Ä–æ—Å—ã –∏ –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ —á–µ—Ä–µ–∑ Celery
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –¥–µ–ª–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö AI –≤—ã–∑–æ–≤–æ–≤
```

**–®–ê–ì 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
```python
# –í middleware —É–∂–µ –µ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–º. –ø—Ä–æ–±–ª–µ–º—É #3)
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã > 30s –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
```

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ gunicorn
ssh batman@176.124.218.53
docker exec expense_bot_web ps aux | grep gunicorn

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ web –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –º–æ–º–µ–Ω—Ç timeout
cd /home/batman/expense_bot && docker-compose logs --tail=500 web | grep -A 50 "12:11:40"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers
docker exec expense_bot_web pgrep -a gunicorn | wc -l

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–±–ª–µ–º—ã
docker exec expense_bot_db psql -U expense_user -d expense_bot -c "SELECT NOW() - query_start AS duration, state, query FROM pg_stat_activity WHERE query_start < NOW() - INTERVAL '30 seconds' AND state != 'idle' ORDER BY duration DESC;"
```

### üü† #3: Unclosed aiohttp Sessions –≤ Celery

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–ê–ñ–ù–û
**–ß–∞—Å—Ç–æ—Ç–∞:** 1 —Å–ª—É—á–∞–π –∑–∞ –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
**–ö–æ–≥–¥–∞:** 29.01.2026 12:00:00 UTC+3 (scheduled –∑–∞–¥–∞—á–∞)

#### –û–ø–∏—Å–∞–Ω–∏–µ
Celery –∑–∞–¥–∞—á–∞ `process_recurring_payments` –Ω–µ –∑–∞–∫—Ä—ã–ª–∞ aiohttp ClientSession –∏ connector –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É—Ç–µ—á–∫–µ –ø–∞–º—è—Ç–∏ –∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

#### –õ–æ–≥–∏
```
ERROR 2026-01-29 12:00:00,541 base_events Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x74d1e1515810>
ERROR 2026-01-29 12:00:00,541 base_events Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x74d1e265e740>, 6099669.238888732)]']
```

#### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É
- üü† **–°—Ä–µ–¥–Ω–µ–µ:** –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –∑–∞–¥–∞—á–∏ (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00)
- üü† **–°—Ä–µ–¥–Ω–µ–µ:** –û—Ç–∫—Ä—ã—Ç—ã–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è
- üü° **–ù–∏–∑–∫–æ–µ:** –ü—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ context manager:** aiohttp session —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ–∑ `async with`
2. **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è:** –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –¥–æ –≤—ã–∑–æ–≤–∞ `session.close()`
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ asyncio –≤ Celery

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é

**–®–ê–ì 1: –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥**
```bash
# –ù–∞–π—Ç–∏ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è aiohttp –≤ –∫–æ–¥–µ
grep -r "aiohttp" --include="*.py" .
grep -r "ClientSession" --include="*.py" .
grep -r "process_recurring_payments" --include="*.py" .
```

**–®–ê–ì 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å context manager**
```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
session = aiohttp.ClientSession()
response = await session.get(url)
session.close()  # –ú–æ–∂–µ—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏

# –ü–†–ê–í–ò–õ–¨–ù–û:
async with aiohttp.ClientSession() as session:
    response = await session.get(url)
    # session –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–∞–∂–µ –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏
```

**–®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ async —Ñ—É–Ω–∫—Ü–∏–∏**
```python
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ aiohttp —Å–µ—Å—Å–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ context manager
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã:
# - bot/services/*.py
# - bot/tasks/*.py (Celery –∑–∞–¥–∞—á–∏)
# - bot/utils/*.py
```

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ù–∞–π—Ç–∏ —Ñ–∞–π–ª —Å –∑–∞–¥–∞—á–µ–π process_recurring_payments
ssh batman@176.124.218.53
cd /home/batman/expense_bot
find . -name "*.py" -type f -exec grep -l "process_recurring_payments" {} \;

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥ –∑–∞–¥–∞—á–∏
grep -A 50 "def process_recurring_payments" bot/tasks/recurring_payments.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è aiohttp
grep -r "ClientSession" --include="*.py" bot/

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Celery –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–±–ª–µ–º—ã
docker logs expense_bot_celery --tail=500 | grep -B 10 -A 10 "12:00:00"
```

---

## ‚ö†Ô∏è WARNING - –ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ö†Ô∏è #4: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ AI –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û
**–ß–∞—Å—Ç–æ—Ç–∞:** 4 —Å–ª—É—á–∞—è –∑–∞ –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** 348740371

#### –û–ø–∏—Å–∞–Ω–∏–µ
AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è (OpenAI/Google AI) —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ, –ø—Ä–µ–≤—ã—à–∞—è –ø–æ—Ä–æ–≥ –≤ 4 —Å–µ–∫—É–Ω–¥—ã. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç 4.60s –¥–æ 6.71s.

#### –õ–æ–≥–∏
```
WARNING 2026-01-29 11:19:51,085 logging_middleware Slow request detected: type=text, duration=6.71s, user=348740371
WARNING 2026-01-29 14:26:40,917 logging_middleware Slow request detected: type=text, duration=4.60s, user=348740371
WARNING 2026-01-29 14:27:31,051 logging_middleware Slow request detected: type=text, duration=4.72s, user=348740371
WARNING 2026-01-29 14:35:28,743 logging_middleware Slow request detected: type=text, duration=5.36s, user=348740371
```

#### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É
- üü° **–ù–∏–∑–∫–æ–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞ 4-7 —Å–µ–∫—É–Ω–¥ (UX –ø—Ä–æ–±–ª–µ–º–∞)
- üü° **–ù–∏–∑–∫–æ–µ:** –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
- ‚ÑπÔ∏è **–ò–Ω—Ñ–æ:** –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ timeout –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—Å–∏—Ç 10s

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **–ú–µ–¥–ª–µ–Ω–Ω—ã–π API OpenAI/Google:** –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. **–ë–æ–ª—å—à–æ–π prompt:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–°–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏:** –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é

**–®–ê–ì 1: –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏**
```python
# –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Redis
# –ö–ª—é—á: hash(description + amount + user_categories)
# TTL: 7 –¥–Ω–µ–π
```

**–®–ê–ì 2: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å prompt**
```python
# –°–æ–∫—Ä–∞—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ prompt
# –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–®–ê–ì 3: –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç**
```python
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å timeout=5s –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤
# –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –∫–∞—Ç–µ–≥–æ—Ä–∏—é
```

**–®–ê–ì 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
```python
# –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞:
# - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ prompt: X ms
# - API –∑–∞–ø—Ä–æ—Å: Y ms
# - –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞: Z ms
```

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
ssh batman@176.124.218.53
cd /home/batman/expense_bot && docker-compose logs --tail=2000 app | grep "Slow request"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AI —Å–µ—Ä–≤–∏—Å–∞
grep -r "openai\|google" --include="*.py" bot/services/ai/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
grep -r "redis\|cache" --include="*.py" bot/services/ai/

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤
docker exec expense_bot_app python -c "from bot.services.ai import *; print(len(CATEGORIZATION_PROMPT))"
```

### ‚ö†Ô∏è #5: Top-5 update error (MESSAGE_NOT_FOUND)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ï–ö–†–ò–¢–ò–ß–ù–û
**–ß–∞—Å—Ç–æ—Ç–∞:** 1 —Å–ª—É—á–∞–π –∑–∞ –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** 1204146623
**–ö–æ–≥–¥–∞:** 29.01.2026 05:00:00 UTC+3

#### –û–ø–∏—Å–∞–Ω–∏–µ
Scheduled –∑–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ —Å–º–æ–≥–ª–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏–ª –µ–≥–æ –∏–∑ —á–∞—Ç–∞.

#### –õ–æ–≥–∏
```
ERROR 2026-01-29 05:00:00,594 celery_tasks Top-5 update error for user 1204146623: Telegram server says - Bad Request: message to edit not found
```

#### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É
- ‚ÑπÔ∏è **–ù–µ—Ç –≤–ª–∏—è–Ω–∏—è:** –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚ÑπÔ∏è **–ù–µ—Ç –≤–ª–∏—è–Ω–∏—è:** –ó–∞–¥–∞—á–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞ –æ—à–∏–±–∫—É

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ:** –ù–∞–º–µ—Ä–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–°–æ–æ–±—â–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–µ:** Telegram —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤ (–¥–ª—è –±–æ—Ç–æ–≤)

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é

**–®–ê–ì 1: –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏**
```python
# –í–º–µ—Å—Ç–æ ERROR –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ WARNING –∏–ª–∏ INFO
# –≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

try:
    await bot.edit_message_text(...)
except MessageNotFound:
    logger.info(f"Top-5 message not found for user {user_id}, skipping update")
    # –í–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ –ë–î –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

**–®–ê–ì 2: –û—á–∏—Å—Ç–∏—Ç—å –ë–î –æ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π**
```python
# –£–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤
# Telegram —Å–∞–º —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –ø—ã—Ç–∞—Ç—å—Å—è –∏—Ö –æ–±–Ω–æ–≤–ª—è—Ç—å
```

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è top-5
ssh batman@176.124.218.53
cd /home/batman/expense_bot && docker-compose logs --tail=2000 celery | grep "Top-5 update error"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
grep -A 30 "def update_top5_categories" bot/tasks/*.py

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
docker exec expense_bot_db psql -U expense_user -d expense_bot -c "SELECT * FROM top5_scheduled_updates LIMIT 10;"
```

### ‚ö†Ô∏è #6: Invalid HTTP_HOST header (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–∞—Ç–∞–∫–∏)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ï–ö–†–ò–¢–ò–ß–ù–û
**–ß–∞—Å—Ç–æ—Ç–∞:** 2 —Å–ª—É—á–∞—è –∑–∞ –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
**–ö–æ–≥–¥–∞:** 29.01.2026 07:52:25 –∏ 07:52:32 UTC+3

#### –û–ø–∏—Å–∞–Ω–∏–µ
Django –ø–æ–ª—É—á–∏–ª HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ HOST –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (api.ipify.org, www.shadowserver.org). –≠—Ç–æ —Ç–∏–ø–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è —Å–∫–∞–Ω–µ—Ä–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –±–æ—Ç–æ–≤.

#### –õ–æ–≥–∏
```
ERROR 2026-01-29 07:52:25,297 log Invalid HTTP_HOST header: 'api.ipify.org'. You may need to add 'api.ipify.org' to ALLOWED_HOSTS.
django.core.exceptions.DisallowedHost: Invalid HTTP_HOST header: 'api.ipify.org'

ERROR 2026-01-29 07:52:32,328 log Invalid HTTP_HOST header: 'www.shadowserver.org'. You may need to add 'www.shadowserver.org' to ALLOWED_HOSTS.
django.core.exceptions.DisallowedHost: Invalid HTTP_HOST header: 'www.shadowserver.org'
```

#### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç—É
- ‚ÑπÔ∏è **–ù–µ—Ç –≤–ª–∏—è–Ω–∏—è:** –ó–∞–ø—Ä–æ—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã Django
- ‚ÑπÔ∏è **–ù–µ—Ç –≤–ª–∏—è–Ω–∏—è:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç host header injection

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **Shadowserver.org:** –ò–∑–≤–µ—Å—Ç–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. **api.ipify.org:** –°–µ—Ä–≤–∏—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–∞, –≤–æ–∑–º–æ–∂–Ω–æ redirect –∏–ª–∏ misconfiguration
3. **–ë–æ—Ç—ã/—Å–∫–∞–Ω–µ—Ä—ã:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é

**–®–ê–ì 1: –£–±—Ä–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö –æ—à–∏–±–æ–∫ (–∑–∞—Å–æ—Ä—è—é—Ç –ª–æ–≥–∏)**
```python
# –í settings.py –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOGGING = {
    'filters': {
        'skip_disallowed_host': {
            '()': 'django.utils.log.CallbackFilter',
            'callback': lambda record: 'DisallowedHost' not in record.getMessage()
        }
    },
    'handlers': {
        'console': {
            'filters': ['skip_disallowed_host'],
        }
    }
}
```

**–®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**
```nginx
# –í –∫–æ–Ω—Ñ–∏–≥–µ Nginx –æ—Ç–∫–ª–æ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º Host
server {
    listen 80 default_server;
    server_name _;
    return 444;  # –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞
}

server {
    listen 80;
    server_name expensebot.duckdns.org;
    # ... –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
}
```

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ö–æ—Å—Ç–∞–º–∏
ssh batman@176.124.218.53
cd /home/batman/expense_bot && docker-compose logs --tail=2000 web | grep "Invalid HTTP_HOST"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ ALLOWED_HOSTS
docker exec expense_bot_web python -c "from config.settings import ALLOWED_HOSTS; print(ALLOWED_HOSTS)"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Nginx
tail -100 /var/log/nginx/access.log | grep -E "api.ipify|shadowserver"
```

---

## üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

| ‚Ññ | –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –í–ª–∏—è–Ω–∏–µ | –°—Ä–æ—á–Ω–æ—Å—Ç—å |
|---|----------|-----------|---------|-----------|
| 1 | –ü–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ "expense_user" –ë–î | üî¥ –ö–†–ò–¢–ò–ß–ù–û | –í—ã—Å–æ–∫–æ–µ | –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ |
| 2 | Gunicorn Worker Timeout | üü† –í–ê–ñ–ù–û | –°—Ä–µ–¥–Ω–µ–µ | 1-2 –¥–Ω—è |
| 3 | Unclosed aiohttp Sessions | üü† –í–ê–ñ–ù–û | –°—Ä–µ–¥–Ω–µ–µ | 1-2 –¥–Ω—è |
| 4 | –ú–µ–¥–ª–µ–Ω–Ω—ã–µ AI –∑–∞–ø—Ä–æ—Å—ã | üü° –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û | –ù–∏–∑–∫–æ–µ | 1 –Ω–µ–¥–µ–ª—è |
| 5 | Top-5 update error | ‚ÑπÔ∏è –ù–ï–ö–†–ò–¢–ò–ß–ù–û | –ù–µ—Ç | –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
| 6 | Invalid HTTP_HOST | ‚ÑπÔ∏è –ù–ï–ö–†–ò–¢–ò–ß–ù–û | –ù–µ—Ç | –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |

---

## üõ†Ô∏è –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
# –°–ª–µ–¥–∏—Ç—å –∑–∞ –≤—Å–µ–º–∏ –ª–æ–≥–∞–º–∏
ssh batman@176.124.218.53
cd /home/batman/expense_bot && docker-compose logs --follow

# –°–ª–µ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏
cd /home/batman/expense_bot && docker-compose logs --follow | grep -E "ERROR|CRITICAL|FATAL"

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker stats
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h

# –û—Ç–∫—Ä—ã—Ç—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ PostgreSQL
docker exec expense_bot_db psql -U expense_user -d expense_bot -c "SELECT count(*) FROM pg_stat_activity;"

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π –≤ Redis
docker exec expense_bot_redis redis-cli DBSIZE
```

### –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
```bash
# –í—Å–µ –æ—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
cd /home/batman/expense_bot && docker-compose logs --since 24h | grep "ERROR" > errors_24h.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫
cat errors_24h.log | awk '{print $5}' | sort | uniq -c | sort -rn

# –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏
cat errors_24h.log | grep "ERROR" | awk -F "ERROR" '{print $2}' | sort | uniq -c | sort -rn | head -10
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (24 —á–∞—Å–∞)
1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É #1** - –Ω–∞–π—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ "expense_user" –ë–î
2. ‚úÖ **–£–≤–µ–ª–∏—á–∏—Ç—å timeout gunicorn** - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã #2

### –ö–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ (1 –Ω–µ–¥–µ–ª—è)
3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å aiohttp —É—Ç–µ—á–∫–∏** - –¥–æ–±–∞–≤–∏—Ç—å context managers (–ø—Ä–æ–±–ª–µ–º–∞ #3)
4. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ AI** - —É—Å–∫–æ—Ä–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—é (–ø—Ä–æ–±–ª–µ–º–∞ #4)
5. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é** - —É–±—Ä–∞—Ç—å —à—É–º –≤ –ª–æ–≥–∞—Ö (–ø—Ä–æ–±–ª–µ–º–∞ #6)

### –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ (2-4 –Ω–µ–¥–µ–ª–∏)
6. ‚úÖ **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ —É—Ä–æ–≤–Ω—è–º –≤–∞–∂–Ω–æ—Å—Ç–∏ (–ø—Ä–æ–±–ª–µ–º–∞ #5)
7. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫** - Prometheus + Grafana
8. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥ ‚âà16 —á–∞—Å–æ–≤
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, worker timeout –∏–∑-–∑–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö AI –∑–∞–ø—Ä–æ—Å–æ–≤)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 176.124.218.53 (PRIMARY)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-29 14:40:00 UTC+3
**–ê–≤—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∞:** Claude Code
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
