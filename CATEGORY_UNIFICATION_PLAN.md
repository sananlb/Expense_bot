# –ü–ª–∞–Ω —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π ExpenseBot

## –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–í —Å–∏—Å—Ç–µ–º–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç 3 —Ä–∞–∑–Ω—ã—Ö —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π:
- DEFAULT_CATEGORIES –≤ models.py
- –°–ø–∏—Å–∫–∏ –≤ user.py –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –µ—Å—Ç—å —Å–º–µ—Å—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö

## –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `bot/utils/categories.py` —Å –µ–¥–∏–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –∏—Ö –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏:

```python
UNIFIED_CATEGORIES = [
    {
        'id': 'products',
        'emoji': 'üõí',
        'ru': '–ü—Ä–æ–¥—É–∫—Ç—ã',
        'en': 'Products',
        'keywords_ru': ['—Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç', '–º–∞–≥–∞–∑–∏–Ω', '–ø—Ä–æ–¥—É–∫—Ç—ã'],
        'keywords_en': ['supermarket', 'store', 'groceries']
    },
    {
        'id': 'restaurants',
        'emoji': 'üçΩÔ∏è',
        'ru': '–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã',
        'en': 'Restaurants and Cafes',
        'keywords_ru': ['—Ä–µ—Å—Ç–æ—Ä–∞–Ω', '–∫–∞—Ñ–µ', '–±–∞—Ä'],
        'keywords_en': ['restaurant', 'cafe', 'bar']
    },
    # ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
]
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
–°–æ–∑–¥–∞—Ç—å management –∫–æ–º–∞–Ω–¥—É Django –¥–ª—è:
- –ê–Ω–∞–ª–∏–∑–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞ –Ω–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –£–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
–ò–∑–º–µ–Ω–∏—Ç—å `create_default_categories()` –≤ user.py:
```python
def create_default_categories(profile_id: int):
    profile = Profile.objects.get(telegram_id=profile_id)
    lang = profile.language_code or 'ru'
    
    for category in UNIFIED_CATEGORIES:
        name = category[lang]
        emoji = category['emoji']
        ExpenseCategory.objects.get_or_create(
            profile=profile,
            name=f"{emoji} {name}"
        )
```

### 4. –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
–í `cashback_free_text.py` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫:
```python
def _resolve_category(profile: Profile, name: str):
    # –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —è–∑—ã–∫–∞–º –∏ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    for category in UNIFIED_CATEGORIES:
        if matches_category(name, category):
            # –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            return find_user_category(profile, category)
```

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
–ü—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –í–°–ï –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
```python
def update_user_language(profile, new_lang):
    for user_category in profile.categories.all():
        unified_cat = find_unified_category(user_category.name)
        if unified_cat:
            new_name = f"{unified_cat['emoji']} {unified_cat[new_lang]}"
            user_category.name = new_name
            user_category.save()
```

## –≠—Ç–∞–ø—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
2. –ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
3. –°–æ–∑–¥–∞—Ç—å –º–∞–ø–ø–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –Ω–æ–≤—ã–µ

### –≠—Ç–∞–ø 2: –ú—è–≥–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
1. –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
3. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Ä—É—á–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É

### –≠—Ç–∞–ø 3: –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è
- **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ**: –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å**: –õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —è–∑—ã–∫–∞–º–∏
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —è–∑—ã–∫–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- **–ü–æ–∏—Å–∫**: –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞ –∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –±–∞–≥–æ–≤

## –†–∏—Å–∫–∏ –∏ –∏—Ö –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è
- **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö**: –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- **–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**: –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–ï—Å–ª–∏ –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–∞, –º–æ–∂–Ω–æ:
1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–∫–∏ –≤ –∫–æ–¥–µ (models.py –∏ user.py)
2. –î–æ–±–∞–≤–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–∏–Ω–æ–Ω–∏–º–æ–≤
3. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π —Å–ø–∏—Å–æ–∫
4. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π