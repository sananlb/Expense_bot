# üöÄ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ ExpenseBot - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (v2.0)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. **–†–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç** —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É: `https://t.me/bot_name?start=ref_CODE`
2. **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
3. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–π –æ–ø–ª–∞—Ç–µ** –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:
   - –†–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –Ω–∞ —Ç–æ—Ç –∂–µ —Å—Ä–æ–∫ (1 –∏–ª–∏ 6 –º–µ—Å—è—Ü–µ–≤)
   - –ë–æ–Ω—É—Å –≤—ã–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –û–î–ò–ù —Ä–∞–∑ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/referral`

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```python
# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–æ–Ω—É—Å–∞ (bot/services/affiliate.py)
reward_referrer_subscription_extension(subscription)
# –°–æ–∑–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É —Å payment_method='referral' –¥–ª—è —Ä–µ—Ñ–µ—Ä–µ—Ä–∞

# –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (bot/routers/subscription.py:898)
if payment.currency == "XTR":  # –û–ø–ª–∞—Ç–∞ Stars
    reward_result = await reward_referrer_subscription_extension(subscription)
```

### –ö–ª—é—á–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

- ‚ùå **–ù–ï –º–æ–∂–µ–º –≤—ã–ø–ª–∞—á–∏–≤–∞—Ç—å Stars** - Telegram Bot API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã
- ‚úÖ **–î–∞–µ–º –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö API
- üîÑ **–¢–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç–µ–∂** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –±–æ–Ω—É—Å—ã
- üìä **–ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - clicks, conversions, rewards –≤ –ë–î

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å v1.0

### –ß—Ç–æ –±—ã–ª–æ (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ):
- –°–∏—Å—Ç–µ–º–∞ `AffiliateCommission` –¥–ª—è –≤—ã–ø–ª–∞—Ç Stars
- Celery –∑–∞–¥–∞—á–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–ø–ª–∞—Ç
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ "–≤—ã–ø–ª–∞—á–µ–Ω–Ω—ã—Ö" Stars (–æ–±–º–∞–Ω)

### –ß—Ç–æ —Å—Ç–∞–ª–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç):
- –ë–æ–Ω—É—Å–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ `AffiliateReferral.reward_*` –ø–æ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ–ø–ª–∞—Ç–µ
- –ß–µ—Å—Ç–Ω–æ–µ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ production:
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python manage.py migrate

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–º–∏—Å—Å–∏—è—Ö
python manage.py shell
>>> from expenses.models import AffiliateCommission
>>> AffiliateCommission.objects.all().delete()
```

## FAQ

**Q: –ü–æ—á–µ–º—É –Ω–µ –≤—ã–ø–ª–∞—á–∏–≤–∞–µ–º Stars?**
A: Telegram Bot API —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å Stars –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é Telegram Affiliate Program?**
A: –î–∞, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è Mini Apps. –û–±—ã—á–Ω—ã–µ –±–æ—Ç—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —Ä–µ—Ñ–µ—Ä–∞–ª –∫—É–ø–∏—Ç –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ?**
A: –ë–æ–Ω—É—Å –≤—ã–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É. –§–ª–∞–≥ `reward_granted` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä—ã.

**Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?**
A: –ó–∞–ø—É—Å—Ç–∏—Ç—å `python test_all_fixes.py` - —Ç–µ—Å—Ç "–ë–æ–Ω—É—Å –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∑–∞ –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç–µ–∂"

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `bot/services/affiliate.py` | –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã |
| `bot/routers/subscription.py:898` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã |
| `bot/routers/referral.py` | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `expenses/models.py:AffiliateReferral` | –ú–æ–¥–µ–ª—å —Å –ø–æ–ª—è–º–∏ –¥–ª—è –±–æ–Ω—É—Å–æ–≤ |
| `migrations/0043_affiliaterewardfields.py` | –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π |
| `docs/AFFILIATE_PROGRAM.md` | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |

---
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 20.09.2024*