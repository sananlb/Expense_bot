"""
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
"""
import asyncio
from aiogram import Bot
from aiogram.types import BotCommand, BotCommandScopeDefault, BotCommandScopeChat


async def set_bot_commands(bot: Bot):
    """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ - –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏"""
    commands = [
        BotCommand(command="expenses", description="üìä –†–∞—Å—Ö–æ–¥—ã"),
        BotCommand(command="cashback", description="üí≥ –ö–µ—à–±—ç–∫"),
        BotCommand(command="categories", description="üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏"),
        BotCommand(command="recurring", description="üîÑ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏"),
        BotCommand(command="subscription", description="‚≠ê –ü–æ–¥–ø–∏—Å–∫–∞"),
        BotCommand(command="settings", description="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"),
        BotCommand(command="start", description="üìñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"),
    ]
    
    await bot.set_my_commands(
        commands=commands,
        scope=BotCommandScopeDefault()
    )


async def update_user_commands(bot: Bot, user_id: int):
    """–û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º —è–∑—ã–∫–∞"""
    # –ü–æ–ª—É—á–∞–µ–º —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    from bot.utils import get_user_language
    from bot.utils import get_text
    
    lang = await get_user_language(user_id)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã —Å —É—á–µ—Ç–æ–º —è–∑—ã–∫–∞
    commands = [
        BotCommand(command="expenses", description=f"üìä {get_text('expenses_today', lang)}"),
        BotCommand(command="cashback", description=f"üí≥ {get_text('cashback_menu', lang)}"),
        BotCommand(command="categories", description=f"üìÅ {get_text('categories_menu', lang)}"),
        BotCommand(command="recurring", description=f"üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏"),
        BotCommand(command="subscription", description="‚≠ê –ü–æ–¥–ø–∏—Å–∫–∞"),
        BotCommand(command="settings", description=f"‚öôÔ∏è {get_text('settings_menu', lang)}"),
        BotCommand(command="start", description=f"üìñ {get_text('info', lang)}"),
    ]
    
    try:
        # –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        scope = BotCommandScopeChat(chat_id=user_id)
        await bot.delete_my_commands(scope=scope)
        
        # –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫–µ—à–∞
        await asyncio.sleep(0.5)
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await bot.set_my_commands(commands, scope=scope)
    except Exception as e:
        # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
        pass