# Generated by Django 4.2.11 on 2025-09-03 07:59

from django.db import migrations


def create_default_income_categories(apps, schema_editor):
    """–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π"""
    IncomeCategory = apps.get_model('expenses', 'IncomeCategory')
    Profile = apps.get_model('expenses', 'Profile')
    
    # –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ—Ö–æ–¥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –∏–∫–æ–Ω–∫–∞–º–∏
    default_categories = [
        ('üíº –ó–∞—Ä–ø–ª–∞—Ç–∞', 'üíº'),
        ('üéÅ –ü—Ä–µ–º–∏–∏ –∏ –±–æ–Ω—É—Å—ã', 'üéÅ'),
        ('üíª –§—Ä–∏–ª–∞–Ω—Å', 'üíª'),
        ('üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', 'üìà'),
        ('üè¶ –ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –≤–∫–ª–∞–¥–∞–º', 'üè¶'),
        ('üè† –ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏', 'üè†'),
        ('üí∏ –í–æ–∑–≤—Ä–∞—Ç—ã –∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏', 'üí∏'),
        ('üí≥ –ö–µ—à–±—ç–∫', 'üí≥'),
        ('üéâ –ü–æ–¥–∞—Ä–∫–∏', 'üéâ'),
        ('üí∞ –ü—Ä–æ—á–∏–µ –¥–æ—Ö–æ–¥—ã', 'üí∞'),
    ]
    
    # –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
    for profile in Profile.objects.all():
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ —É –ø—Ä–æ—Ñ–∏–ª—è
        if not profile.income_categories.exists():
            income_categories = []
            for name, icon in default_categories:
                # –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å —ç–º–æ–¥–∑–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
                income_categories.append(
                    IncomeCategory(
                        profile=profile,
                        name=name,
                        icon=icon,
                        is_active=True,
                        is_default=False
                    )
                )
            # –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            if income_categories:
                IncomeCategory.objects.bulk_create(income_categories, ignore_conflicts=True)


def reverse_default_income_categories(apps, schema_editor):
    """–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"""
    IncomeCategory = apps.get_model('expenses', 'IncomeCategory')
    # –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default_names = [
        'üíº –ó–∞—Ä–ø–ª–∞—Ç–∞',
        'üéÅ –ü—Ä–µ–º–∏–∏ –∏ –±–æ–Ω—É—Å—ã',
        'üíª –§—Ä–∏–ª–∞–Ω—Å',
        'üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',
        'üè¶ –ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –≤–∫–ª–∞–¥–∞–º',
        'üè† –ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
        'üí∏ –í–æ–∑–≤—Ä–∞—Ç—ã –∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏',
        'üí≥ –ö–µ—à–±—ç–∫',
        'üéâ –ü–æ–¥–∞—Ä–∫–∏',
        'üí∞ –ü—Ä–æ—á–∏–µ –¥–æ—Ö–æ–¥—ã',
    ]
    IncomeCategory.objects.filter(name__in=default_names).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('expenses', '0020_incomecategory_income_and_more'),
    ]

    operations = [
        migrations.RunPython(create_default_income_categories, reverse_default_income_categories),
    ]
